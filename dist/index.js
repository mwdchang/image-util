var G=t=>t.data.length/t.width/t.height,lt=async(t,a)=>{let u=new Image,o=document.createElement("canvas"),s=o.getContext("2d");return new Promise((l,n)=>{u.crossOrigin="",u.onerror=()=>{n(new Error("unable to load image"))},u.onload=()=>{u.width=a.width||u.naturalWidth,u.height=a.height||u.naturalHeight,o.width=u.width,o.height=u.height,s.drawImage(u,0,0,u.width,u.height);let c=s.getImageData(0,0,o.width,o.height);l(c)},u.src=t})},ct=t=>{let a=document.createElement("canvas");return a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0),a},ht=(t,a)=>{let u=t.width,o=4,s=a.width,e=a.height,l=new Uint8ClampedArray(s*e*o),n=0;for(let c=a.y;c<a.y+a.height;c++)for(let d=a.x;d<a.x+a.width;d++){let h=c*u*o+d*o;for(let r=0;r<o;r++)l[n++]=t.data[h+r]}return new ImageData(l,s,e)},N=(t,a)=>{let u=t.data.length,o=new Uint8ClampedArray(u);for(let s=0;s<u;s+=4){let e=s/4,l=a({r:t.data[s+0],g:t.data[s+1],b:t.data[s+2],a:t.data[s+3],x:e%t.width,y:Math.floor(e/t.height)});o[s+0]=l.r,o[s+1]=l.g,o[s+2]=l.b,o[s+3]=l.a}return new ImageData(o,t.width,t.height)},dt=(t,a,u)=>{if(t.data.length!==a.data.length)throw new Error("images need to be same length");let o=t.data.length,s=new Uint8ClampedArray(o);for(let e=0;e<o;e+=4){let l=u({r:t.data[e+0],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]},{r:a.data[e+0],g:a.data[e+1],b:a.data[e+2],a:a.data[e+3]});s[e+0]=l.r,s[e+1]=l.g,s[e+2]=l.b,s[e+3]=l.a}return new ImageData(s,t.width,t.height)},k=(t,a)=>{let{width:u,height:o,data:s}=t,e=G(t),l=O(Array.from(s),u,o,e,a);return new ImageData(new Uint8ClampedArray(l),u,o)},O=(t,a,u,o,s)=>{let e=Math.round(Math.sqrt(s.length)),l=Math.floor(e/2),n=a,c=u,d=n,h=c,r=[],i=1/s.length*.28;for(let m=0;m<h;m++)for(let b=0;b<d;b++){let x=[];for(let f=0;f<o;f++)x.push(0);for(let f=0;f<e;f++)for(let g=0;g<e;g++){let M=m+f-l,w=b+g-l;if(M>=0&&M<c&&w>=0&&w<n){let p=(M*n+w)*o,I=s[f*e+g];for(let y=0;y<o;y++)x[y]+=t[p+y]*I}else for(let p=0;p<o;p++)x[p]+=t[(m*d+b)*o]*i}for(let f=0;f<o;f++)r.push(x[f])}return r},A=(t,a)=>{let u=t.width,o=t.height,s=4,e=[];for(let l=0;l<o;l++)for(let n=0;n<u;n++){let c=s*(l*u+n),d=t.data[c+0],h=t.data[c+1],r=t.data[c+2],i=t.data[c+3],m=d*a[0]+h*a[1]+r*a[2],b=d*a[3]+h*a[4]+r*a[5],x=d*a[6]+h*a[7]+r*a[8];e.push(m),e.push(b),e.push(x),e.push(i)}return new ImageData(new Uint8ClampedArray(e),u,o)},R=(t,a,u)=>{let o=Math.max(t,a,u),s=Math.min(t,a,u),e=o-s,l=0;e!==0&&(o===t?l=((a-u)/e+(a<u?6:0))/6:o===a?l=((u-t)/e+2)/6:l=((t-a)/e+4)/6);let n=o===0?0:e/o;return{h:l,s:n,v:o}},C=(t,a,u)=>{let{width:o,height:s,data:e}=t;if(e.length/o/s!==4)throw new Error("Only support rgba channels currently...");let n=Math.max(0,Math.min(o-1,a)),c=Math.max(0,Math.min(s-1,u)),d=Math.floor(n),h=Math.floor(c),r=Math.min(d+1,o-1),i=Math.min(h+1,s-1),m=n-d,b=c-h;function x(y,D){let v=(D*o+y)*4;return[e[v],e[v+1],e[v+2],e[v+3]]}let f=x(d,h),g=x(r,h),M=x(d,i),w=x(r,i),p=f.map((y,D)=>y*(1-m)+g[D]*m),I=M.map((y,D)=>y*(1-m)+w[D]*m);return p.map((y,D)=>y*(1-b)+I[D]*b)};var mt=(t,a)=>{let u=[],o=a*a;for(let s=0;s<o;s++)u.push(1/o);return k(t,u)};var xt=t=>A(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),gt=t=>A(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),pt=t=>A(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),wt=t=>A(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),Mt=t=>A(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),It=t=>A(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]),yt=t=>A(t,[.1,.4,.1,.2,.8,.2,.1,.4,.1]);var vt=(t,a)=>{let u=[];for(let o=0;o<t.data.length;o++){let s=t.data[o]/(255-a.data[o]);s>1&&(s=1),u.push(s*255)}return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var B=(t,a)=>{let u=t.width,o=t.height,s=4,e=new Uint8ClampedArray(u*o*s);for(let l=0;l<u*o;++l){let n=l*s;if(a){if(a.rFilter){let d=a.rFilter;if(t.data[n]>=d[0]&&t.data[n]<=d[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}if(a.gFilter){let d=a.gFilter;if(t.data[n+1]>=d[0]&&t.data[n+1]<=d[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}if(a.bFilter){let d=a.bFilter;if(t.data[n+2]>=d[0]&&t.data[n+2]<=d[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}}let c=0;for(let d=0;d<s-1;d++)c+=t.data[n+d];c/=3;for(let d=0;d<s-1;d++)e[n+d]=c;e[n+s-1]=255}return new ImageData(new Uint8ClampedArray(e),u,o)};var St=t=>k(t,[0,-1,0,-1,5,-1,0,-1,0]),Bt=t=>{let a=B(t);return k(a,[-2,-1,0,-1,1,1,0,1,2])},Ut=t=>{let a=[-1,-1,-1,-1,8,-1,-1,-1,-1],u=[],o=B(t);for(let l=0;l<o.data.length;l++)l%4===0&&u.push(t.data[l]);let s=O(u,t.width,t.height,1,a),e=[];for(let l=0;l<s.length;l++)e.push(s[l]),e.push(s[l]),e.push(s[l]),e.push(255);return new ImageData(new Uint8ClampedArray(e),t.width,t.height)},Ot=t=>{let a=[-1,0,1,-2,0,2,-1,0,1],u=[-1,-2,-1,0,0,0,1,2,1],o=B(t),s=[];for(let c=0;c<o.data.length;c++)c%4===0&&s.push(o.data[c]);let e=O(s,t.width,t.height,1,a),l=O(s,t.width,t.height,1,u),n=[];for(let c=0;c<e.length;c++){let d=Math.sqrt(e[c]*e[c]+l[c]*l[c]);n.push(Math.min(255,d)),n.push(Math.min(255,d)),n.push(Math.min(255,d)),n.push(255)}return new ImageData(new Uint8ClampedArray(n),t.width,t.height)};var Nt=(t,a,u,o,s)=>{let e=t.width,l=t.height,n=4,c=[];for(let d=0;d<l;d++)for(let h=0;h<e;h++){let r=h-a,i=d-u,m=Math.sqrt(r*r+i*i);if(m<o){let b=Math.floor(a+r*s*m),x=Math.floor(u+i*s*m),f=n*(x*e+b);c.push(t.data[f]),c.push(t.data[f+1]),c.push(t.data[f+2]),c.push(255)}else{let b=n*(d*e+h);c.push(t.data[b]),c.push(t.data[b+1]),c.push(t.data[b+2]),c.push(t.data[b+3])}}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var L=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],q=t=>k(t,L);var Y=(t,a,u)=>`rgb(${t},${a},${u})`,$=(t,a,u,o)=>{let{width:s,data:e}=t,l=o.kernel,n=l*l,c=0,d=0,h=0;for(let x=u;x<u+l;x++)for(let f=a;f<a+l;f++){let g=(x*s+f)*4;c+=e[g]||0,d+=e[g+1]||0,h+=e[g+2]||0}let r=(o.rWeight*c+o.gWeight*d+o.bWeight*h)/(255*n),i=c/n,m=d/n,b=h/n;return{v:r,avgR:i,avgG:m,avgB:b}},Rt=(t,a)=>{let u=a.kernel,o=t.width,s=t.height;a.rWeight||(a.rWeight=.2),a.gWeight||(a.gWeight=.2),a.bWeight||(a.bWeight=.2);let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let l=e.getContext("2d"),n=(u-1)*.5;for(let c=0;c<=s-u;c+=u)for(let d=0;d<=o-u;d+=u){let{v:h,avgR:r,avgG:i,avgB:m}=$(t,d,c,a),b=u/2*(1-h),x=0;a.shiftYAmt&&a.shiftYStride&&(x=d%(a.shiftYStride*u)===0?0:a.shiftYAmt);let f=0;a.shiftXAmt&&a.shiftXStride&&(x=d%(a.shiftXStride*u)===0?0:a.shiftXAmt),l.beginPath(),l.fillStyle=Y(r,i,m),l.ellipse(f+d+n,x+c+n,b,b,0,0,2*Math.PI),l.fill(),l.closePath()}return l.getImageData(0,0,o,s)};var Gt=t=>{let a=q(t);a=B(a);let u=[];for(let o=0;o<t.data.length;o++)if(o%4!==3){let s=Math.min(255,.5*a.data[o]+.9*t.data[o]);u.push(s)}else u.push(255);return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var Yt=(t,a,u)=>{let o=t.width,s=t.height,e=4,l=[];for(let n=0;n<s;n++)for(let c=0;c<o;c++){let d=e*(n*o+c);n%a<u||c%a<u?(l.push(255),l.push(255),l.push(255),l.push(255)):(l.push(t.data[d+0]),l.push(t.data[d+1]),l.push(t.data[d+2]),l.push(255))}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var H=(t,a,u)=>(t*.299+a*.587+u*.114)/255,Ht=(t,a,u,o,s)=>{let e=t.width,l=t.height,n=4,c=[],d=10;for(let h=0;h<l;h++)for(let r=0;r<e;r++){let i=n*(h*e+r),m=t.data[i+0],b=t.data[i+1],x=t.data[i+2],f=H(m,b,x),g=245,M=245,w=245,p=6;f<a&&(r+h)%p===0&&(g=4*d,M=4*d,w=4*d),f<u&&(r-h)%p===0&&(g=4*d,M=4*d,w=4*d),f<o&&(r+h-5)%p===0&&(g=4*d,M=4*d,w=4*d),f<s&&(r-h-5)%p===0&&(g=8*d,M=8*d,w=8*d),c.push(g),c.push(M),c.push(w),c.push(255)}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var Jt=t=>N(t,a=>({r:255-a.r,g:255-a.g,b:255-a.b,a:a.a}));var Kt=(t,a,u)=>{let o=t.width,s=t.height,e=4,l=new Uint8ClampedArray(t.data);for(let n=a;n<s-a;n++)for(let c=a;c<o-a;c++){let d=[],h=[],r=[],i=[];for(let f=0;f<u;f++)d.push(0),h.push(0),r.push(0),i.push(0);for(let f=-a;f<=a;f++)for(let g=-a;g<=a;g++){let M=e*((n+f)*o+(c+g)),w=t.data[M+0],p=t.data[M+1],I=t.data[M+2],y=Math.floor((w+p+I)/3*u/255);d[y]++,h[y]+=w,r[y]+=p,i[y]+=I}let m=0,b=0;for(let f=0;f<u;f++)d[f]>m&&(m=d[f],b=f);let x=e*(n*o+c);l[x+0]=h[b]/m,l[x+1]=r[b]/m,l[x+2]=i[b]/m}return new ImageData(l,o,s)};var V=(t,a,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),l=Math.floor(Math.random()*u),n=0,c=!1;for(let d=0;d<o;d++){if(n++,c){for(let h=0;h<s-l;h++){let r=4*(h*o+d),i=4*((h+l)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let h=s-l;h<s;h++){let r=4*(h*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let h=0;h<l;h++){let r=4*(h*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}for(let h=l;h<s;h++){let r=4*(h*o+d),i=4*((h-l)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}}n==a&&(l=Math.floor(Math.random()*u),c=!c,n=0)}return e},_=(t,a,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),l=Math.floor(Math.random()*u),n=0,c=!1;for(let d=0;d<s;d++){if(n++,c){for(let h=0;h<o-l;h++){let r=4*(d*o+h),i=4*(d*o+h+l);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let h=o-l;h<o;h++){let r=4*(d*o+h);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let h=l;h<o;h++){let r=4*(d*o+h),i=4*(d*o+h-l);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let h=0;h<l;h++){let r=4*(d*o+h);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}n==a&&(l=Math.floor(Math.random()*u),c=!c,n=0)}return e},Qt=(t,a,u,o,s)=>{let e=_(t,a,u);return V(e,o,s)};var ee=(t,a)=>{let u=t.width,o=t.height,s=t.data,e=new Set,l=[];for(let h=0;h<u;h++)for(let r=0;r<o;r++){let i=(h+r*u)*4,m=s[i]+":"+s[i+1]+":"+s[i+2];e.has(m)||(e.add(m),l.push([s[i+0],s[i+1],s[i+2]]))}let n={};for(;;){let h=a.levelSteps;n={};for(let i of l){let m=i[0],b=i[1],x=i[2],f=Math.round(m/255*(h-1)),g=Math.round(b/255*(h-1)),M=Math.round(x/255*(h-1));for(let w=-1;w<=1;w++)for(let p=-1;p<=1;p++)for(let I=-1;I<=1;I++){let y=f+w+":"+(g+p)+":"+(M+I);n[y]=!0}}if(Object.keys(n).length>NaN&&a.levelSteps>2){a.levelSteps--,console.log("Reducing to "+a.levelSteps+" RGB steps");continue}break}let{canvases:c,imageDatas:d}=Z(u,o,n,a);return J(t,d,a)},J=(t,a,u)=>{let o=t.width,s=t.height,e=t.data,l=[];for(let n=0;n<o;n++)for(let c=0;c<s;c++){let d=n+c*o;l[d*3]=e[d*4],l[d*3+1]=e[d*4+1],l[d*3+2]=e[d*4+2]}l=Q(l,{width:o,height:s,blurAmount:u.edgeBlurAmount});for(let n=0;n<o;n++)for(let c=0;c<s;c++){let d=n+c*o,h=e[d*4],r=e[d*4+1],i=e[d*4+2],m=K(a,d,h,r,i,u.levelSteps);if(u.greyScale){let x=Math.round((m.red+m.green+m.blue)/3);m.red=m.green=m.blue=x}let b=Math.max(0,(255-l[n+c*o]*u.edgeAmount)/255);b=Math.min(1,Math.max(.5,b*b)),e[d*4]=Math.round(m.red*b),e[d*4+1]=Math.round(m.green*b),e[d*4+2]=Math.round(m.blue*b)}return t},Z=(t,a,u,o)=>{let s=performance.now(),e=o.levelSteps,l=[],n=[],c=o.lineThickness,d=o.lineLength,h=1-o.darkeningFactor,r=o.lineAlpha,i=o.lineDensity*2,m=o.lightness;for(let x=-1;x<=e;x++){l[x]={},n[x]={};for(let f=-1;f<=e;f++)l[x][f]={},n[x][f]={}}for(let x in u){let f=x.split(":"),g=parseInt(f[0]),M=parseInt(f[1]),w=parseInt(f[2]),p=255*g/(e-1),I=255*M/(e-1),y=255*w/(e-1);p=Math.min(255,Math.max(0,p)),I=Math.min(255,Math.max(0,I)),y=Math.min(255,Math.max(0,y));let D=1-Math.min(p,I,y)/255,v="";if(D>0){let F=Math.pow(1/D,1/m),U=Math.round((255-(255-p)*F)*h),W=Math.round((255-(255-I)*F)*h),X=Math.round((255-(255-y)*F)*h);v=`rgb(${U}, ${W}, ${X})`}else{let F=Math.round(p*h),U=Math.round(I*h),W=Math.round(y*h);v=`rgb(${F}, ${U}, ${W})`}let S=0,j=0;if(Math.abs(I-y)>.1||Math.abs(2*p-I-y)>.1){j=Math.atan2(Math.sqrt(3)*(I-y),2*p-I-y);let F=Math.max(255-p,255-I,255-y),U=Math.min(255-p,255-I,255-y);S=(F-U)/F,S==0&&(j=Math.random()*Math.PI*2)}else j=0,S=0;let E=Math.PI*(.1+.9*Math.pow(1-S,3)),T=z(t,a,j/2+Math.PI*.3,E,c,d,D*i,v,r);l[g][M][w]=T,n[g][M][w]=T.getContext("2d").getImageData(0,0,t,a)}let b=performance.now();return console.log("create textures....",b-s),{canvases:l,imageDatas:n}},K=(t,a,u,o,s,e)=>{a*=4;let l=u/255*(e-1),n=o/255*(e-1),c=s/255*(e-1),d=l,h=n,r=c;l=Math.round(l),n=Math.round(n),c=Math.round(c);let i=0;for(let g=-1;g<=1;g++)for(let M=-1;M<=1;M++)for(let w=-1;w<=1;w++){let p=(.75-Math.abs(l+g-d)/2)*(.75-Math.abs(n+M-h)/2)*(.75-Math.abs(c+w-r)/2);if(p<0)throw new Error("debug");i+=p}let m=0,b=0,x=0;for(let g=-1;g<=1;g++)for(let M=-1;M<=1;M++)for(let w=-1;w<=1;w++){let p=(.75-Math.abs(l+g-d)/2)*(.75-Math.abs(n+M-h)/2)*(.75-Math.abs(c+w-r)/2);p/=i;let I=t[l+g][n+M][c+w];if(I==null)throw new Error("debug me!");m+=I.data[a]*p,b+=I.data[a+1]*p,x+=I.data[a+2]*p}let f=1-(1-(e+1)/e)*.25;return{red:Math.min(255,Math.round(m*f)),green:Math.min(255,Math.round(b*f)),blue:Math.min(255,Math.round(x*f))}},z=(t,a,u,o,s,e,l,n,c)=>{let d=l*t*a/e/s/c,h=document.createElement("canvas");h.width=t,h.height=a;let r=h.getContext("2d");r.strokeStyle=n,r.globalAlpha=1,r.fillStyle="#FFFFFF",r.fillRect(0,0,t,a),r.globalAlpha=c,r.lineWidth=s;for(let i=0;i<d;i++){let m=u+Math.round(Math.random()*2-1)/2*o,b=Math.random()*t,x=Math.random()*a,f=e/2*Math.cos(m),g=e/2*Math.sin(m),M=b+f,w=b-f,p=x+g,I=x-g;r.beginPath(),r.moveTo(M,p),r.lineTo(w,I),r.stroke()}return h},Q=(t,a)=>{let u=a.width,o=a.height,s=a.blurAmount,e=[],l=[];for(let h=0;h<u;h++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<o;m++){let b=h+m*u;r[0]+=t[b*3+0],r[1]+=t[b*3+1],r[2]+=t[b*3+2],i[0]+=t[b*3+0]*t[b*3+0],i[1]+=t[b*3+1]*t[b*3+1],i[2]+=t[b*3+2]*t[b*3+2],e[b]=r.slice(0),l[b]=i.slice(0)}}let n=[],c=[];for(let h=0;h<o;h++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<u;m++){let b=m+h*u,x=m+Math.max(0,Math.round(h-s/2))*u,f=m+Math.min(o-1,Math.round(h+s/2))*u;r[0]+=(e[f][0]-e[x][0])/(f-x)*u,r[1]+=(e[f][1]-e[x][1])/(f-x)*u,r[2]+=(e[f][2]-e[x][2])/(f-x)*u,i[0]+=(l[f][0]-l[x][0])/(f-x)*u,i[1]+=(l[f][1]-l[x][1])/(f-x)*u,i[2]+=(l[f][2]-l[x][2])/(f-x)*u,n[b]=r.slice(0),c[b]=i.slice(0)}}let d=[];for(let h=0;h<u;h++)for(let r=0;r<o;r++){let i=h+r*u,m=Math.max(0,Math.round(h-s/2))+r*u,b=Math.min(u-1,Math.round(h+s/2))+r*u,x=(n[b][0]-n[m][0])/(b-m),f=(n[b][1]-n[m][1])/(b-m),g=(n[b][2]-n[m][2])/(b-m),M=(c[b][0]-c[m][0])/(b-m),w=(c[b][1]-c[m][1])/(b-m),p=(c[b][2]-c[m][2])/(b-m);d[i]=Math.sqrt(M+w+p-(x*x+f*f+g*g)),isNaN(d[i])&&(d[i]=0)}return d};var tt=(t,a,u)=>{let o=t/255,s=a/255,e=u/255,l,n,c;o<=.04045?l=o/12.92:l=Math.pow((o+.055)/1.055,2.4),s<=.04045?n=s/12.92:n=Math.pow((s+.055)/1.055,2.4),e<=.04045?c=e/12.92:c=Math.pow((e+.055)/1.055,2.4);let d,h,r;d=l*.4124564+n*.3575761+c*.1804375,h=l*.2126729+n*.7151522+c*.072175,r=l*.0193339+n*.119192+c*.9503041;let i=.008856,m=903.3,b=.950456,x=1,f=1.088754,g=d/b,M=h/x,w=r/f,p,I,y;g>i?p=Math.pow(g,.3333333333333333):p=(m*g+16)/116,M>i?I=Math.pow(M,.3333333333333333):I=(m*M+16)/116,w>i?y=Math.pow(w,.3333333333333333):y=(m*w+16)/116;let D=116*I-16,v=500*(p-I),S=200*(I-y);return{l:D,a:v,b:S}},et=(t,a,u)=>{let o=Number.MAX_VALUE,s={x:0,y:0,l:0,a:0,b:0},e=t.width,l=t.height;for(let n=a-1;n<=a+1&&n>=0&&n<l-1;n++)for(let c=u-1;c<=u+1&&c>=0&&c<e-1;c++){let d=t.data[4*(n*e+c+1)],h=t.data[4*((n+1)*e+c+1)],r=t.data[4*(n*e+c)];Math.sqrt(Math.pow(d-r,2))+Math.sqrt(Math.pow(h-r,2))<o&&(o=Math.abs(d-r)+Math.abs(h-r),s.x=n,s.y=c)}return s},at=(t,a,u,o,s,e)=>{let l=t.width,n=Math.sqrt(Math.pow(a.l-t.data[4*(u*l+o)],2)+Math.pow(a.a-t.data[4*(u*l+o)+1],2)+Math.pow(a.b-t.data[4*(u*l+o)+2],2)),c=Math.sqrt(Math.pow(a.x-u,2)+Math.pow(a.y-o,2));return Math.pow(n/e,2)+Math.pow(c/s,2)},nt=(t,a,u,o)=>{console.log("computing.............................");let s=t.width,e=t.height,l=Array.from({length:s*e}).map(c=>c=-1),n=new Array;for(let c=a;c<e;c+=a)for(let d=a;d<s;d+=a){let h=et(t,c,d);h.l=t.data[4*(h.x*s+h.y)],h.a=t.data[4*(h.x*s+h.y)+1],h.b=t.data[4*(h.x*s+h.y)+2],n.push(h)}for(let c=0;c<u;c++){let d=Array.from({length:s*e}).map(r=>r=Number.MAX_VALUE);for(let r=0;r<n.length;r++)for(let i=n[r].x-a;i<n[r].x+a;i++)for(let m=n[r].y-a;m<n[r].y+a;m++)if(i>=0&&i<e&&m>=0&&m<s){let b=at(t,n[r],i,m,a,o);b<d[i*s+m]&&(d[i*s+m]=b,l[i*s+m]=r)}let h=JSON.parse(JSON.stringify(n));for(let r of n)r.c=r.l=r.a=r.b=r.x=r.y=0;for(let r=0;r<e;r++)for(let i=0;i<s;i++){let m=l[r*s+i];m!=-1&&(n[m].l+=t.data[4*(r*s+i)],n[m].a+=t.data[4*(r*s+i)+1],n[m].b+=t.data[4*(r*s+i)+2],n[m].x+=r,n[m].y+=i,n[m].c+=1)}for(let r in n)n[r].c==0||n[r].x==null||n[r].y==null?n[r]=JSON.parse(JSON.stringify(h[r])):(n[r].l/=n[r].c,n[r].a/=n[r].c,n[r].b/=n[r].c,n[r].x=Math.floor(n[r].x/n[r].c),n[r].y=Math.floor(n[r].y/n[r].c))}return console.log("compute done............................."),{clusterID:l,centers:n}},rt=(t,a,u,o)=>{console.log("painting...................");let s=t.width,e=t.height,l=Math.ceil(e/o),n=Math.ceil(s/o),c=new Uint8ClampedArray(s*e*4);for(let d=0;d<l;d++)for(let h=0;h<n;h++){let r=d*o,i=h*o,m={};for(let f=r;f<r+o&&f<e;f++)for(let g=i;g<i+o&&g<s;g++){let M=u[f*s+g];M!=-1&&(m[M]?m[M]++:m[M]=1)}let b=-1,x=Number.MIN_VALUE;for(let f in m)m[f]>x&&(x=m[f],b=+f);for(let f=r;f<r+o&&f<e;f++)for(let g=i;g<i+o&&g<s;g++)c[4*(f*s+g)]=t.data[4*(a[b].x*s+a[b].y)],c[4*(f*s+g)+1]=t.data[4*(a[b].x*s+a[b].y)+1],c[4*(f*s+g)+2]=t.data[4*(a[b].x*s+a[b].y)+2],c[4*(f*s+g)+3]=t.data[4*(a[b].x*s+a[b].y)+3]}return console.log("painting done..................."),c},ot=(t,a,u)=>{let o=[-1,-1,0,1,1,1,0,-1],s=[0,-1,-1,-1,0,1,1,1],e=[],l=Array.from({length:u}).map(n=>n=Array.from({length:a}).map(c=>c=!1));for(let n=0;n<u;n++)for(let c=0;c<a;c++){let d=0;for(let h=0;h<8;h++){let r=n+o[h],i=c+s[h];r>=0&&r<u&&i>=0&&i<a&&l[r][i]==!1&&t[n*a+c]!=t[r*a+i]&&(d+=1)}d>=2&&(e.push({x:n,y:c}),l[n][c]=!0)}return e},ne=(t,a,u,o,s)=>{let e=t.width,l=t.height,n=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<e*l;i+=4){let m=tt(t.data[i],t.data[i+1],t.data[i+2]);n.data[i]=m.l,n.data[i+2]=m.a,n.data[i+3]=m.b}let{clusterID:c,centers:d}=nt(n,a,u,s),h=rt(t,d,c,o),r=ot(c,e,l);for(let i=0;i<r.length;i++){let m=4*(r[i].x*e+r[i].y);h[m]=255,h[m+1]=255,h[m+2]=255,h[m+3]=255}return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var se=(t,a)=>{let u=0;return N(t,o=>{let s=o.r,e=o.g,l=o.b,{h:n,s:c,v:d}=R(s/255,e/255,l/255),h=!1;for(let r of a.bands){let i=n>=r.hueMin/360&&n<=r.hueMax/360,m=d<=r.valueMax;if(h=i&&m,h)break}if(h)return o;{let r=.299*s+.587*e+.114*l;return{r,g:r,b:r,a:o.a}}})};var he=(t,a,u=20,o=24)=>{let{width:s,height:e}=t,l=new ImageData(s,e),n=Math.cos(a),c=Math.sin(a);for(let d=0;d<e;d++)for(let h=0;h<s;h++){let r=0,i=0,m=0,b=0;for(let f=0;f<o;f++){let g=f/(o-1)-.5,M=h+n*g*u,w=d+c*g*u,p=C(t,M,w);r+=p[0],i+=p[1],m+=p[2],b+=p[3]}let x=(d*s+h)*4;l.data[x]=r/o,l.data[x+1]=i/o,l.data[x+2]=m/o,l.data[x+3]=b/o}return l};var ie=(t,a,u,o=.5,s=32)=>{let{width:e,height:l}=t,n=new ImageData(e,l);for(let c=0;c<l;c++)for(let d=0;d<e;d++){let h=0,r=0,i=0,m=0,b=d-a,x=c-u;for(let g=0;g<s;g++){let w=(g/(s-1)-.5)*o,p=Math.sin(w),I=Math.cos(w),y=a+(b*I-x*p),D=u+(b*p+x*I),v=C(t,y,D);h+=v[0],r+=v[1],i+=v[2],m+=v[3]}let f=(c*e+d)*4;n.data[f]=h/s,n.data[f+1]=r/s,n.data[f+2]=i/s,n.data[f+3]=m/s}return n};var be=(t,a,u,o,s)=>{let{width:e,height:l}=t,n=new ImageData(e,l);for(let c=0;c<l;c++)for(let d=0;d<e;d++){let h=d-a,r=c-u,i=Math.sqrt(h*h+r*r);if(i<o){let m=(o-i)/o,b=s*m,x=Math.sin(b),f=Math.cos(b),g=a+h*f-r*x,M=u+h*x+r*f,w=C(t,g,M),p=(c*e+d)*4;n.data[p]=w[0],n.data[p+1]=w[1],n.data[p+2]=w[2],n.data[p+3]=w[3]}else{let m=(c*e+d)*4,b=m;n.data[m]=t.data[b],n.data[m+1]=t.data[b+1],n.data[m+2]=t.data[b+2],n.data[m+3]=t.data[b+3]}}return n};var pe=(t,a,u,o=6)=>{let{width:s,height:e}=t,l=new ImageData(s,e),n=2*Math.PI/o;for(let c=0;c<e;c++)for(let d=0;d<s;d++){let h=d-a,r=c-u,i=Math.atan2(r,h),m=Math.sqrt(h*h+r*r);i=i%n,i=Math.abs(i-n/2);let b=a+m*Math.cos(i),x=u+m*Math.sin(i),f=C(t,b,x),g=(c*s+d)*4;l.data[g]=f[0],l.data[g+1]=f[1],l.data[g+2]=f[2],l.data[g+3]=f[3]}return l};var P=new Worker(new URL("worker.js",import.meta.url)),st=(t,a,u)=>new Promise((o,s)=>{P.onmessage=e=>{o(e.data)},P.onerror=e=>{s(e)},P.postMessage({filter:t,imageData:a,options:u})}),Me=()=>new Proxy({},{get:(t,a)=>(u,o)=>st(a,u,o)});export{ne as SLIC,Mt as browniFilter,se as colourSplash,nt as computePixel,k as convolve,O as convolve2,ct as createCanvas,ht as crop,vt as dodgeFilter,Bt as embossFilter,et as findLocalMinimum,Nt as fishEyeFilter,q as gaussianBlur,Gt as glowFilter,B as greyScaleFilter,Yt as gridFilter,Rt as halftoneFilter,Ht as hatchFilter,_ as hshear,Jt as invertFilter,pe as kaleidoscopeFilter,wt as kodakChromeFilter,Ut as laplacianFilter,lt as loadImage,he as motionBlur,A as mult,Me as newWorker,yt as nightVisionFilter,G as numChannels,Kt as painterlyFilter,gt as polaroidFilter,ie as radialSpinBlur,tt as rgb2lab,R as rgbToHsv,C as sampleBilinear,xt as sepiaFilter,St as sharpenFilter,Qt as shearFilter,ee as sketchTransform,Ot as sobelFilter,be as swirlFilter,pt as technicolourFilter,dt as transform2Filter,N as transformFilter,mt as uniformBlur,It as vintageFilter,V as vshear};
