var q=t=>t.data.length/t.width/t.height,tt=async(t,r)=>{let l=new Image,s=document.createElement("canvas"),h=s.getContext("2d");return new Promise((d,e)=>{l.crossOrigin="",l.onerror=()=>{e(new Error("unable to load image"))},l.onload=()=>{l.width=r.width||l.naturalWidth,l.height=r.height||l.naturalHeight,s.width=l.width,s.height=l.height,h.drawImage(l,0,0,l.width,l.height);let o=h.getImageData(0,0,s.width,s.height);d(o)},l.src=t})},k=(t,r)=>{let l=t.width,s=t.height,h=4,n=new Uint8ClampedArray(l*s*h);for(let d=0;d<l*s;++d){let e=d*h;if(r){if(r.rFilter){let u=r.rFilter;if(t.data[e]>=u[0]&&t.data[e]<=u[1]){n[e]=t.data[e],n[e+1]=t.data[e+1],n[e+2]=t.data[e+2],n[e+3]=255;continue}}if(r.gFilter){let u=r.gFilter;if(t.data[e+1]>=u[0]&&t.data[e+1]<=u[1]){n[e]=t.data[e],n[e+1]=t.data[e+1],n[e+2]=t.data[e+2],n[e+3]=255;continue}}if(r.bFilter){let u=r.bFilter;if(t.data[e+2]>=u[0]&&t.data[e+2]<=u[1]){n[e]=t.data[e],n[e+1]=t.data[e+1],n[e+2]=t.data[e+2],n[e+3]=255;continue}}}let o=0;for(let u=0;u<h-1;u++)o+=t.data[e+u];o/=3;for(let u=0;u<h-1;u++)n[e+u]=o;n[e+h-1]=255}return new ImageData(new Uint8ClampedArray(n),l,s)},et=(t,r)=>{let l=t.width,s=4,h=[];for(let n=r.y;n<r.y+r.height;n++)for(let d=r.x;d<r.x+r.width;d++){let e=n*l*s+d*s;for(let o=0;o<s;o++)h.push(t.data[e+o])}return new ImageData(new Uint8ClampedArray(h),r.width,r.height)},at=(t,r)=>{if(t.data.length!==r.data.length)throw new Error("Bad dimension");let l=[];for(let s=0;s<t.data.length;s++){let h=Math.min(255,t.data[s]+r.data[s]);l.push(h)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)},nt=t=>{let r=[];for(let l=0;l<t.data.length;l++)l%4!=3?r.push(255-t.data[l]):r.push(t.data[l]);return new ImageData(new Uint8ClampedArray(r),t.width,t.height)},rt=(t,r)=>{let l=[];for(let s=0;s<t.data.length;s++){let h=t.data[s]/(255-r.data[s]);h>1&&(h=1),l.push(h*255)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var O=(t,r,l,s,h)=>{let n=Math.round(Math.sqrt(h.length)),d=Math.floor(n/2),e=r,o=l,u=e,c=o,a=[];for(let i=0;i<c;i++)for(let f=0;f<u;f++){let m=[];for(let p=0;p<s;p++)m.push(0);for(let p=0;p<n;p++)for(let b=0;b<n;b++){let x=i+p-d,w=f+b-d;if(x>=0&&x<o&&w>=0&&w<e){let g=(x*e+w)*s,M=h[p*n+b];for(let y=0;y<s;y++)m[y]+=t[g+y]*M}else for(let g=0;g<s;g++)m[g]+=t[(i*u+f)*s]*(1/h.length)*.28}for(let p=0;p<s;p++)a.push(m[p])}return a},F=(t,r)=>{let l=Math.round(Math.sqrt(r.length)),s=Math.floor(l/2),h=t.width,n=t.height,d=q(t),e=h,o=n,u=[];for(let c=0;c<o;c++)for(let a=0;a<e;a++){let i=[];for(let f=0;f<d;f++)i.push(0);for(let f=0;f<l;f++)for(let m=0;m<l;m++){let p=c+f-s,b=a+m-s;if(p>=0&&p<n&&b>=0&&b<h){let x=(p*h+b)*d,w=r[f*l+m];for(let g=0;g<d;g++)i[g]+=t.data[x+g]*w}else for(let x=0;x<d;x++)i[x]+=t.data[(c*e+a)*d]*(1/r.length)*.28}for(let f=0;f<d;f++)u.push(i[f])}return new ImageData(new Uint8ClampedArray(u),h,n)};var dt=t=>F(t,[0,-1,0,-1,5,-1,0,-1,0]),ut=t=>{let r=k(t);return F(r,[-2,-1,0,-1,1,1,0,1,2])},it=t=>{let r=[-1,-1,-1,-1,8,-1,-1,-1,-1],l=[],s=k(t);for(let d=0;d<s.data.length;d++)d%4==0&&l.push(t.data[d]);let h=O(l,t.width,t.height,1,r),n=[];for(let d=0;d<h.length;d++)n.push(h[d]),n.push(h[d]),n.push(h[d]),n.push(255);return new ImageData(new Uint8ClampedArray(n),t.width,t.height)},ft=t=>{let r=[-1,0,1,-2,0,2,-1,0,1],l=[-1,-2,-1,0,0,0,1,2,1],s=k(t),h=[];for(let o=0;o<s.data.length;o++)o%4==0&&h.push(s.data[o]);let n=O(h,t.width,t.height,1,r),d=O(h,t.width,t.height,1,l),e=[];for(let o=0;o<n.length;o++){let u=Math.sqrt(n[o]*n[o]+d[o]*d[o]);e.push(Math.min(255,u)),e.push(Math.min(255,u)),e.push(Math.min(255,u)),e.push(255)}return new ImageData(new Uint8ClampedArray(e),t.width,t.height)};var U=(t,r)=>{let l=t.width,s=t.height,h=4,n=[];console.log(t.data.length/l/s);for(let d=0;d<s;d++)for(let e=0;e<l;e++){let o=h*(d*l+e),u=t.data[o+0],c=t.data[o+1],a=t.data[o+2],i=t.data[o+3],f=u*r[0]+c*r[1]+a*r[2],m=u*r[3]+c*r[4]+a*r[5],p=u*r[6]+c*r[7]+a*r[8];n.push(f),n.push(m),n.push(p),n.push(i)}return new ImageData(new Uint8ClampedArray(n),l,s)},bt=t=>U(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),pt=t=>U(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),xt=t=>U(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),wt=t=>U(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),gt=t=>U(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]);var T=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],G=t=>F(t,T),vt=(t,r)=>{let l=[],s=r*r;for(let h=0;h<s;h++)l.push(1/s);return F(t,l)},At=t=>{let r=G(t);r=k(r);let l=[];for(let s=0;s<t.data.length;s++)if(s%4!=3){let h=Math.min(255,.5*r.data[s]+.9*t.data[s]);l.push(h)}else l.push(255);return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var L=(t,r,l)=>(t*.299+r*.587+l*.114)/255,kt=(t,r,l)=>{let s=t.width,h=t.height,n=4,d=[];for(let e=0;e<h;e++)for(let o=0;o<s;o++){let u=n*(e*s+o);e%r<l||o%r<l?(d.push(255),d.push(255),d.push(255),d.push(255)):(d.push(t.data[u+0]),d.push(t.data[u+1]),d.push(t.data[u+2]),d.push(255))}return new ImageData(new Uint8ClampedArray(d),t.width,t.height)},Ft=(t,r,l,s,h)=>{let n=t.width,d=t.height,e=4,o=[],u=10;for(let c=0;c<d;c++)for(let a=0;a<n;a++){let i=e*(c*n+a),f=t.data[i+0],m=t.data[i+1],p=t.data[i+2],b=L(f,m,p),x=245,w=245,g=245,M=6;b<r&&(a+c)%M==0&&(x=4*u,w=4*u,g=4*u),b<l&&(a-c)%M==0&&(x=4*u,w=4*u,g=4*u),b<s&&(a+c-5)%M==0&&(x=4*u,w=4*u,g=4*u),b<h&&(a-c-5)%M==0&&(x=8*u,w=8*u,g=8*u),o.push(x),o.push(w),o.push(g),o.push(255)}return new ImageData(new Uint8ClampedArray(o),t.width,t.height)},St=(t,r,l,s,h)=>{let n=t.width,d=t.height,e=4,o=[];for(let u=0;u<d;u++)for(let c=0;c<n;c++){let a=c-r,i=u-l,f=Math.sqrt(a*a+i*i);if(f<s){let m=Math.floor(r+a*h*f),p=Math.floor(l+i*h*f),b=e*(p*n+m);o.push(t.data[b]),o.push(t.data[b+1]),o.push(t.data[b+2]),o.push(255)}else{let m=e*(u*n+c);o.push(t.data[m]),o.push(t.data[m+1]),o.push(t.data[m+2]),o.push(t.data[m+3])}}return new ImageData(new Uint8ClampedArray(o),t.width,t.height)},Ut=(t,r,l)=>{let s=t.width,h=t.height,n=4,d=new Uint8ClampedArray(t.data);for(let e=r;e<h-r;e++)for(let o=r;o<s-r;o++){let u=[],c=[],a=[],i=[];for(let b=0;b<l;b++)u.push(0),c.push(0),a.push(0),i.push(0);for(let b=-r;b<=r;b++)for(let x=-r;x<=r;x++){let w=n*((e+b)*s+(o+x)),g=t.data[w+0],M=t.data[w+1],y=t.data[w+2],I=Math.floor((g+M+y)/3*l/255);u[I]++,c[I]+=g,a[I]+=M,i[I]+=y}let f=0,m=0;for(let b=0;b<l;b++)u[b]>f&&(f=u[b],m=b);let p=n*(e*s+o);d[p+0]=c[m]/f,d[p+1]=a[m]/f,d[p+2]=i[m]/f}return new ImageData(d,s,h)};var P=(t,r,l)=>{let s=t/255,h=r/255,n=l/255,d,e,o;s<=.04045?d=s/12.92:d=Math.pow((s+.055)/1.055,2.4),h<=.04045?e=h/12.92:e=Math.pow((h+.055)/1.055,2.4),n<=.04045?o=n/12.92:o=Math.pow((n+.055)/1.055,2.4);let u,c,a;u=d*.4124564+e*.3575761+o*.1804375,c=d*.2126729+e*.7151522+o*.072175,a=d*.0193339+e*.119192+o*.9503041;let i=.008856,f=903.3,m=.950456,p=1,b=1.088754,x=u/m,w=c/p,g=a/b,M,y,I;x>i?M=Math.pow(x,1/3):M=(f*x+16)/116,w>i?y=Math.pow(w,1/3):y=(f*w+16)/116,g>i?I=Math.pow(g,1/3):I=(f*g+16)/116;let D=116*y-16,A=500*(M-y),C=200*(y-I);return{l:D,a:A,b:C}},_=(t,r,l)=>{let s=Number.MAX_VALUE,h={x:0,y:0,l:0,a:0,b:0},n=t.width,d=t.height;for(let e=r-1;e<=r+1&&e>=0&&e<d-1;e++)for(let o=l-1;o<=l+1&&o>=0&&o<n-1;o++){let u=t.data[4*(e*n+o+1)],c=t.data[4*((e+1)*n+o+1)],a=t.data[4*(e*n+o)];Math.sqrt(Math.pow(u-a,2))+Math.sqrt(Math.pow(c-a,2))<s&&(s=Math.abs(u-a)+Math.abs(c-a),h.x=e,h.y=o)}return h},$=(t,r,l,s,h,n)=>{let d=t.width,e=Math.sqrt(Math.pow(r.l-t.data[4*(l*d+s)],2)+Math.pow(r.a-t.data[4*(l*d+s)+1],2)+Math.pow(r.b-t.data[4*(l*d+s)+2],2)),o=Math.sqrt(Math.pow(r.x-l,2)+Math.pow(r.y-s,2));return Math.pow(e/n,2)+Math.pow(o/h,2)},X=(t,r,l,s)=>{console.log("computing.............................");let h=t.width,n=t.height,d=Array.from({length:h*n}).map(o=>o=-1),e=new Array;for(let o=r;o<n;o+=r)for(let u=r;u<h;u+=r){let c=_(t,o,u);c.l=t.data[4*(c.x*h+c.y)],c.a=t.data[4*(c.x*h+c.y)+1],c.b=t.data[4*(c.x*h+c.y)+2],e.push(c)}for(let o=0;o<l;o++){let u=Array.from({length:h*n}).map(a=>a=Number.MAX_VALUE);for(let a=0;a<e.length;a++)for(let i=e[a].x-r;i<e[a].x+r;i++)for(let f=e[a].y-r;f<e[a].y+r;f++)if(i>=0&&i<n&&f>=0&&f<h){let m=$(t,e[a],i,f,r,s);m<u[i*h+f]&&(u[i*h+f]=m,d[i*h+f]=a)}let c=JSON.parse(JSON.stringify(e));for(let a of e)a.c=a.l=a.a=a.b=a.x=a.y=0;for(let a=0;a<n;a++)for(let i=0;i<h;i++){let f=d[a*h+i];f!=-1&&(e[f].l+=t.data[4*(a*h+i)],e[f].a+=t.data[4*(a*h+i)+1],e[f].b+=t.data[4*(a*h+i)+2],e[f].x+=a,e[f].y+=i,e[f].c+=1)}for(let a in e)e[a].c==0||e[a].x==null||e[a].y==null?e[a]=JSON.parse(JSON.stringify(c[a])):(e[a].l/=e[a].c,e[a].a/=e[a].c,e[a].b/=e[a].c,e[a].x=Math.floor(e[a].x/e[a].c),e[a].y=Math.floor(e[a].y/e[a].c))}return console.log("compute done............................."),{clusterID:d,centers:e}},J=(t,r,l,s)=>{console.log("painting...................");let h=t.width,n=t.height,d=Math.ceil(n/s),e=Math.ceil(h/s),o=new Uint8ClampedArray(h*n*4);for(let u=0;u<d;u++)for(let c=0;c<e;c++){let a=u*s,i=c*s,f={};for(let b=a;b<a+s&&b<n;b++)for(let x=i;x<i+s&&x<h;x++){let w=l[b*h+x];w!=-1&&(f[w]?f[w]++:f[w]=1)}let m=-1,p=Number.MIN_VALUE;for(let b in f)f[b]>p&&(p=f[b],m=+b);for(let b=a;b<a+s&&b<n;b++)for(let x=i;x<i+s&&x<h;x++)o[4*(b*h+x)]=t.data[4*(r[m].x*h+r[m].y)],o[4*(b*h+x)+1]=t.data[4*(r[m].x*h+r[m].y)+1],o[4*(b*h+x)+2]=t.data[4*(r[m].x*h+r[m].y)+2],o[4*(b*h+x)+3]=t.data[4*(r[m].x*h+r[m].y)+3]}return console.log("painting done..................."),o},V=(t,r,l)=>{let s=[-1,-1,0,1,1,1,0,-1],h=[0,-1,-1,-1,0,1,1,1],n=[],d=Array.from({length:l}).map(e=>e=Array.from({length:r}).map(o=>o=!1));for(let e=0;e<l;e++)for(let o=0;o<r;o++){let u=0;for(let c=0;c<8;c++){let a=e+s[c],i=o+h[c];a>=0&&a<l&&i>=0&&i<r&&d[a][i]==!1&&t[e*r+o]!=t[a*r+i]&&(u+=1)}u>=2&&(n.push({x:e,y:o}),d[e][o]=!0)}return n},Ot=(t,r,l,s,h)=>{let n=t.width,d=t.height,e=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<n*d;i+=4){let f=P(t.data[i],t.data[i+1],t.data[i+2]);e.data[i]=f.l,e.data[i+2]=f.a,e.data[i+3]=f.b}let{clusterID:o,centers:u}=X(e,r,l,h),c=J(t,u,o,s),a=V(o,n,d);for(let i=0;i<a.length;i++){let f=4*(a[i].x*n+a[i].y);c[f]=255,c[f+1]=255,c[f+2]=255,c[f+3]=255}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var Y=(t,r,l)=>{let s=t.width,h=t.height,n=new ImageData(new Uint8ClampedArray(t.data),s,h),d=Math.floor(Math.random()*l),e=0,o=!1;for(let u=0;u<s;u++){if(e++,o){for(let c=0;c<h-d;c++){let a=4*(c*s+u),i=4*((c+d)*s+u);n.data[a]=t.data[i],n.data[a+1]=t.data[i+1],n.data[a+2]=t.data[i+2],n.data[a+3]=t.data[i+3]}for(let c=h-d;c<h;c++){let a=4*(c*s+u);n.data[a]=255,n.data[a+1]=255,n.data[a+2]=255,n.data[a+3]=255}}else{for(let c=0;c<d;c++){let a=4*(c*s+u);n.data[a]=255,n.data[a+1]=255,n.data[a+2]=255,n.data[a+3]=255}for(let c=d;c<h;c++){let a=4*(c*s+u),i=4*((c-d)*s+u);n.data[a]=t.data[i],n.data[a+1]=t.data[i+1],n.data[a+2]=t.data[i+2],n.data[a+3]=t.data[i+3]}}e==r&&(d=Math.floor(Math.random()*l),o=!o,e=0)}return n},W=(t,r,l)=>{let s=t.width,h=t.height,n=new ImageData(new Uint8ClampedArray(t.data),s,h),d=Math.floor(Math.random()*l),e=0,o=!1;for(let u=0;u<h;u++){if(e++,o){for(let c=0;c<s-d;c++){let a=4*(u*s+c),i=4*(u*s+c+d);n.data[a]=t.data[i],n.data[a+1]=t.data[i+1],n.data[a+2]=t.data[i+2],n.data[a+3]=t.data[i+3]}for(let c=s-d;c<s;c++){let a=4*(u*s+c);n.data[a]=255,n.data[a+1]=255,n.data[a+2]=255,n.data[a+3]=255}}else{for(let c=d;c<s;c++){let a=4*(u*s+c),i=4*(u*s+c-d);n.data[a]=t.data[i],n.data[a+1]=t.data[i+1],n.data[a+2]=t.data[i+2],n.data[a+3]=t.data[i+3]}for(let c=0;c<d;c++){let a=4*(u*s+c);n.data[a]=255,n.data[a+1]=255,n.data[a+2]=255,n.data[a+3]=255}}e==r&&(d=Math.floor(Math.random()*l),o=!o,e=0)}return n},Nt=(t,r,l,s,h)=>{let n=W(t,r,l);return Y(n,s,h)};var Rt=function(){function t(r,l){this.levelSteps=2,this.textureCanvases=null,this.lineThickness=1,this.maxTextures=NaN,this.lineLength=Math.sqrt(r*l)*.2,this.darkeningFactor=.1,this.lineAlpha=.1,this.lineDensity=.5,this.lightness=4,this.edgeBlurAmount=4,this.edgeAmount=.5}return t}(),Et=(t,r)=>{let l=t.width,s=t.height,h=t.data,n=performance.now(),d=new Set,e=[];for(let i=0;i<l;i++)for(let f=0;f<s;f++){let m=(i+f*l)*4,p=h[m]+":"+h[m+1]+":"+h[m+2];d.has(p)||(d.add(p),e.push([h[m+0],h[m+1],h[m+2]]))}let o={};for(;;){let i=r.levelSteps;o={};for(let m of e){let p=m[0],b=m[1],x=m[2],w=Math.round(p/255*(i-1)),g=Math.round(b/255*(i-1)),M=Math.round(x/255*(i-1));for(let y=-1;y<=1;y++)for(let I=-1;I<=1;I++)for(let D=-1;D<=1;D++){let A=w+y+":"+(g+I)+":"+(M+D);o[A]=!0}}console.log(Object.keys(o).length+" required colour levels");let f=NaN;if(Object.keys(o).length>f&&r.levelSteps>2){r.levelSteps--,console.log("Reducing to "+r.levelSteps+" RGB steps");continue}break}let u=performance.now();console.log(">>>>>>>>>>>>>>>>>",u-n);let{canvases:c,imageDatas:a}=H(l,s,o,r);return Z(t,a,r)},Z=(t,r,l)=>{let s=t.width,h=t.height,n=t.data,d=[];for(let e=0;e<s;e++)for(let o=0;o<h;o++){let u=e+o*s;d[u*3]=n[u*4],d[u*3+1]=n[u*4+1],d[u*3+2]=n[u*4+2]}d=z(d,{width:s,height:h,blurAmount:l.edgeBlurAmount});for(let e=0;e<s;e++)for(let o=0;o<h;o++){let u=e+o*s,c=n[u*4],a=n[u*4+1],i=n[u*4+2],f=K(r,u,c,a,i,l.levelSteps);if(l.greyScale){let p=Math.round((f.red+f.green+f.blue)/3);f.red=f.green=f.blue=p}let m=Math.max(0,(255-d[e+o*s]*l.edgeAmount)/255);m=Math.min(1,Math.max(.5,m*m)),n[u*4]=Math.round(f.red*m),n[u*4+1]=Math.round(f.green*m),n[u*4+2]=Math.round(f.blue*m)}return t},H=(t,r,l,s)=>{let h=performance.now(),n=s.levelSteps,d=[],e=[],o=s.lineThickness,u=s.lineLength,c=1-s.darkeningFactor,a=s.lineAlpha,i=s.lineDensity*2,f=s.lightness;for(let p=-1;p<=n;p++){d[p]={},e[p]={};for(let b=-1;b<=n;b++)d[p][b]={},e[p][b]={}}for(let p in l){let b=p.split(":"),x=parseInt(b[0]),w=parseInt(b[1]),g=parseInt(b[2]),M=255*x/(n-1),y=255*w/(n-1),I=255*g/(n-1);M=Math.min(255,Math.max(0,M)),y=Math.min(255,Math.max(0,y)),I=Math.min(255,Math.max(0,I));let D=1-Math.min(M,y,I)/255,A="";if(D>0){let v=Math.pow(1/D,1/f),S=Math.round((255-(255-M)*v)*c),B=Math.round((255-(255-y)*v)*c),E=Math.round((255-(255-I)*v)*c);A=`rgb(${S}, ${B}, ${E})`}else{let v=Math.round(M*c),S=Math.round(y*c),B=Math.round(I*c);A=`rgb(${v}, ${S}, ${B})`}let C=0,j=0;if(Math.abs(y-I)>.1||Math.abs(2*M-y-I)>.1){j=Math.atan2(Math.sqrt(3)*(y-I),2*M-y-I);let v=Math.max(255-M,255-y,255-I),S=Math.min(255-M,255-y,255-I);C=(v-S)/v,C==0&&(j=Math.random()*Math.PI*2)}else j=0,C=0;let R=Math.PI*(.1+.9*Math.pow(1-C,3)),N=Q(t,r,j/2+Math.PI*.3,R,o,u,D*i,A,a);d[x][w][g]=N,e[x][w][g]=N.getContext("2d").getImageData(0,0,t,r)}let m=performance.now();return console.log("create textures....",m-h),{canvases:d,imageDatas:e}},K=(t,r,l,s,h,n)=>{r*=4;let d=l/255*(n-1),e=s/255*(n-1),o=h/255*(n-1),u=d,c=e,a=o;d=Math.round(d),e=Math.round(e),o=Math.round(o);let i=0;for(let x=-1;x<=1;x++)for(let w=-1;w<=1;w++)for(let g=-1;g<=1;g++){let M=(.75-Math.abs(d+x-u)/2)*(.75-Math.abs(e+w-c)/2)*(.75-Math.abs(o+g-a)/2);if(M<0)throw new Error("debug");i+=M}let f=0,m=0,p=0;for(let x=-1;x<=1;x++)for(let w=-1;w<=1;w++)for(let g=-1;g<=1;g++){let M=(.75-Math.abs(d+x-u)/2)*(.75-Math.abs(e+w-c)/2)*(.75-Math.abs(o+g-a)/2);M/=i;let y=t[d+x][e+w][o+g];if(y==null)throw new Error("debug me!");f+=y.data[r]*M,m+=y.data[r+1]*M,p+=y.data[r+2]*M}let b=1-(1-(n+1)/n)*.25;return{red:Math.min(255,Math.round(f*b)),green:Math.min(255,Math.round(m*b)),blue:Math.min(255,Math.round(p*b))}},Q=(t,r,l,s,h,n,d,e,o)=>{let u=d*t*r/n/h/o,c=document.createElement("canvas");c.width=t,c.height=r;let a=c.getContext("2d");a.strokeStyle=e,a.globalAlpha=1,a.fillStyle="#FFFFFF",a.fillRect(0,0,t,r),a.globalAlpha=o,a.lineWidth=h;for(let i=0;i<u;i++){let f=l+Math.round(Math.random()*2-1)/2*s,m=Math.random()*t,p=Math.random()*r,b=n/2*Math.cos(f),x=n/2*Math.sin(f),w=m+b,g=m-b,M=p+x,y=p-x;a.beginPath(),a.moveTo(w,M),a.lineTo(g,y),a.stroke()}return c},z=(t,r)=>{let l=r.width,s=r.height,h=r.blurAmount,n=[],d=[];for(let c=0;c<l;c++){let a=[0,0,0],i=[0,0,0];for(let f=0;f<s;f++){let m=c+f*l;a[0]+=t[m*3+0],a[1]+=t[m*3+1],a[2]+=t[m*3+2],i[0]+=t[m*3+0]*t[m*3+0],i[1]+=t[m*3+1]*t[m*3+1],i[2]+=t[m*3+2]*t[m*3+2],n[m]=a.slice(0),d[m]=i.slice(0)}}let e=[],o=[];for(let c=0;c<s;c++){let a=[0,0,0],i=[0,0,0];for(let f=0;f<l;f++){let m=f+c*l,p=f+Math.max(0,Math.round(c-h/2))*l,b=f+Math.min(s-1,Math.round(c+h/2))*l;a[0]+=(n[b][0]-n[p][0])/(b-p)*l,a[1]+=(n[b][1]-n[p][1])/(b-p)*l,a[2]+=(n[b][2]-n[p][2])/(b-p)*l,i[0]+=(d[b][0]-d[p][0])/(b-p)*l,i[1]+=(d[b][1]-d[p][1])/(b-p)*l,i[2]+=(d[b][2]-d[p][2])/(b-p)*l,e[m]=a.slice(0),o[m]=i.slice(0)}}let u=[];for(let c=0;c<l;c++)for(let a=0;a<s;a++){let i=c+a*l,f=Math.max(0,Math.round(c-h/2))+a*l,m=Math.min(l-1,Math.round(c+h/2))+a*l,p=(e[m][0]-e[f][0])/(m-f),b=(e[m][1]-e[f][1])/(m-f),x=(e[m][2]-e[f][2])/(m-f),w=(o[m][0]-o[f][0])/(m-f),g=(o[m][1]-o[f][1])/(m-f),M=(o[m][2]-o[f][2])/(m-f);u[i]=Math.sqrt(w+g+M-(p*p+b*b+x*x)),isNaN(u[i])&&(u[i]=0)}return u};export{Ot as SLIC,Rt as Sketcher,X as computePixel,et as crop,rt as dodge,ut as embossFilter,_ as findLocalMinimum,St as fishEyeFilter,G as gaussianBlur,At as glowFilter,k as greyScale,kt as gridFilter,Ft as hatchFilter,W as hshear,at as impose,nt as invert,wt as kodakChromeFilter,it as laplacianFilter,tt as loadImage,q as numChannels,Ut as painterlyFilter,pt as polaroidfilter,P as rgb2lab,bt as sepiaFilter,dt as sharpenFilter,Nt as shearAll,Et as sketchTransform,ft as sobelFilter,xt as technicolourfilter,vt as uniformBlur,gt as vintageFilter,Y as vshear};
