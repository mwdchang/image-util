var X=t=>t.data.length/t.width/t.height,ot=async(t,a)=>{let u=new Image,o=document.createElement("canvas"),s=o.getContext("2d");return new Promise((h,n)=>{u.crossOrigin="",u.onerror=()=>{n(new Error("unable to load image"))},u.onload=()=>{u.width=a.width||u.naturalWidth,u.height=a.height||u.naturalHeight,o.width=u.width,o.height=u.height,s.drawImage(u,0,0,u.width,u.height);let l=s.getImageData(0,0,o.width,o.height);h(l)},u.src=t})},st=t=>{let a=document.createElement("canvas");return a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0),a},lt=(t,a)=>{let u=t.width,o=4,s=a.width,e=a.height,h=new Uint8ClampedArray(s*e*o),n=0;for(let l=a.y;l<a.y+a.height;l++)for(let d=a.x;d<a.x+a.width;d++){let c=l*u*o+d*o;for(let r=0;r<o;r++)h[n++]=t.data[c+r]}return new ImageData(h,s,e)},j=(t,a)=>{let u=t.data.length,o=new Uint8ClampedArray(u);for(let s=0;s<u;s+=4){let e=a({r:t.data[s+0],g:t.data[s+1],b:t.data[s+2],a:t.data[s+3]});o[s+0]=e.r,o[s+1]=e.g,o[s+2]=e.b,o[s+3]=e.a}return new ImageData(o,t.width,t.height)},ct=(t,a,u)=>{if(t.data.length!==a.data.length)throw new Error("images need to be same length");let o=t.data.length,s=new Uint8ClampedArray(o);for(let e=0;e<o;e+=4){let h=u({r:t.data[e+0],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]},{r:a.data[e+0],g:a.data[e+1],b:a.data[e+2],a:a.data[e+3]});s[e+0]=h.r,s[e+1]=h.g,s[e+2]=h.b,s[e+3]=h.a}return new ImageData(s,t.width,t.height)},F=(t,a)=>{let{width:u,height:o,data:s}=t,e=X(t),h=U(Array.from(s),u,o,e,a);return new ImageData(new Uint8ClampedArray(h),u,o)},U=(t,a,u,o,s)=>{let e=Math.round(Math.sqrt(s.length)),h=Math.floor(e/2),n=a,l=u,d=n,c=l,r=[],i=1/s.length*.28;for(let m=0;m<c;m++)for(let b=0;b<d;b++){let x=[];for(let f=0;f<o;f++)x.push(0);for(let f=0;f<e;f++)for(let p=0;p<e;p++){let w=m+f-h,M=b+p-h;if(w>=0&&w<l&&M>=0&&M<n){let g=(w*n+M)*o,I=s[f*e+p];for(let y=0;y<o;y++)x[y]+=t[g+y]*I}else for(let g=0;g<o;g++)x[g]+=t[(m*d+b)*o]*i}for(let f=0;f<o;f++)r.push(x[f])}return r},C=(t,a)=>{let u=t.width,o=t.height,s=4,e=[];for(let h=0;h<o;h++)for(let n=0;n<u;n++){let l=s*(h*u+n),d=t.data[l+0],c=t.data[l+1],r=t.data[l+2],i=t.data[l+3],m=d*a[0]+c*a[1]+r*a[2],b=d*a[3]+c*a[4]+r*a[5],x=d*a[6]+c*a[7]+r*a[8];e.push(m),e.push(b),e.push(x),e.push(i)}return new ImageData(new Uint8ClampedArray(e),u,o)},R=(t,a,u)=>{let o=Math.max(t,a,u),s=Math.min(t,a,u),e=o-s,h=0;e!==0&&(o===t?h=((a-u)/e+(a<u?6:0))/6:o===a?h=((u-t)/e+2)/6:h=((t-a)/e+4)/6);let n=o===0?0:e/o;return{h,s:n,v:o}},N=(t,a,u)=>{let{width:o,height:s,data:e}=t;if(e.length/o/s!==4)throw new Error("Only support rgba channels currently...");let n=Math.max(0,Math.min(o-1,a)),l=Math.max(0,Math.min(s-1,u)),d=Math.floor(n),c=Math.floor(l),r=Math.min(d+1,o-1),i=Math.min(c+1,s-1),m=n-d,b=l-c;function x(y,D){let v=(D*o+y)*4;return[e[v],e[v+1],e[v+2],e[v+3]]}let f=x(d,c),p=x(r,c),w=x(d,i),M=x(r,i),g=f.map((y,D)=>y*(1-m)+p[D]*m),I=w.map((y,D)=>y*(1-m)+M[D]*m);return g.map((y,D)=>y*(1-b)+I[D]*b)};var ut=(t,a)=>{let u=[],o=a*a;for(let s=0;s<o;s++)u.push(1/o);return F(t,u)};var ft=t=>C(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),bt=t=>C(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),xt=t=>C(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),pt=t=>C(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),gt=t=>C(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),wt=t=>C(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]),Mt=t=>C(t,[.1,.4,.1,.2,.8,.2,.1,.4,.1]);var yt=(t,a)=>{let u=[];for(let o=0;o<t.data.length;o++){let s=t.data[o]/(255-a.data[o]);s>1&&(s=1),u.push(s*255)}return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var S=(t,a)=>{let u=t.width,o=t.height,s=4,e=new Uint8ClampedArray(u*o*s);for(let h=0;h<u*o;++h){let n=h*s;if(a){if(a.rFilter){let d=a.rFilter;if(t.data[n]>=d[0]&&t.data[n]<=d[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}if(a.gFilter){let d=a.gFilter;if(t.data[n+1]>=d[0]&&t.data[n+1]<=d[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}if(a.bFilter){let d=a.bFilter;if(t.data[n+2]>=d[0]&&t.data[n+2]<=d[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}}let l=0;for(let d=0;d<s-1;d++)l+=t.data[n+d];l/=3;for(let d=0;d<s-1;d++)e[n+d]=l;e[n+s-1]=255}return new ImageData(new Uint8ClampedArray(e),u,o)};var Ft=t=>F(t,[0,-1,0,-1,5,-1,0,-1,0]),kt=t=>{let a=S(t);return F(a,[-2,-1,0,-1,1,1,0,1,2])},St=t=>{let a=[-1,-1,-1,-1,8,-1,-1,-1,-1],u=[],o=S(t);for(let h=0;h<o.data.length;h++)h%4===0&&u.push(t.data[h]);let s=U(u,t.width,t.height,1,a),e=[];for(let h=0;h<s.length;h++)e.push(s[h]),e.push(s[h]),e.push(s[h]),e.push(255);return new ImageData(new Uint8ClampedArray(e),t.width,t.height)},Bt=t=>{let a=[-1,0,1,-2,0,2,-1,0,1],u=[-1,-2,-1,0,0,0,1,2,1],o=S(t),s=[];for(let l=0;l<o.data.length;l++)l%4===0&&s.push(o.data[l]);let e=U(s,t.width,t.height,1,a),h=U(s,t.width,t.height,1,u),n=[];for(let l=0;l<e.length;l++){let d=Math.sqrt(e[l]*e[l]+h[l]*h[l]);n.push(Math.min(255,d)),n.push(Math.min(255,d)),n.push(Math.min(255,d)),n.push(255)}return new ImageData(new Uint8ClampedArray(n),t.width,t.height)};var Ot=(t,a,u,o,s)=>{let e=t.width,h=t.height,n=4,l=[];for(let d=0;d<h;d++)for(let c=0;c<e;c++){let r=c-a,i=d-u,m=Math.sqrt(r*r+i*i);if(m<o){let b=Math.floor(a+r*s*m),x=Math.floor(u+i*s*m),f=n*(x*e+b);l.push(t.data[f]),l.push(t.data[f+1]),l.push(t.data[f+2]),l.push(255)}else{let b=n*(d*e+c);l.push(t.data[b]),l.push(t.data[b+1]),l.push(t.data[b+2]),l.push(t.data[b+3])}}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var G=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],E=t=>F(t,G);var Y=(t,a,u)=>`rgb(${t},${a},${u})`,L=(t,a,u,o)=>{let{width:s,data:e}=t,h=o.kernel,n=h*h,l=0,d=0,c=0;for(let x=u;x<u+h;x++)for(let f=a;f<a+h;f++){let p=(x*s+f)*4;l+=e[p]||0,d+=e[p+1]||0,c+=e[p+2]||0}let r=(o.rWeight*l+o.gWeight*d+o.bWeight*c)/(255*n),i=l/n,m=d/n,b=c/n;return{v:r,avgR:i,avgG:m,avgB:b}},Tt=(t,a)=>{let u=a.kernel,o=t.width,s=t.height;a.rWeight||(a.rWeight=.2),a.gWeight||(a.gWeight=.2),a.bWeight||(a.bWeight=.2);let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let h=e.getContext("2d"),n=(u-1)*.5;for(let l=0;l<=s-u;l+=u)for(let d=0;d<=o-u;d+=u){let{v:c,avgR:r,avgG:i,avgB:m}=L(t,d,l,a),b=u/2*(1-c),x=0;a.shiftYAmt&&a.shiftYStride&&(x=d%(a.shiftYStride*u)===0?0:a.shiftYAmt);let f=0;a.shiftXAmt&&a.shiftXStride&&(x=d%(a.shiftXStride*u)===0?0:a.shiftXAmt),h.beginPath(),h.fillStyle=Y(r,i,m),h.ellipse(f+d+n,x+l+n,b,b,0,0,2*Math.PI),h.fill(),h.closePath()}return h.getImageData(0,0,o,s)};var Pt=t=>{let a=E(t);a=S(a);let u=[];for(let o=0;o<t.data.length;o++)if(o%4!==3){let s=Math.min(255,.5*a.data[o]+.9*t.data[o]);u.push(s)}else u.push(255);return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var Gt=(t,a,u)=>{let o=t.width,s=t.height,e=4,h=[];for(let n=0;n<s;n++)for(let l=0;l<o;l++){let d=e*(n*o+l);n%a<u||l%a<u?(h.push(255),h.push(255),h.push(255),h.push(255)):(h.push(t.data[d+0]),h.push(t.data[d+1]),h.push(t.data[d+2]),h.push(255))}return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var $=(t,a,u)=>(t*.299+a*.587+u*.114)/255,Lt=(t,a,u,o,s)=>{let e=t.width,h=t.height,n=4,l=[],d=10;for(let c=0;c<h;c++)for(let r=0;r<e;r++){let i=n*(c*e+r),m=t.data[i+0],b=t.data[i+1],x=t.data[i+2],f=$(m,b,x),p=245,w=245,M=245,g=6;f<a&&(r+c)%g===0&&(p=4*d,w=4*d,M=4*d),f<u&&(r-c)%g===0&&(p=4*d,w=4*d,M=4*d),f<o&&(r+c-5)%g===0&&(p=4*d,w=4*d,M=4*d),f<s&&(r-c-5)%g===0&&(p=8*d,w=8*d,M=8*d),l.push(p),l.push(w),l.push(M),l.push(255)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var Vt=t=>j(t,a=>({r:255-a.r,g:255-a.g,b:255-a.b,a:a.a}));var Jt=(t,a,u)=>{let o=t.width,s=t.height,e=4,h=new Uint8ClampedArray(t.data);for(let n=a;n<s-a;n++)for(let l=a;l<o-a;l++){let d=[],c=[],r=[],i=[];for(let f=0;f<u;f++)d.push(0),c.push(0),r.push(0),i.push(0);for(let f=-a;f<=a;f++)for(let p=-a;p<=a;p++){let w=e*((n+f)*o+(l+p)),M=t.data[w+0],g=t.data[w+1],I=t.data[w+2],y=Math.floor((M+g+I)/3*u/255);d[y]++,c[y]+=M,r[y]+=g,i[y]+=I}let m=0,b=0;for(let f=0;f<u;f++)d[f]>m&&(m=d[f],b=f);let x=e*(n*o+l);h[x+0]=c[b]/m,h[x+1]=r[b]/m,h[x+2]=i[b]/m}return new ImageData(h,o,s)};var H=(t,a,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),h=Math.floor(Math.random()*u),n=0,l=!1;for(let d=0;d<o;d++){if(n++,l){for(let c=0;c<s-h;c++){let r=4*(c*o+d),i=4*((c+h)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let c=s-h;c<s;c++){let r=4*(c*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let c=0;c<h;c++){let r=4*(c*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}for(let c=h;c<s;c++){let r=4*(c*o+d),i=4*((c-h)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}}n==a&&(h=Math.floor(Math.random()*u),l=!l,n=0)}return e},V=(t,a,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),h=Math.floor(Math.random()*u),n=0,l=!1;for(let d=0;d<s;d++){if(n++,l){for(let c=0;c<o-h;c++){let r=4*(d*o+c),i=4*(d*o+c+h);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let c=o-h;c<o;c++){let r=4*(d*o+c);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let c=h;c<o;c++){let r=4*(d*o+c),i=4*(d*o+c-h);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let c=0;c<h;c++){let r=4*(d*o+c);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}n==a&&(h=Math.floor(Math.random()*u),l=!l,n=0)}return e},Kt=(t,a,u,o,s)=>{let e=V(t,a,u);return H(e,o,s)};var Qt=(t,a)=>{let u=t.width,o=t.height,s=t.data,e=new Set,h=[];for(let c=0;c<u;c++)for(let r=0;r<o;r++){let i=(c+r*u)*4,m=s[i]+":"+s[i+1]+":"+s[i+2];e.has(m)||(e.add(m),h.push([s[i+0],s[i+1],s[i+2]]))}let n={};for(;;){let c=a.levelSteps;n={};for(let i of h){let m=i[0],b=i[1],x=i[2],f=Math.round(m/255*(c-1)),p=Math.round(b/255*(c-1)),w=Math.round(x/255*(c-1));for(let M=-1;M<=1;M++)for(let g=-1;g<=1;g++)for(let I=-1;I<=1;I++){let y=f+M+":"+(p+g)+":"+(w+I);n[y]=!0}}if(Object.keys(n).length>NaN&&a.levelSteps>2){a.levelSteps--,console.log("Reducing to "+a.levelSteps+" RGB steps");continue}break}let{canvases:l,imageDatas:d}=J(u,o,n,a);return _(t,d,a)},_=(t,a,u)=>{let o=t.width,s=t.height,e=t.data,h=[];for(let n=0;n<o;n++)for(let l=0;l<s;l++){let d=n+l*o;h[d*3]=e[d*4],h[d*3+1]=e[d*4+1],h[d*3+2]=e[d*4+2]}h=z(h,{width:o,height:s,blurAmount:u.edgeBlurAmount});for(let n=0;n<o;n++)for(let l=0;l<s;l++){let d=n+l*o,c=e[d*4],r=e[d*4+1],i=e[d*4+2],m=Z(a,d,c,r,i,u.levelSteps);if(u.greyScale){let x=Math.round((m.red+m.green+m.blue)/3);m.red=m.green=m.blue=x}let b=Math.max(0,(255-h[n+l*o]*u.edgeAmount)/255);b=Math.min(1,Math.max(.5,b*b)),e[d*4]=Math.round(m.red*b),e[d*4+1]=Math.round(m.green*b),e[d*4+2]=Math.round(m.blue*b)}return t},J=(t,a,u,o)=>{let s=performance.now(),e=o.levelSteps,h=[],n=[],l=o.lineThickness,d=o.lineLength,c=1-o.darkeningFactor,r=o.lineAlpha,i=o.lineDensity*2,m=o.lightness;for(let x=-1;x<=e;x++){h[x]={},n[x]={};for(let f=-1;f<=e;f++)h[x][f]={},n[x][f]={}}for(let x in u){let f=x.split(":"),p=parseInt(f[0]),w=parseInt(f[1]),M=parseInt(f[2]),g=255*p/(e-1),I=255*w/(e-1),y=255*M/(e-1);g=Math.min(255,Math.max(0,g)),I=Math.min(255,Math.max(0,I)),y=Math.min(255,Math.max(0,y));let D=1-Math.min(g,I,y)/255,v="";if(D>0){let A=Math.pow(1/D,1/m),B=Math.round((255-(255-g)*A)*c),W=Math.round((255-(255-I)*A)*c),P=Math.round((255-(255-y)*A)*c);v=`rgb(${B}, ${W}, ${P})`}else{let A=Math.round(g*c),B=Math.round(I*c),W=Math.round(y*c);v=`rgb(${A}, ${B}, ${W})`}let k=0,O=0;if(Math.abs(I-y)>.1||Math.abs(2*g-I-y)>.1){O=Math.atan2(Math.sqrt(3)*(I-y),2*g-I-y);let A=Math.max(255-g,255-I,255-y),B=Math.min(255-g,255-I,255-y);k=(A-B)/A,k==0&&(O=Math.random()*Math.PI*2)}else O=0,k=0;let q=Math.PI*(.1+.9*Math.pow(1-k,3)),T=K(t,a,O/2+Math.PI*.3,q,l,d,D*i,v,r);h[p][w][M]=T,n[p][w][M]=T.getContext("2d").getImageData(0,0,t,a)}let b=performance.now();return console.log("create textures....",b-s),{canvases:h,imageDatas:n}},Z=(t,a,u,o,s,e)=>{a*=4;let h=u/255*(e-1),n=o/255*(e-1),l=s/255*(e-1),d=h,c=n,r=l;h=Math.round(h),n=Math.round(n),l=Math.round(l);let i=0;for(let p=-1;p<=1;p++)for(let w=-1;w<=1;w++)for(let M=-1;M<=1;M++){let g=(.75-Math.abs(h+p-d)/2)*(.75-Math.abs(n+w-c)/2)*(.75-Math.abs(l+M-r)/2);if(g<0)throw new Error("debug");i+=g}let m=0,b=0,x=0;for(let p=-1;p<=1;p++)for(let w=-1;w<=1;w++)for(let M=-1;M<=1;M++){let g=(.75-Math.abs(h+p-d)/2)*(.75-Math.abs(n+w-c)/2)*(.75-Math.abs(l+M-r)/2);g/=i;let I=t[h+p][n+w][l+M];if(I==null)throw new Error("debug me!");m+=I.data[a]*g,b+=I.data[a+1]*g,x+=I.data[a+2]*g}let f=1-(1-(e+1)/e)*.25;return{red:Math.min(255,Math.round(m*f)),green:Math.min(255,Math.round(b*f)),blue:Math.min(255,Math.round(x*f))}},K=(t,a,u,o,s,e,h,n,l)=>{let d=h*t*a/e/s/l,c=document.createElement("canvas");c.width=t,c.height=a;let r=c.getContext("2d");r.strokeStyle=n,r.globalAlpha=1,r.fillStyle="#FFFFFF",r.fillRect(0,0,t,a),r.globalAlpha=l,r.lineWidth=s;for(let i=0;i<d;i++){let m=u+Math.round(Math.random()*2-1)/2*o,b=Math.random()*t,x=Math.random()*a,f=e/2*Math.cos(m),p=e/2*Math.sin(m),w=b+f,M=b-f,g=x+p,I=x-p;r.beginPath(),r.moveTo(w,g),r.lineTo(M,I),r.stroke()}return c},z=(t,a)=>{let u=a.width,o=a.height,s=a.blurAmount,e=[],h=[];for(let c=0;c<u;c++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<o;m++){let b=c+m*u;r[0]+=t[b*3+0],r[1]+=t[b*3+1],r[2]+=t[b*3+2],i[0]+=t[b*3+0]*t[b*3+0],i[1]+=t[b*3+1]*t[b*3+1],i[2]+=t[b*3+2]*t[b*3+2],e[b]=r.slice(0),h[b]=i.slice(0)}}let n=[],l=[];for(let c=0;c<o;c++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<u;m++){let b=m+c*u,x=m+Math.max(0,Math.round(c-s/2))*u,f=m+Math.min(o-1,Math.round(c+s/2))*u;r[0]+=(e[f][0]-e[x][0])/(f-x)*u,r[1]+=(e[f][1]-e[x][1])/(f-x)*u,r[2]+=(e[f][2]-e[x][2])/(f-x)*u,i[0]+=(h[f][0]-h[x][0])/(f-x)*u,i[1]+=(h[f][1]-h[x][1])/(f-x)*u,i[2]+=(h[f][2]-h[x][2])/(f-x)*u,n[b]=r.slice(0),l[b]=i.slice(0)}}let d=[];for(let c=0;c<u;c++)for(let r=0;r<o;r++){let i=c+r*u,m=Math.max(0,Math.round(c-s/2))+r*u,b=Math.min(u-1,Math.round(c+s/2))+r*u,x=(n[b][0]-n[m][0])/(b-m),f=(n[b][1]-n[m][1])/(b-m),p=(n[b][2]-n[m][2])/(b-m),w=(l[b][0]-l[m][0])/(b-m),M=(l[b][1]-l[m][1])/(b-m),g=(l[b][2]-l[m][2])/(b-m);d[i]=Math.sqrt(w+M+g-(x*x+f*f+p*p)),isNaN(d[i])&&(d[i]=0)}return d};var Q=(t,a,u)=>{let o=t/255,s=a/255,e=u/255,h,n,l;o<=.04045?h=o/12.92:h=Math.pow((o+.055)/1.055,2.4),s<=.04045?n=s/12.92:n=Math.pow((s+.055)/1.055,2.4),e<=.04045?l=e/12.92:l=Math.pow((e+.055)/1.055,2.4);let d,c,r;d=h*.4124564+n*.3575761+l*.1804375,c=h*.2126729+n*.7151522+l*.072175,r=h*.0193339+n*.119192+l*.9503041;let i=.008856,m=903.3,b=.950456,x=1,f=1.088754,p=d/b,w=c/x,M=r/f,g,I,y;p>i?g=Math.pow(p,.3333333333333333):g=(m*p+16)/116,w>i?I=Math.pow(w,.3333333333333333):I=(m*w+16)/116,M>i?y=Math.pow(M,.3333333333333333):y=(m*M+16)/116;let D=116*I-16,v=500*(g-I),k=200*(I-y);return{l:D,a:v,b:k}},tt=(t,a,u)=>{let o=Number.MAX_VALUE,s={x:0,y:0,l:0,a:0,b:0},e=t.width,h=t.height;for(let n=a-1;n<=a+1&&n>=0&&n<h-1;n++)for(let l=u-1;l<=u+1&&l>=0&&l<e-1;l++){let d=t.data[4*(n*e+l+1)],c=t.data[4*((n+1)*e+l+1)],r=t.data[4*(n*e+l)];Math.sqrt(Math.pow(d-r,2))+Math.sqrt(Math.pow(c-r,2))<o&&(o=Math.abs(d-r)+Math.abs(c-r),s.x=n,s.y=l)}return s},et=(t,a,u,o,s,e)=>{let h=t.width,n=Math.sqrt(Math.pow(a.l-t.data[4*(u*h+o)],2)+Math.pow(a.a-t.data[4*(u*h+o)+1],2)+Math.pow(a.b-t.data[4*(u*h+o)+2],2)),l=Math.sqrt(Math.pow(a.x-u,2)+Math.pow(a.y-o,2));return Math.pow(n/e,2)+Math.pow(l/s,2)},at=(t,a,u,o)=>{console.log("computing.............................");let s=t.width,e=t.height,h=Array.from({length:s*e}).map(l=>l=-1),n=new Array;for(let l=a;l<e;l+=a)for(let d=a;d<s;d+=a){let c=tt(t,l,d);c.l=t.data[4*(c.x*s+c.y)],c.a=t.data[4*(c.x*s+c.y)+1],c.b=t.data[4*(c.x*s+c.y)+2],n.push(c)}for(let l=0;l<u;l++){let d=Array.from({length:s*e}).map(r=>r=Number.MAX_VALUE);for(let r=0;r<n.length;r++)for(let i=n[r].x-a;i<n[r].x+a;i++)for(let m=n[r].y-a;m<n[r].y+a;m++)if(i>=0&&i<e&&m>=0&&m<s){let b=et(t,n[r],i,m,a,o);b<d[i*s+m]&&(d[i*s+m]=b,h[i*s+m]=r)}let c=JSON.parse(JSON.stringify(n));for(let r of n)r.c=r.l=r.a=r.b=r.x=r.y=0;for(let r=0;r<e;r++)for(let i=0;i<s;i++){let m=h[r*s+i];m!=-1&&(n[m].l+=t.data[4*(r*s+i)],n[m].a+=t.data[4*(r*s+i)+1],n[m].b+=t.data[4*(r*s+i)+2],n[m].x+=r,n[m].y+=i,n[m].c+=1)}for(let r in n)n[r].c==0||n[r].x==null||n[r].y==null?n[r]=JSON.parse(JSON.stringify(c[r])):(n[r].l/=n[r].c,n[r].a/=n[r].c,n[r].b/=n[r].c,n[r].x=Math.floor(n[r].x/n[r].c),n[r].y=Math.floor(n[r].y/n[r].c))}return console.log("compute done............................."),{clusterID:h,centers:n}},nt=(t,a,u,o)=>{console.log("painting...................");let s=t.width,e=t.height,h=Math.ceil(e/o),n=Math.ceil(s/o),l=new Uint8ClampedArray(s*e*4);for(let d=0;d<h;d++)for(let c=0;c<n;c++){let r=d*o,i=c*o,m={};for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++){let w=u[f*s+p];w!=-1&&(m[w]?m[w]++:m[w]=1)}let b=-1,x=Number.MIN_VALUE;for(let f in m)m[f]>x&&(x=m[f],b=+f);for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++)l[4*(f*s+p)]=t.data[4*(a[b].x*s+a[b].y)],l[4*(f*s+p)+1]=t.data[4*(a[b].x*s+a[b].y)+1],l[4*(f*s+p)+2]=t.data[4*(a[b].x*s+a[b].y)+2],l[4*(f*s+p)+3]=t.data[4*(a[b].x*s+a[b].y)+3]}return console.log("painting done..................."),l},rt=(t,a,u)=>{let o=[-1,-1,0,1,1,1,0,-1],s=[0,-1,-1,-1,0,1,1,1],e=[],h=Array.from({length:u}).map(n=>n=Array.from({length:a}).map(l=>l=!1));for(let n=0;n<u;n++)for(let l=0;l<a;l++){let d=0;for(let c=0;c<8;c++){let r=n+o[c],i=l+s[c];r>=0&&r<u&&i>=0&&i<a&&h[r][i]==!1&&t[n*a+l]!=t[r*a+i]&&(d+=1)}d>=2&&(e.push({x:n,y:l}),h[n][l]=!0)}return e},ee=(t,a,u,o,s)=>{let e=t.width,h=t.height,n=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<e*h;i+=4){let m=Q(t.data[i],t.data[i+1],t.data[i+2]);n.data[i]=m.l,n.data[i+2]=m.a,n.data[i+3]=m.b}let{clusterID:l,centers:d}=at(n,a,u,s),c=nt(t,d,l,o),r=rt(l,e,h);for(let i=0;i<r.length;i++){let m=4*(r[i].x*e+r[i].y);c[m]=255,c[m+1]=255,c[m+2]=255,c[m+3]=255}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var re=(t,a)=>{let u=0;return j(t,o=>{let s=o.r,e=o.g,h=o.b,{h:n,s:l,v:d}=R(s/255,e/255,h/255),c=!1;for(let r of a.bands){let i=n>=r.hueMin/360&&n<=r.hueMax/360,m=d<=r.valueMax;if(c=i&&m,c)break}if(c)return o;{let r=.299*s+.587*e+.114*h;return{r,g:r,b:r,a:o.a}}})};var le=(t,a,u=20,o=24)=>{let{width:s,height:e}=t,h=new ImageData(s,e),n=Math.cos(a),l=Math.sin(a);for(let d=0;d<e;d++)for(let c=0;c<s;c++){let r=0,i=0,m=0,b=0;for(let f=0;f<o;f++){let p=f/(o-1)-.5,w=c+n*p*u,M=d+l*p*u,g=N(t,w,M);r+=g[0],i+=g[1],m+=g[2],b+=g[3]}let x=(d*s+c)*4;h.data[x]=r/o,h.data[x+1]=i/o,h.data[x+2]=m/o,h.data[x+3]=b/o}return h};var de=(t,a,u,o=.5,s=32)=>{let{width:e,height:h}=t,n=new ImageData(e,h);for(let l=0;l<h;l++)for(let d=0;d<e;d++){let c=0,r=0,i=0,m=0,b=d-a,x=l-u;for(let p=0;p<s;p++){let M=(p/(s-1)-.5)*o,g=Math.sin(M),I=Math.cos(M),y=a+(b*I-x*g),D=u+(b*g+x*I),v=N(t,y,D);c+=v[0],r+=v[1],i+=v[2],m+=v[3]}let f=(l*e+d)*4;n.data[f]=c/s,n.data[f+1]=r/s,n.data[f+2]=i/s,n.data[f+3]=m/s}return n};export{ee as SLIC,gt as browniFilter,re as colourSplash,at as computePixel,F as convolve,U as convolve2,st as createCanvas,lt as crop,yt as dodgeFilter,kt as embossFilter,tt as findLocalMinimum,Ot as fishEyeFilter,E as gaussianBlur,Pt as glowFilter,S as greyScaleFilter,Gt as gridFilter,Tt as halftoneFilter,Lt as hatchFilter,V as hshear,Vt as invertFilter,pt as kodakChromeFilter,St as laplacianFilter,ot as loadImage,le as motionBlur,C as mult,Mt as nightVisionFilter,X as numChannels,Jt as painterlyFilter,bt as polaroidFilter,de as radialSpinBlur,Q as rgb2lab,R as rgbToHsv,N as sampleBilinear,ft as sepiaFilter,Ft as sharpenFilter,Kt as shearFilter,Qt as sketchTransform,Bt as sobelFilter,xt as technicolourFilter,ct as transform2Filter,j as transformFilter,ut as uniformBlur,wt as vintageFilter,H as vshear};
