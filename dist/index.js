var P=t=>t.data.length/t.width/t.height,rt=async(t,a)=>{let h=new Image,o=document.createElement("canvas"),s=o.getContext("2d");return new Promise((c,n)=>{h.crossOrigin="",h.onerror=()=>{n(new Error("unable to load image"))},h.onload=()=>{h.width=a.width||h.naturalWidth,h.height=a.height||h.naturalHeight,o.width=h.width,o.height=h.height,s.drawImage(h,0,0,h.width,h.height);let l=s.getImageData(0,0,o.width,o.height);c(l)},h.src=t})},ot=t=>{let a=document.createElement("canvas");return a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0),a},st=(t,a)=>{let h=t.width,o=4,s=a.width,e=a.height,c=new Uint8ClampedArray(s*e*o),n=0;for(let l=a.y;l<a.y+a.height;l++)for(let u=a.x;u<a.x+a.width;u++){let d=l*h*o+u*o;for(let r=0;r<o;r++)c[n++]=t.data[d+r]}return new ImageData(c,s,e)},B=(t,a)=>{let h=t.data.length,o=new Uint8ClampedArray(h);for(let s=0;s<h;s+=4){let e=a({r:t.data[s+0],g:t.data[s+1],b:t.data[s+2],a:t.data[s+3]});o[s+0]=e.r,o[s+1]=e.g,o[s+2]=e.b,o[s+3]=e.a}return new ImageData(o,t.width,t.height)},lt=(t,a,h)=>{if(t.data.length!==a.data.length)throw new Error("images need to be same length");let o=t.data.length,s=new Uint8ClampedArray(o);for(let e=0;e<o;e+=4){let c=h({r:t.data[e+0],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]},{r:a.data[e+0],g:a.data[e+1],b:a.data[e+2],a:a.data[e+3]});s[e+0]=c.r,s[e+1]=c.g,s[e+2]=c.b,s[e+3]=c.a}return new ImageData(s,t.width,t.height)},A=(t,a)=>{let{width:h,height:o,data:s}=t,e=P(t),c=O(Array.from(s),h,o,e,a);return new ImageData(new Uint8ClampedArray(c),h,o)},O=(t,a,h,o,s)=>{let e=Math.round(Math.sqrt(s.length)),c=Math.floor(e/2),n=a,l=h,u=n,d=l,r=[],i=1/s.length*.28;for(let m=0;m<d;m++)for(let b=0;b<u;b++){let x=[];for(let f=0;f<o;f++)x.push(0);for(let f=0;f<e;f++)for(let p=0;p<e;p++){let w=m+f-c,M=b+p-c;if(w>=0&&w<l&&M>=0&&M<n){let g=(w*n+M)*o,I=s[f*e+p];for(let D=0;D<o;D++)x[D]+=t[g+D]*I}else for(let g=0;g<o;g++)x[g]+=t[(m*u+b)*o]*i}for(let f=0;f<o;f++)r.push(x[f])}return r},v=(t,a)=>{let h=t.width,o=t.height,s=4,e=[];for(let c=0;c<o;c++)for(let n=0;n<h;n++){let l=s*(c*h+n),u=t.data[l+0],d=t.data[l+1],r=t.data[l+2],i=t.data[l+3],m=u*a[0]+d*a[1]+r*a[2],b=u*a[3]+d*a[4]+r*a[5],x=u*a[6]+d*a[7]+r*a[8];e.push(m),e.push(b),e.push(x),e.push(i)}return new ImageData(new Uint8ClampedArray(e),h,o)},T=(t,a,h)=>{let o=Math.max(t,a,h),s=Math.min(t,a,h),e=o-s,c=0;e!==0&&(o===t?c=((a-h)/e+(a<h?6:0))/6:o===a?c=((h-t)/e+2)/6:c=((t-a)/e+4)/6);let n=o===0?0:e/o;return{h:c,s:n,v:o}};var dt=(t,a)=>{let h=[],o=a*a;for(let s=0;s<o;s++)h.push(1/o);return A(t,h)};var mt=t=>v(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),ft=t=>v(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),bt=t=>v(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),xt=t=>v(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),pt=t=>v(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),gt=t=>v(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]),wt=t=>v(t,[.1,.4,.1,.2,.8,.2,.1,.4,.1]);var It=(t,a)=>{let h=[];for(let o=0;o<t.data.length;o++){let s=t.data[o]/(255-a.data[o]);s>1&&(s=1),h.push(s*255)}return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var F=(t,a)=>{let h=t.width,o=t.height,s=4,e=new Uint8ClampedArray(h*o*s);for(let c=0;c<h*o;++c){let n=c*s;if(a){if(a.rFilter){let u=a.rFilter;if(t.data[n]>=u[0]&&t.data[n]<=u[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}if(a.gFilter){let u=a.gFilter;if(t.data[n+1]>=u[0]&&t.data[n+1]<=u[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}if(a.bFilter){let u=a.bFilter;if(t.data[n+2]>=u[0]&&t.data[n+2]<=u[1]){e[n]=t.data[n],e[n+1]=t.data[n+1],e[n+2]=t.data[n+2],e[n+3]=255;continue}}}let l=0;for(let u=0;u<s-1;u++)l+=t.data[n+u];l/=3;for(let u=0;u<s-1;u++)e[n+u]=l;e[n+s-1]=255}return new ImageData(new Uint8ClampedArray(e),h,o)};var Ct=t=>A(t,[0,-1,0,-1,5,-1,0,-1,0]),Ft=t=>{let a=F(t);return A(a,[-2,-1,0,-1,1,1,0,1,2])},kt=t=>{let a=[-1,-1,-1,-1,8,-1,-1,-1,-1],h=[],o=F(t);for(let c=0;c<o.data.length;c++)c%4===0&&h.push(t.data[c]);let s=O(h,t.width,t.height,1,a),e=[];for(let c=0;c<s.length;c++)e.push(s[c]),e.push(s[c]),e.push(s[c]),e.push(255);return new ImageData(new Uint8ClampedArray(e),t.width,t.height)},St=t=>{let a=[-1,0,1,-2,0,2,-1,0,1],h=[-1,-2,-1,0,0,0,1,2,1],o=F(t),s=[];for(let l=0;l<o.data.length;l++)l%4===0&&s.push(o.data[l]);let e=O(s,t.width,t.height,1,a),c=O(s,t.width,t.height,1,h),n=[];for(let l=0;l<e.length;l++){let u=Math.sqrt(e[l]*e[l]+c[l]*c[l]);n.push(Math.min(255,u)),n.push(Math.min(255,u)),n.push(Math.min(255,u)),n.push(255)}return new ImageData(new Uint8ClampedArray(n),t.width,t.height)};var Ot=(t,a,h,o,s)=>{let e=t.width,c=t.height,n=4,l=[];for(let u=0;u<c;u++)for(let d=0;d<e;d++){let r=d-a,i=u-h,m=Math.sqrt(r*r+i*i);if(m<o){let b=Math.floor(a+r*s*m),x=Math.floor(h+i*s*m),f=n*(x*e+b);l.push(t.data[f]),l.push(t.data[f+1]),l.push(t.data[f+2]),l.push(255)}else{let b=n*(u*e+d);l.push(t.data[b]),l.push(t.data[b+1]),l.push(t.data[b+2]),l.push(t.data[b+3])}}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var X=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],R=t=>A(t,X);var G=(t,a,h)=>`rgb(${t},${a},${h})`,Y=(t,a,h,o)=>{let{width:s,data:e}=t,c=o.kernel,n=c*c,l=0,u=0,d=0;for(let x=h;x<h+c;x++)for(let f=a;f<a+c;f++){let p=(x*s+f)*4;l+=e[p]||0,u+=e[p+1]||0,d+=e[p+2]||0}let r=(o.rWeight*l+o.gWeight*u+o.bWeight*d)/(255*n),i=l/n,m=u/n,b=d/n;return{v:r,avgR:i,avgG:m,avgB:b}},Wt=(t,a)=>{let h=a.kernel,o=t.width,s=t.height;a.rWeight||(a.rWeight=.2),a.gWeight||(a.gWeight=.2),a.bWeight||(a.bWeight=.2);let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let c=e.getContext("2d"),n=(h-1)*.5;for(let l=0;l<=s-h;l+=h)for(let u=0;u<=o-h;u+=h){let{v:d,avgR:r,avgG:i,avgB:m}=Y(t,u,l,a),b=h/2*(1-d),x=0;a.shiftYAmt&&a.shiftYStride&&(x=u%(a.shiftYStride*h)===0?0:a.shiftYAmt);let f=0;a.shiftXAmt&&a.shiftXStride&&(x=u%(a.shiftXStride*h)===0?0:a.shiftXAmt),c.beginPath(),c.fillStyle=G(r,i,m),c.ellipse(f+u+n,x+l+n,b,b,0,0,2*Math.PI),c.fill(),c.closePath()}return c.getImageData(0,0,o,s)};var Et=t=>{let a=R(t);a=F(a);let h=[];for(let o=0;o<t.data.length;o++)if(o%4!==3){let s=Math.min(255,.5*a.data[o]+.9*t.data[o]);h.push(s)}else h.push(255);return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var Xt=(t,a,h)=>{let o=t.width,s=t.height,e=4,c=[];for(let n=0;n<s;n++)for(let l=0;l<o;l++){let u=e*(n*o+l);n%a<h||l%a<h?(c.push(255),c.push(255),c.push(255),c.push(255)):(c.push(t.data[u+0]),c.push(t.data[u+1]),c.push(t.data[u+2]),c.push(255))}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var L=(t,a,h)=>(t*.299+a*.587+h*.114)/255,Yt=(t,a,h,o,s)=>{let e=t.width,c=t.height,n=4,l=[],u=10;for(let d=0;d<c;d++)for(let r=0;r<e;r++){let i=n*(d*e+r),m=t.data[i+0],b=t.data[i+1],x=t.data[i+2],f=L(m,b,x),p=245,w=245,M=245,g=6;f<a&&(r+d)%g===0&&(p=4*u,w=4*u,M=4*u),f<h&&(r-d)%g===0&&(p=4*u,w=4*u,M=4*u),f<o&&(r+d-5)%g===0&&(p=4*u,w=4*u,M=4*u),f<s&&(r-d-5)%g===0&&(p=8*u,w=8*u,M=8*u),l.push(p),l.push(w),l.push(M),l.push(255)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var Ht=t=>B(t,a=>({r:255-a.r,g:255-a.g,b:255-a.b,a:a.a}));var _t=(t,a,h)=>{let o=t.width,s=t.height,e=4,c=new Uint8ClampedArray(t.data);for(let n=a;n<s-a;n++)for(let l=a;l<o-a;l++){let u=[],d=[],r=[],i=[];for(let f=0;f<h;f++)u.push(0),d.push(0),r.push(0),i.push(0);for(let f=-a;f<=a;f++)for(let p=-a;p<=a;p++){let w=e*((n+f)*o+(l+p)),M=t.data[w+0],g=t.data[w+1],I=t.data[w+2],D=Math.floor((M+g+I)/3*h/255);u[D]++,d[D]+=M,r[D]+=g,i[D]+=I}let m=0,b=0;for(let f=0;f<h;f++)u[f]>m&&(m=u[f],b=f);let x=e*(n*o+l);c[x+0]=d[b]/m,c[x+1]=r[b]/m,c[x+2]=i[b]/m}return new ImageData(c,o,s)};var $=(t,a,h)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),c=Math.floor(Math.random()*h),n=0,l=!1;for(let u=0;u<o;u++){if(n++,l){for(let d=0;d<s-c;d++){let r=4*(d*o+u),i=4*((d+c)*o+u);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let d=s-c;d<s;d++){let r=4*(d*o+u);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let d=0;d<c;d++){let r=4*(d*o+u);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}for(let d=c;d<s;d++){let r=4*(d*o+u),i=4*((d-c)*o+u);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}}n==a&&(c=Math.floor(Math.random()*h),l=!l,n=0)}return e},H=(t,a,h)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),c=Math.floor(Math.random()*h),n=0,l=!1;for(let u=0;u<s;u++){if(n++,l){for(let d=0;d<o-c;d++){let r=4*(u*o+d),i=4*(u*o+d+c);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let d=o-c;d<o;d++){let r=4*(u*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let d=c;d<o;d++){let r=4*(u*o+d),i=4*(u*o+d-c);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let d=0;d<c;d++){let r=4*(u*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}n==a&&(c=Math.floor(Math.random()*h),l=!l,n=0)}return e},Zt=(t,a,h,o,s)=>{let e=H(t,a,h);return $(e,o,s)};var zt=(t,a)=>{let h=t.width,o=t.height,s=t.data,e=new Set,c=[];for(let d=0;d<h;d++)for(let r=0;r<o;r++){let i=(d+r*h)*4,m=s[i]+":"+s[i+1]+":"+s[i+2];e.has(m)||(e.add(m),c.push([s[i+0],s[i+1],s[i+2]]))}let n={};for(;;){let d=a.levelSteps;n={};for(let i of c){let m=i[0],b=i[1],x=i[2],f=Math.round(m/255*(d-1)),p=Math.round(b/255*(d-1)),w=Math.round(x/255*(d-1));for(let M=-1;M<=1;M++)for(let g=-1;g<=1;g++)for(let I=-1;I<=1;I++){let D=f+M+":"+(p+g)+":"+(w+I);n[D]=!0}}if(Object.keys(n).length>NaN&&a.levelSteps>2){a.levelSteps--,console.log("Reducing to "+a.levelSteps+" RGB steps");continue}break}let{canvases:l,imageDatas:u}=_(h,o,n,a);return V(t,u,a)},V=(t,a,h)=>{let o=t.width,s=t.height,e=t.data,c=[];for(let n=0;n<o;n++)for(let l=0;l<s;l++){let u=n+l*o;c[u*3]=e[u*4],c[u*3+1]=e[u*4+1],c[u*3+2]=e[u*4+2]}c=K(c,{width:o,height:s,blurAmount:h.edgeBlurAmount});for(let n=0;n<o;n++)for(let l=0;l<s;l++){let u=n+l*o,d=e[u*4],r=e[u*4+1],i=e[u*4+2],m=J(a,u,d,r,i,h.levelSteps);if(h.greyScale){let x=Math.round((m.red+m.green+m.blue)/3);m.red=m.green=m.blue=x}let b=Math.max(0,(255-c[n+l*o]*h.edgeAmount)/255);b=Math.min(1,Math.max(.5,b*b)),e[u*4]=Math.round(m.red*b),e[u*4+1]=Math.round(m.green*b),e[u*4+2]=Math.round(m.blue*b)}return t},_=(t,a,h,o)=>{let s=performance.now(),e=o.levelSteps,c=[],n=[],l=o.lineThickness,u=o.lineLength,d=1-o.darkeningFactor,r=o.lineAlpha,i=o.lineDensity*2,m=o.lightness;for(let x=-1;x<=e;x++){c[x]={},n[x]={};for(let f=-1;f<=e;f++)c[x][f]={},n[x][f]={}}for(let x in h){let f=x.split(":"),p=parseInt(f[0]),w=parseInt(f[1]),M=parseInt(f[2]),g=255*p/(e-1),I=255*w/(e-1),D=255*M/(e-1);g=Math.min(255,Math.max(0,g)),I=Math.min(255,Math.max(0,I)),D=Math.min(255,Math.max(0,D));let k=1-Math.min(g,I,D)/255,S="";if(k>0){let y=Math.pow(1/k,1/m),U=Math.round((255-(255-g)*y)*d),N=Math.round((255-(255-I)*y)*d),E=Math.round((255-(255-D)*y)*d);S=`rgb(${U}, ${N}, ${E})`}else{let y=Math.round(g*d),U=Math.round(I*d),N=Math.round(D*d);S=`rgb(${y}, ${U}, ${N})`}let C=0,j=0;if(Math.abs(I-D)>.1||Math.abs(2*g-I-D)>.1){j=Math.atan2(Math.sqrt(3)*(I-D),2*g-I-D);let y=Math.max(255-g,255-I,255-D),U=Math.min(255-g,255-I,255-D);C=(y-U)/y,C==0&&(j=Math.random()*Math.PI*2)}else j=0,C=0;let q=Math.PI*(.1+.9*Math.pow(1-C,3)),W=Z(t,a,j/2+Math.PI*.3,q,l,u,k*i,S,r);c[p][w][M]=W,n[p][w][M]=W.getContext("2d").getImageData(0,0,t,a)}let b=performance.now();return console.log("create textures....",b-s),{canvases:c,imageDatas:n}},J=(t,a,h,o,s,e)=>{a*=4;let c=h/255*(e-1),n=o/255*(e-1),l=s/255*(e-1),u=c,d=n,r=l;c=Math.round(c),n=Math.round(n),l=Math.round(l);let i=0;for(let p=-1;p<=1;p++)for(let w=-1;w<=1;w++)for(let M=-1;M<=1;M++){let g=(.75-Math.abs(c+p-u)/2)*(.75-Math.abs(n+w-d)/2)*(.75-Math.abs(l+M-r)/2);if(g<0)throw new Error("debug");i+=g}let m=0,b=0,x=0;for(let p=-1;p<=1;p++)for(let w=-1;w<=1;w++)for(let M=-1;M<=1;M++){let g=(.75-Math.abs(c+p-u)/2)*(.75-Math.abs(n+w-d)/2)*(.75-Math.abs(l+M-r)/2);g/=i;let I=t[c+p][n+w][l+M];if(I==null)throw new Error("debug me!");m+=I.data[a]*g,b+=I.data[a+1]*g,x+=I.data[a+2]*g}let f=1-(1-(e+1)/e)*.25;return{red:Math.min(255,Math.round(m*f)),green:Math.min(255,Math.round(b*f)),blue:Math.min(255,Math.round(x*f))}},Z=(t,a,h,o,s,e,c,n,l)=>{let u=c*t*a/e/s/l,d=document.createElement("canvas");d.width=t,d.height=a;let r=d.getContext("2d");r.strokeStyle=n,r.globalAlpha=1,r.fillStyle="#FFFFFF",r.fillRect(0,0,t,a),r.globalAlpha=l,r.lineWidth=s;for(let i=0;i<u;i++){let m=h+Math.round(Math.random()*2-1)/2*o,b=Math.random()*t,x=Math.random()*a,f=e/2*Math.cos(m),p=e/2*Math.sin(m),w=b+f,M=b-f,g=x+p,I=x-p;r.beginPath(),r.moveTo(w,g),r.lineTo(M,I),r.stroke()}return d},K=(t,a)=>{let h=a.width,o=a.height,s=a.blurAmount,e=[],c=[];for(let d=0;d<h;d++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<o;m++){let b=d+m*h;r[0]+=t[b*3+0],r[1]+=t[b*3+1],r[2]+=t[b*3+2],i[0]+=t[b*3+0]*t[b*3+0],i[1]+=t[b*3+1]*t[b*3+1],i[2]+=t[b*3+2]*t[b*3+2],e[b]=r.slice(0),c[b]=i.slice(0)}}let n=[],l=[];for(let d=0;d<o;d++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<h;m++){let b=m+d*h,x=m+Math.max(0,Math.round(d-s/2))*h,f=m+Math.min(o-1,Math.round(d+s/2))*h;r[0]+=(e[f][0]-e[x][0])/(f-x)*h,r[1]+=(e[f][1]-e[x][1])/(f-x)*h,r[2]+=(e[f][2]-e[x][2])/(f-x)*h,i[0]+=(c[f][0]-c[x][0])/(f-x)*h,i[1]+=(c[f][1]-c[x][1])/(f-x)*h,i[2]+=(c[f][2]-c[x][2])/(f-x)*h,n[b]=r.slice(0),l[b]=i.slice(0)}}let u=[];for(let d=0;d<h;d++)for(let r=0;r<o;r++){let i=d+r*h,m=Math.max(0,Math.round(d-s/2))+r*h,b=Math.min(h-1,Math.round(d+s/2))+r*h,x=(n[b][0]-n[m][0])/(b-m),f=(n[b][1]-n[m][1])/(b-m),p=(n[b][2]-n[m][2])/(b-m),w=(l[b][0]-l[m][0])/(b-m),M=(l[b][1]-l[m][1])/(b-m),g=(l[b][2]-l[m][2])/(b-m);u[i]=Math.sqrt(w+M+g-(x*x+f*f+p*p)),isNaN(u[i])&&(u[i]=0)}return u};var z=(t,a,h)=>{let o=t/255,s=a/255,e=h/255,c,n,l;o<=.04045?c=o/12.92:c=Math.pow((o+.055)/1.055,2.4),s<=.04045?n=s/12.92:n=Math.pow((s+.055)/1.055,2.4),e<=.04045?l=e/12.92:l=Math.pow((e+.055)/1.055,2.4);let u,d,r;u=c*.4124564+n*.3575761+l*.1804375,d=c*.2126729+n*.7151522+l*.072175,r=c*.0193339+n*.119192+l*.9503041;let i=.008856,m=903.3,b=.950456,x=1,f=1.088754,p=u/b,w=d/x,M=r/f,g,I,D;p>i?g=Math.pow(p,.3333333333333333):g=(m*p+16)/116,w>i?I=Math.pow(w,.3333333333333333):I=(m*w+16)/116,M>i?D=Math.pow(M,.3333333333333333):D=(m*M+16)/116;let k=116*I-16,S=500*(g-I),C=200*(I-D);return{l:k,a:S,b:C}},Q=(t,a,h)=>{let o=Number.MAX_VALUE,s={x:0,y:0,l:0,a:0,b:0},e=t.width,c=t.height;for(let n=a-1;n<=a+1&&n>=0&&n<c-1;n++)for(let l=h-1;l<=h+1&&l>=0&&l<e-1;l++){let u=t.data[4*(n*e+l+1)],d=t.data[4*((n+1)*e+l+1)],r=t.data[4*(n*e+l)];Math.sqrt(Math.pow(u-r,2))+Math.sqrt(Math.pow(d-r,2))<o&&(o=Math.abs(u-r)+Math.abs(d-r),s.x=n,s.y=l)}return s},tt=(t,a,h,o,s,e)=>{let c=t.width,n=Math.sqrt(Math.pow(a.l-t.data[4*(h*c+o)],2)+Math.pow(a.a-t.data[4*(h*c+o)+1],2)+Math.pow(a.b-t.data[4*(h*c+o)+2],2)),l=Math.sqrt(Math.pow(a.x-h,2)+Math.pow(a.y-o,2));return Math.pow(n/e,2)+Math.pow(l/s,2)},et=(t,a,h,o)=>{console.log("computing.............................");let s=t.width,e=t.height,c=Array.from({length:s*e}).map(l=>l=-1),n=new Array;for(let l=a;l<e;l+=a)for(let u=a;u<s;u+=a){let d=Q(t,l,u);d.l=t.data[4*(d.x*s+d.y)],d.a=t.data[4*(d.x*s+d.y)+1],d.b=t.data[4*(d.x*s+d.y)+2],n.push(d)}for(let l=0;l<h;l++){let u=Array.from({length:s*e}).map(r=>r=Number.MAX_VALUE);for(let r=0;r<n.length;r++)for(let i=n[r].x-a;i<n[r].x+a;i++)for(let m=n[r].y-a;m<n[r].y+a;m++)if(i>=0&&i<e&&m>=0&&m<s){let b=tt(t,n[r],i,m,a,o);b<u[i*s+m]&&(u[i*s+m]=b,c[i*s+m]=r)}let d=JSON.parse(JSON.stringify(n));for(let r of n)r.c=r.l=r.a=r.b=r.x=r.y=0;for(let r=0;r<e;r++)for(let i=0;i<s;i++){let m=c[r*s+i];m!=-1&&(n[m].l+=t.data[4*(r*s+i)],n[m].a+=t.data[4*(r*s+i)+1],n[m].b+=t.data[4*(r*s+i)+2],n[m].x+=r,n[m].y+=i,n[m].c+=1)}for(let r in n)n[r].c==0||n[r].x==null||n[r].y==null?n[r]=JSON.parse(JSON.stringify(d[r])):(n[r].l/=n[r].c,n[r].a/=n[r].c,n[r].b/=n[r].c,n[r].x=Math.floor(n[r].x/n[r].c),n[r].y=Math.floor(n[r].y/n[r].c))}return console.log("compute done............................."),{clusterID:c,centers:n}},at=(t,a,h,o)=>{console.log("painting...................");let s=t.width,e=t.height,c=Math.ceil(e/o),n=Math.ceil(s/o),l=new Uint8ClampedArray(s*e*4);for(let u=0;u<c;u++)for(let d=0;d<n;d++){let r=u*o,i=d*o,m={};for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++){let w=h[f*s+p];w!=-1&&(m[w]?m[w]++:m[w]=1)}let b=-1,x=Number.MIN_VALUE;for(let f in m)m[f]>x&&(x=m[f],b=+f);for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++)l[4*(f*s+p)]=t.data[4*(a[b].x*s+a[b].y)],l[4*(f*s+p)+1]=t.data[4*(a[b].x*s+a[b].y)+1],l[4*(f*s+p)+2]=t.data[4*(a[b].x*s+a[b].y)+2],l[4*(f*s+p)+3]=t.data[4*(a[b].x*s+a[b].y)+3]}return console.log("painting done..................."),l},nt=(t,a,h)=>{let o=[-1,-1,0,1,1,1,0,-1],s=[0,-1,-1,-1,0,1,1,1],e=[],c=Array.from({length:h}).map(n=>n=Array.from({length:a}).map(l=>l=!1));for(let n=0;n<h;n++)for(let l=0;l<a;l++){let u=0;for(let d=0;d<8;d++){let r=n+o[d],i=l+s[d];r>=0&&r<h&&i>=0&&i<a&&c[r][i]==!1&&t[n*a+l]!=t[r*a+i]&&(u+=1)}u>=2&&(e.push({x:n,y:l}),c[n][l]=!0)}return e},te=(t,a,h,o,s)=>{let e=t.width,c=t.height,n=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<e*c;i+=4){let m=z(t.data[i],t.data[i+1],t.data[i+2]);n.data[i]=m.l,n.data[i+2]=m.a,n.data[i+3]=m.b}let{clusterID:l,centers:u}=et(n,a,h,s),d=at(t,u,l,o),r=nt(l,e,c);for(let i=0;i<r.length;i++){let m=4*(r[i].x*e+r[i].y);d[m]=255,d[m+1]=255,d[m+2]=255,d[m+3]=255}return new ImageData(new Uint8ClampedArray(d),t.width,t.height)};var ne=(t,a)=>{let h=0;return B(t,o=>{let s=o.r,e=o.g,c=o.b,{h:n,s:l,v:u}=T(s/255,e/255,c/255),d=!1;for(let r of a.bands){let i=n>=r.hueMin/360&&n<=r.hueMax/360,m=u<=r.valueMax;if(d=i&&m,d)break}if(d)return o;{let r=.299*s+.587*e+.114*c;return{r,g:r,b:r,a:o.a}}})};export{te as SLIC,pt as browniFilter,ne as colourSplash,et as computePixel,A as convolve,O as convolve2,ot as createCanvas,st as crop,It as dodgeFilter,Ft as embossFilter,Q as findLocalMinimum,Ot as fishEyeFilter,R as gaussianBlur,Et as glowFilter,F as greyScaleFilter,Xt as gridFilter,Wt as halftoneFilter,Yt as hatchFilter,H as hshear,Ht as invertFilter,xt as kodakChromeFilter,kt as laplacianFilter,rt as loadImage,v as mult,wt as nightVisionFilter,P as numChannels,_t as painterlyFilter,ft as polaroidFilter,z as rgb2lab,T as rgbToHsv,mt as sepiaFilter,Ct as sharpenFilter,Zt as shearFilter,zt as sketchTransform,St as sobelFilter,bt as technicolourFilter,lt as transform2Filter,B as transformFilter,dt as uniformBlur,gt as vintageFilter,$ as vshear};
