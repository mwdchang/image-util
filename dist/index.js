var X=t=>t.data.length/t.width/t.height,ot=async(t,n)=>{let u=new Image,o=document.createElement("canvas"),s=o.getContext("2d");return new Promise((h,a)=>{u.crossOrigin="",u.onerror=()=>{a(new Error("unable to load image"))},u.onload=()=>{u.width=n.width||u.naturalWidth,u.height=n.height||u.naturalHeight,o.width=u.width,o.height=u.height,s.drawImage(u,0,0,u.width,u.height);let l=s.getImageData(0,0,o.width,o.height);h(l)},u.src=t})},st=t=>{let n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),n},lt=(t,n)=>{let u=t.width,o=4,s=n.width,e=n.height,h=new Uint8ClampedArray(s*e*o),a=0;for(let l=n.y;l<n.y+n.height;l++)for(let d=n.x;d<n.x+n.width;d++){let c=l*u*o+d*o;for(let r=0;r<o;r++)h[a++]=t.data[c+r]}return new ImageData(h,s,e)},N=(t,n)=>{let u=t.data.length,o=new Uint8ClampedArray(u);for(let s=0;s<u;s+=4){let e=n({r:t.data[s+0],g:t.data[s+1],b:t.data[s+2],a:t.data[s+3]});o[s+0]=e.r,o[s+1]=e.g,o[s+2]=e.b,o[s+3]=e.a}return new ImageData(o,t.width,t.height)},ct=(t,n,u)=>{if(t.data.length!==n.data.length)throw new Error("images need to be same length");let o=t.data.length,s=new Uint8ClampedArray(o);for(let e=0;e<o;e+=4){let h=u({r:t.data[e+0],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]},{r:n.data[e+0],g:n.data[e+1],b:n.data[e+2],a:n.data[e+3]});s[e+0]=h.r,s[e+1]=h.g,s[e+2]=h.b,s[e+3]=h.a}return new ImageData(s,t.width,t.height)},k=(t,n)=>{let{width:u,height:o,data:s}=t,e=X(t),h=O(Array.from(s),u,o,e,n);return new ImageData(new Uint8ClampedArray(h),u,o)},O=(t,n,u,o,s)=>{let e=Math.round(Math.sqrt(s.length)),h=Math.floor(e/2),a=n,l=u,d=a,c=l,r=[],i=1/s.length*.28;for(let m=0;m<c;m++)for(let b=0;b<d;b++){let x=[];for(let f=0;f<o;f++)x.push(0);for(let f=0;f<e;f++)for(let p=0;p<e;p++){let M=m+f-h,w=b+p-h;if(M>=0&&M<l&&w>=0&&w<a){let g=(M*a+w)*o,I=s[f*e+p];for(let y=0;y<o;y++)x[y]+=t[g+y]*I}else for(let g=0;g<o;g++)x[g]+=t[(m*d+b)*o]*i}for(let f=0;f<o;f++)r.push(x[f])}return r},F=(t,n)=>{let u=t.width,o=t.height,s=4,e=[];for(let h=0;h<o;h++)for(let a=0;a<u;a++){let l=s*(h*u+a),d=t.data[l+0],c=t.data[l+1],r=t.data[l+2],i=t.data[l+3],m=d*n[0]+c*n[1]+r*n[2],b=d*n[3]+c*n[4]+r*n[5],x=d*n[6]+c*n[7]+r*n[8];e.push(m),e.push(b),e.push(x),e.push(i)}return new ImageData(new Uint8ClampedArray(e),u,o)},q=(t,n,u)=>{let o=Math.max(t,n,u),s=Math.min(t,n,u),e=o-s,h=0;e!==0&&(o===t?h=((n-u)/e+(n<u?6:0))/6:o===n?h=((u-t)/e+2)/6:h=((t-n)/e+4)/6);let a=o===0?0:e/o;return{h,s:a,v:o}},C=(t,n,u)=>{let{width:o,height:s,data:e}=t;if(e.length/o/s!==4)throw new Error("Only support rgba channels currently...");let a=Math.max(0,Math.min(o-1,n)),l=Math.max(0,Math.min(s-1,u)),d=Math.floor(a),c=Math.floor(l),r=Math.min(d+1,o-1),i=Math.min(c+1,s-1),m=a-d,b=l-c;function x(y,D){let v=(D*o+y)*4;return[e[v],e[v+1],e[v+2],e[v+3]]}let f=x(d,c),p=x(r,c),M=x(d,i),w=x(r,i),g=f.map((y,D)=>y*(1-m)+p[D]*m),I=M.map((y,D)=>y*(1-m)+w[D]*m);return g.map((y,D)=>y*(1-b)+I[D]*b)};var ut=(t,n)=>{let u=[],o=n*n;for(let s=0;s<o;s++)u.push(1/o);return k(t,u)};var ft=t=>F(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),bt=t=>F(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),xt=t=>F(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),pt=t=>F(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),gt=t=>F(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),wt=t=>F(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]),Mt=t=>F(t,[.1,.4,.1,.2,.8,.2,.1,.4,.1]);var yt=(t,n)=>{let u=[];for(let o=0;o<t.data.length;o++){let s=t.data[o]/(255-n.data[o]);s>1&&(s=1),u.push(s*255)}return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var B=(t,n)=>{let u=t.width,o=t.height,s=4,e=new Uint8ClampedArray(u*o*s);for(let h=0;h<u*o;++h){let a=h*s;if(n){if(n.rFilter){let d=n.rFilter;if(t.data[a]>=d[0]&&t.data[a]<=d[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}if(n.gFilter){let d=n.gFilter;if(t.data[a+1]>=d[0]&&t.data[a+1]<=d[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}if(n.bFilter){let d=n.bFilter;if(t.data[a+2]>=d[0]&&t.data[a+2]<=d[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}}let l=0;for(let d=0;d<s-1;d++)l+=t.data[a+d];l/=3;for(let d=0;d<s-1;d++)e[a+d]=l;e[a+s-1]=255}return new ImageData(new Uint8ClampedArray(e),u,o)};var Ct=t=>k(t,[0,-1,0,-1,5,-1,0,-1,0]),kt=t=>{let n=B(t);return k(n,[-2,-1,0,-1,1,1,0,1,2])},St=t=>{let n=[-1,-1,-1,-1,8,-1,-1,-1,-1],u=[],o=B(t);for(let h=0;h<o.data.length;h++)h%4===0&&u.push(t.data[h]);let s=O(u,t.width,t.height,1,n),e=[];for(let h=0;h<s.length;h++)e.push(s[h]),e.push(s[h]),e.push(s[h]),e.push(255);return new ImageData(new Uint8ClampedArray(e),t.width,t.height)},Bt=t=>{let n=[-1,0,1,-2,0,2,-1,0,1],u=[-1,-2,-1,0,0,0,1,2,1],o=B(t),s=[];for(let l=0;l<o.data.length;l++)l%4===0&&s.push(o.data[l]);let e=O(s,t.width,t.height,1,n),h=O(s,t.width,t.height,1,u),a=[];for(let l=0;l<e.length;l++){let d=Math.sqrt(e[l]*e[l]+h[l]*h[l]);a.push(Math.min(255,d)),a.push(Math.min(255,d)),a.push(Math.min(255,d)),a.push(255)}return new ImageData(new Uint8ClampedArray(a),t.width,t.height)};var Ot=(t,n,u,o,s)=>{let e=t.width,h=t.height,a=4,l=[];for(let d=0;d<h;d++)for(let c=0;c<e;c++){let r=c-n,i=d-u,m=Math.sqrt(r*r+i*i);if(m<o){let b=Math.floor(n+r*s*m),x=Math.floor(u+i*s*m),f=a*(x*e+b);l.push(t.data[f]),l.push(t.data[f+1]),l.push(t.data[f+2]),l.push(255)}else{let b=a*(d*e+c);l.push(t.data[b]),l.push(t.data[b+1]),l.push(t.data[b+2]),l.push(t.data[b+3])}}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var G=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],R=t=>k(t,G);var Y=(t,n,u)=>`rgb(${t},${n},${u})`,L=(t,n,u,o)=>{let{width:s,data:e}=t,h=o.kernel,a=h*h,l=0,d=0,c=0;for(let x=u;x<u+h;x++)for(let f=n;f<n+h;f++){let p=(x*s+f)*4;l+=e[p]||0,d+=e[p+1]||0,c+=e[p+2]||0}let r=(o.rWeight*l+o.gWeight*d+o.bWeight*c)/(255*a),i=l/a,m=d/a,b=c/a;return{v:r,avgR:i,avgG:m,avgB:b}},Tt=(t,n)=>{let u=n.kernel,o=t.width,s=t.height;n.rWeight||(n.rWeight=.2),n.gWeight||(n.gWeight=.2),n.bWeight||(n.bWeight=.2);let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let h=e.getContext("2d"),a=(u-1)*.5;for(let l=0;l<=s-u;l+=u)for(let d=0;d<=o-u;d+=u){let{v:c,avgR:r,avgG:i,avgB:m}=L(t,d,l,n),b=u/2*(1-c),x=0;n.shiftYAmt&&n.shiftYStride&&(x=d%(n.shiftYStride*u)===0?0:n.shiftYAmt);let f=0;n.shiftXAmt&&n.shiftXStride&&(x=d%(n.shiftXStride*u)===0?0:n.shiftXAmt),h.beginPath(),h.fillStyle=Y(r,i,m),h.ellipse(f+d+a,x+l+a,b,b,0,0,2*Math.PI),h.fill(),h.closePath()}return h.getImageData(0,0,o,s)};var Pt=t=>{let n=R(t);n=B(n);let u=[];for(let o=0;o<t.data.length;o++)if(o%4!==3){let s=Math.min(255,.5*n.data[o]+.9*t.data[o]);u.push(s)}else u.push(255);return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var Gt=(t,n,u)=>{let o=t.width,s=t.height,e=4,h=[];for(let a=0;a<s;a++)for(let l=0;l<o;l++){let d=e*(a*o+l);a%n<u||l%n<u?(h.push(255),h.push(255),h.push(255),h.push(255)):(h.push(t.data[d+0]),h.push(t.data[d+1]),h.push(t.data[d+2]),h.push(255))}return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var $=(t,n,u)=>(t*.299+n*.587+u*.114)/255,Lt=(t,n,u,o,s)=>{let e=t.width,h=t.height,a=4,l=[],d=10;for(let c=0;c<h;c++)for(let r=0;r<e;r++){let i=a*(c*e+r),m=t.data[i+0],b=t.data[i+1],x=t.data[i+2],f=$(m,b,x),p=245,M=245,w=245,g=6;f<n&&(r+c)%g===0&&(p=4*d,M=4*d,w=4*d),f<u&&(r-c)%g===0&&(p=4*d,M=4*d,w=4*d),f<o&&(r+c-5)%g===0&&(p=4*d,M=4*d,w=4*d),f<s&&(r-c-5)%g===0&&(p=8*d,M=8*d,w=8*d),l.push(p),l.push(M),l.push(w),l.push(255)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var Vt=t=>N(t,n=>({r:255-n.r,g:255-n.g,b:255-n.b,a:n.a}));var Jt=(t,n,u)=>{let o=t.width,s=t.height,e=4,h=new Uint8ClampedArray(t.data);for(let a=n;a<s-n;a++)for(let l=n;l<o-n;l++){let d=[],c=[],r=[],i=[];for(let f=0;f<u;f++)d.push(0),c.push(0),r.push(0),i.push(0);for(let f=-n;f<=n;f++)for(let p=-n;p<=n;p++){let M=e*((a+f)*o+(l+p)),w=t.data[M+0],g=t.data[M+1],I=t.data[M+2],y=Math.floor((w+g+I)/3*u/255);d[y]++,c[y]+=w,r[y]+=g,i[y]+=I}let m=0,b=0;for(let f=0;f<u;f++)d[f]>m&&(m=d[f],b=f);let x=e*(a*o+l);h[x+0]=c[b]/m,h[x+1]=r[b]/m,h[x+2]=i[b]/m}return new ImageData(h,o,s)};var H=(t,n,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),h=Math.floor(Math.random()*u),a=0,l=!1;for(let d=0;d<o;d++){if(a++,l){for(let c=0;c<s-h;c++){let r=4*(c*o+d),i=4*((c+h)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let c=s-h;c<s;c++){let r=4*(c*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let c=0;c<h;c++){let r=4*(c*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}for(let c=h;c<s;c++){let r=4*(c*o+d),i=4*((c-h)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}}a==n&&(h=Math.floor(Math.random()*u),l=!l,a=0)}return e},V=(t,n,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),h=Math.floor(Math.random()*u),a=0,l=!1;for(let d=0;d<s;d++){if(a++,l){for(let c=0;c<o-h;c++){let r=4*(d*o+c),i=4*(d*o+c+h);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let c=o-h;c<o;c++){let r=4*(d*o+c);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let c=h;c<o;c++){let r=4*(d*o+c),i=4*(d*o+c-h);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let c=0;c<h;c++){let r=4*(d*o+c);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}a==n&&(h=Math.floor(Math.random()*u),l=!l,a=0)}return e},Kt=(t,n,u,o,s)=>{let e=V(t,n,u);return H(e,o,s)};var Qt=(t,n)=>{let u=t.width,o=t.height,s=t.data,e=new Set,h=[];for(let c=0;c<u;c++)for(let r=0;r<o;r++){let i=(c+r*u)*4,m=s[i]+":"+s[i+1]+":"+s[i+2];e.has(m)||(e.add(m),h.push([s[i+0],s[i+1],s[i+2]]))}let a={};for(;;){let c=n.levelSteps;a={};for(let i of h){let m=i[0],b=i[1],x=i[2],f=Math.round(m/255*(c-1)),p=Math.round(b/255*(c-1)),M=Math.round(x/255*(c-1));for(let w=-1;w<=1;w++)for(let g=-1;g<=1;g++)for(let I=-1;I<=1;I++){let y=f+w+":"+(p+g)+":"+(M+I);a[y]=!0}}if(Object.keys(a).length>NaN&&n.levelSteps>2){n.levelSteps--,console.log("Reducing to "+n.levelSteps+" RGB steps");continue}break}let{canvases:l,imageDatas:d}=J(u,o,a,n);return _(t,d,n)},_=(t,n,u)=>{let o=t.width,s=t.height,e=t.data,h=[];for(let a=0;a<o;a++)for(let l=0;l<s;l++){let d=a+l*o;h[d*3]=e[d*4],h[d*3+1]=e[d*4+1],h[d*3+2]=e[d*4+2]}h=z(h,{width:o,height:s,blurAmount:u.edgeBlurAmount});for(let a=0;a<o;a++)for(let l=0;l<s;l++){let d=a+l*o,c=e[d*4],r=e[d*4+1],i=e[d*4+2],m=Z(n,d,c,r,i,u.levelSteps);if(u.greyScale){let x=Math.round((m.red+m.green+m.blue)/3);m.red=m.green=m.blue=x}let b=Math.max(0,(255-h[a+l*o]*u.edgeAmount)/255);b=Math.min(1,Math.max(.5,b*b)),e[d*4]=Math.round(m.red*b),e[d*4+1]=Math.round(m.green*b),e[d*4+2]=Math.round(m.blue*b)}return t},J=(t,n,u,o)=>{let s=performance.now(),e=o.levelSteps,h=[],a=[],l=o.lineThickness,d=o.lineLength,c=1-o.darkeningFactor,r=o.lineAlpha,i=o.lineDensity*2,m=o.lightness;for(let x=-1;x<=e;x++){h[x]={},a[x]={};for(let f=-1;f<=e;f++)h[x][f]={},a[x][f]={}}for(let x in u){let f=x.split(":"),p=parseInt(f[0]),M=parseInt(f[1]),w=parseInt(f[2]),g=255*p/(e-1),I=255*M/(e-1),y=255*w/(e-1);g=Math.min(255,Math.max(0,g)),I=Math.min(255,Math.max(0,I)),y=Math.min(255,Math.max(0,y));let D=1-Math.min(g,I,y)/255,v="";if(D>0){let A=Math.pow(1/D,1/m),U=Math.round((255-(255-g)*A)*c),W=Math.round((255-(255-I)*A)*c),P=Math.round((255-(255-y)*A)*c);v=`rgb(${U}, ${W}, ${P})`}else{let A=Math.round(g*c),U=Math.round(I*c),W=Math.round(y*c);v=`rgb(${A}, ${U}, ${W})`}let S=0,j=0;if(Math.abs(I-y)>.1||Math.abs(2*g-I-y)>.1){j=Math.atan2(Math.sqrt(3)*(I-y),2*g-I-y);let A=Math.max(255-g,255-I,255-y),U=Math.min(255-g,255-I,255-y);S=(A-U)/A,S==0&&(j=Math.random()*Math.PI*2)}else j=0,S=0;let E=Math.PI*(.1+.9*Math.pow(1-S,3)),T=K(t,n,j/2+Math.PI*.3,E,l,d,D*i,v,r);h[p][M][w]=T,a[p][M][w]=T.getContext("2d").getImageData(0,0,t,n)}let b=performance.now();return console.log("create textures....",b-s),{canvases:h,imageDatas:a}},Z=(t,n,u,o,s,e)=>{n*=4;let h=u/255*(e-1),a=o/255*(e-1),l=s/255*(e-1),d=h,c=a,r=l;h=Math.round(h),a=Math.round(a),l=Math.round(l);let i=0;for(let p=-1;p<=1;p++)for(let M=-1;M<=1;M++)for(let w=-1;w<=1;w++){let g=(.75-Math.abs(h+p-d)/2)*(.75-Math.abs(a+M-c)/2)*(.75-Math.abs(l+w-r)/2);if(g<0)throw new Error("debug");i+=g}let m=0,b=0,x=0;for(let p=-1;p<=1;p++)for(let M=-1;M<=1;M++)for(let w=-1;w<=1;w++){let g=(.75-Math.abs(h+p-d)/2)*(.75-Math.abs(a+M-c)/2)*(.75-Math.abs(l+w-r)/2);g/=i;let I=t[h+p][a+M][l+w];if(I==null)throw new Error("debug me!");m+=I.data[n]*g,b+=I.data[n+1]*g,x+=I.data[n+2]*g}let f=1-(1-(e+1)/e)*.25;return{red:Math.min(255,Math.round(m*f)),green:Math.min(255,Math.round(b*f)),blue:Math.min(255,Math.round(x*f))}},K=(t,n,u,o,s,e,h,a,l)=>{let d=h*t*n/e/s/l,c=document.createElement("canvas");c.width=t,c.height=n;let r=c.getContext("2d");r.strokeStyle=a,r.globalAlpha=1,r.fillStyle="#FFFFFF",r.fillRect(0,0,t,n),r.globalAlpha=l,r.lineWidth=s;for(let i=0;i<d;i++){let m=u+Math.round(Math.random()*2-1)/2*o,b=Math.random()*t,x=Math.random()*n,f=e/2*Math.cos(m),p=e/2*Math.sin(m),M=b+f,w=b-f,g=x+p,I=x-p;r.beginPath(),r.moveTo(M,g),r.lineTo(w,I),r.stroke()}return c},z=(t,n)=>{let u=n.width,o=n.height,s=n.blurAmount,e=[],h=[];for(let c=0;c<u;c++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<o;m++){let b=c+m*u;r[0]+=t[b*3+0],r[1]+=t[b*3+1],r[2]+=t[b*3+2],i[0]+=t[b*3+0]*t[b*3+0],i[1]+=t[b*3+1]*t[b*3+1],i[2]+=t[b*3+2]*t[b*3+2],e[b]=r.slice(0),h[b]=i.slice(0)}}let a=[],l=[];for(let c=0;c<o;c++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<u;m++){let b=m+c*u,x=m+Math.max(0,Math.round(c-s/2))*u,f=m+Math.min(o-1,Math.round(c+s/2))*u;r[0]+=(e[f][0]-e[x][0])/(f-x)*u,r[1]+=(e[f][1]-e[x][1])/(f-x)*u,r[2]+=(e[f][2]-e[x][2])/(f-x)*u,i[0]+=(h[f][0]-h[x][0])/(f-x)*u,i[1]+=(h[f][1]-h[x][1])/(f-x)*u,i[2]+=(h[f][2]-h[x][2])/(f-x)*u,a[b]=r.slice(0),l[b]=i.slice(0)}}let d=[];for(let c=0;c<u;c++)for(let r=0;r<o;r++){let i=c+r*u,m=Math.max(0,Math.round(c-s/2))+r*u,b=Math.min(u-1,Math.round(c+s/2))+r*u,x=(a[b][0]-a[m][0])/(b-m),f=(a[b][1]-a[m][1])/(b-m),p=(a[b][2]-a[m][2])/(b-m),M=(l[b][0]-l[m][0])/(b-m),w=(l[b][1]-l[m][1])/(b-m),g=(l[b][2]-l[m][2])/(b-m);d[i]=Math.sqrt(M+w+g-(x*x+f*f+p*p)),isNaN(d[i])&&(d[i]=0)}return d};var Q=(t,n,u)=>{let o=t/255,s=n/255,e=u/255,h,a,l;o<=.04045?h=o/12.92:h=Math.pow((o+.055)/1.055,2.4),s<=.04045?a=s/12.92:a=Math.pow((s+.055)/1.055,2.4),e<=.04045?l=e/12.92:l=Math.pow((e+.055)/1.055,2.4);let d,c,r;d=h*.4124564+a*.3575761+l*.1804375,c=h*.2126729+a*.7151522+l*.072175,r=h*.0193339+a*.119192+l*.9503041;let i=.008856,m=903.3,b=.950456,x=1,f=1.088754,p=d/b,M=c/x,w=r/f,g,I,y;p>i?g=Math.pow(p,.3333333333333333):g=(m*p+16)/116,M>i?I=Math.pow(M,.3333333333333333):I=(m*M+16)/116,w>i?y=Math.pow(w,.3333333333333333):y=(m*w+16)/116;let D=116*I-16,v=500*(g-I),S=200*(I-y);return{l:D,a:v,b:S}},tt=(t,n,u)=>{let o=Number.MAX_VALUE,s={x:0,y:0,l:0,a:0,b:0},e=t.width,h=t.height;for(let a=n-1;a<=n+1&&a>=0&&a<h-1;a++)for(let l=u-1;l<=u+1&&l>=0&&l<e-1;l++){let d=t.data[4*(a*e+l+1)],c=t.data[4*((a+1)*e+l+1)],r=t.data[4*(a*e+l)];Math.sqrt(Math.pow(d-r,2))+Math.sqrt(Math.pow(c-r,2))<o&&(o=Math.abs(d-r)+Math.abs(c-r),s.x=a,s.y=l)}return s},et=(t,n,u,o,s,e)=>{let h=t.width,a=Math.sqrt(Math.pow(n.l-t.data[4*(u*h+o)],2)+Math.pow(n.a-t.data[4*(u*h+o)+1],2)+Math.pow(n.b-t.data[4*(u*h+o)+2],2)),l=Math.sqrt(Math.pow(n.x-u,2)+Math.pow(n.y-o,2));return Math.pow(a/e,2)+Math.pow(l/s,2)},at=(t,n,u,o)=>{console.log("computing.............................");let s=t.width,e=t.height,h=Array.from({length:s*e}).map(l=>l=-1),a=new Array;for(let l=n;l<e;l+=n)for(let d=n;d<s;d+=n){let c=tt(t,l,d);c.l=t.data[4*(c.x*s+c.y)],c.a=t.data[4*(c.x*s+c.y)+1],c.b=t.data[4*(c.x*s+c.y)+2],a.push(c)}for(let l=0;l<u;l++){let d=Array.from({length:s*e}).map(r=>r=Number.MAX_VALUE);for(let r=0;r<a.length;r++)for(let i=a[r].x-n;i<a[r].x+n;i++)for(let m=a[r].y-n;m<a[r].y+n;m++)if(i>=0&&i<e&&m>=0&&m<s){let b=et(t,a[r],i,m,n,o);b<d[i*s+m]&&(d[i*s+m]=b,h[i*s+m]=r)}let c=JSON.parse(JSON.stringify(a));for(let r of a)r.c=r.l=r.a=r.b=r.x=r.y=0;for(let r=0;r<e;r++)for(let i=0;i<s;i++){let m=h[r*s+i];m!=-1&&(a[m].l+=t.data[4*(r*s+i)],a[m].a+=t.data[4*(r*s+i)+1],a[m].b+=t.data[4*(r*s+i)+2],a[m].x+=r,a[m].y+=i,a[m].c+=1)}for(let r in a)a[r].c==0||a[r].x==null||a[r].y==null?a[r]=JSON.parse(JSON.stringify(c[r])):(a[r].l/=a[r].c,a[r].a/=a[r].c,a[r].b/=a[r].c,a[r].x=Math.floor(a[r].x/a[r].c),a[r].y=Math.floor(a[r].y/a[r].c))}return console.log("compute done............................."),{clusterID:h,centers:a}},nt=(t,n,u,o)=>{console.log("painting...................");let s=t.width,e=t.height,h=Math.ceil(e/o),a=Math.ceil(s/o),l=new Uint8ClampedArray(s*e*4);for(let d=0;d<h;d++)for(let c=0;c<a;c++){let r=d*o,i=c*o,m={};for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++){let M=u[f*s+p];M!=-1&&(m[M]?m[M]++:m[M]=1)}let b=-1,x=Number.MIN_VALUE;for(let f in m)m[f]>x&&(x=m[f],b=+f);for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++)l[4*(f*s+p)]=t.data[4*(n[b].x*s+n[b].y)],l[4*(f*s+p)+1]=t.data[4*(n[b].x*s+n[b].y)+1],l[4*(f*s+p)+2]=t.data[4*(n[b].x*s+n[b].y)+2],l[4*(f*s+p)+3]=t.data[4*(n[b].x*s+n[b].y)+3]}return console.log("painting done..................."),l},rt=(t,n,u)=>{let o=[-1,-1,0,1,1,1,0,-1],s=[0,-1,-1,-1,0,1,1,1],e=[],h=Array.from({length:u}).map(a=>a=Array.from({length:n}).map(l=>l=!1));for(let a=0;a<u;a++)for(let l=0;l<n;l++){let d=0;for(let c=0;c<8;c++){let r=a+o[c],i=l+s[c];r>=0&&r<u&&i>=0&&i<n&&h[r][i]==!1&&t[a*n+l]!=t[r*n+i]&&(d+=1)}d>=2&&(e.push({x:a,y:l}),h[a][l]=!0)}return e},ee=(t,n,u,o,s)=>{let e=t.width,h=t.height,a=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<e*h;i+=4){let m=Q(t.data[i],t.data[i+1],t.data[i+2]);a.data[i]=m.l,a.data[i+2]=m.a,a.data[i+3]=m.b}let{clusterID:l,centers:d}=at(a,n,u,s),c=nt(t,d,l,o),r=rt(l,e,h);for(let i=0;i<r.length;i++){let m=4*(r[i].x*e+r[i].y);c[m]=255,c[m+1]=255,c[m+2]=255,c[m+3]=255}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var re=(t,n)=>{let u=0;return N(t,o=>{let s=o.r,e=o.g,h=o.b,{h:a,s:l,v:d}=q(s/255,e/255,h/255),c=!1;for(let r of n.bands){let i=a>=r.hueMin/360&&a<=r.hueMax/360,m=d<=r.valueMax;if(c=i&&m,c)break}if(c)return o;{let r=.299*s+.587*e+.114*h;return{r,g:r,b:r,a:o.a}}})};var le=(t,n,u=20,o=24)=>{let{width:s,height:e}=t,h=new ImageData(s,e),a=Math.cos(n),l=Math.sin(n);for(let d=0;d<e;d++)for(let c=0;c<s;c++){let r=0,i=0,m=0,b=0;for(let f=0;f<o;f++){let p=f/(o-1)-.5,M=c+a*p*u,w=d+l*p*u,g=C(t,M,w);r+=g[0],i+=g[1],m+=g[2],b+=g[3]}let x=(d*s+c)*4;h.data[x]=r/o,h.data[x+1]=i/o,h.data[x+2]=m/o,h.data[x+3]=b/o}return h};var de=(t,n,u,o=.5,s=32)=>{let{width:e,height:h}=t,a=new ImageData(e,h);for(let l=0;l<h;l++)for(let d=0;d<e;d++){let c=0,r=0,i=0,m=0,b=d-n,x=l-u;for(let p=0;p<s;p++){let w=(p/(s-1)-.5)*o,g=Math.sin(w),I=Math.cos(w),y=n+(b*I-x*g),D=u+(b*g+x*I),v=C(t,y,D);c+=v[0],r+=v[1],i+=v[2],m+=v[3]}let f=(l*e+d)*4;a.data[f]=c/s,a.data[f+1]=r/s,a.data[f+2]=i/s,a.data[f+3]=m/s}return a};var me=(t,n,u,o,s)=>{let{width:e,height:h}=t,a=new ImageData(e,h);for(let l=0;l<h;l++)for(let d=0;d<e;d++){let c=d-n,r=l-u,i=Math.sqrt(c*c+r*r);if(i<o){let m=(o-i)/o,b=s*m,x=Math.sin(b),f=Math.cos(b),p=n+c*f-r*x,M=u+c*x+r*f,w=C(t,p,M),g=(l*e+d)*4;a.data[g]=w[0],a.data[g+1]=w[1],a.data[g+2]=w[2],a.data[g+3]=w[3]}else{let m=(l*e+d)*4,b=m;a.data[m]=t.data[b],a.data[m+1]=t.data[b+1],a.data[m+2]=t.data[b+2],a.data[m+3]=t.data[b+3]}}return a};var xe=(t,n,u,o=6)=>{let{width:s,height:e}=t,h=new ImageData(s,e),a=2*Math.PI/o;for(let l=0;l<e;l++)for(let d=0;d<s;d++){let c=d-n,r=l-u,i=Math.atan2(r,c),m=Math.sqrt(c*c+r*r);i=i%a,i=Math.abs(i-a/2);let b=n+m*Math.cos(i),x=u+m*Math.sin(i),f=C(t,b,x),p=(l*s+d)*4;h.data[p]=f[0],h.data[p+1]=f[1],h.data[p+2]=f[2],h.data[p+3]=f[3]}return h};export{ee as SLIC,gt as browniFilter,re as colourSplash,at as computePixel,k as convolve,O as convolve2,st as createCanvas,lt as crop,yt as dodgeFilter,kt as embossFilter,tt as findLocalMinimum,Ot as fishEyeFilter,R as gaussianBlur,Pt as glowFilter,B as greyScaleFilter,Gt as gridFilter,Tt as halftoneFilter,Lt as hatchFilter,V as hshear,Vt as invertFilter,xe as kaleidoscopeFilter,pt as kodakChromeFilter,St as laplacianFilter,ot as loadImage,le as motionBlur,F as mult,Mt as nightVisionFilter,X as numChannels,Jt as painterlyFilter,bt as polaroidFilter,de as radialSpinBlur,Q as rgb2lab,q as rgbToHsv,C as sampleBilinear,ft as sepiaFilter,Ct as sharpenFilter,Kt as shearFilter,Qt as sketchTransform,Bt as sobelFilter,me as swirlFilter,xt as technicolourFilter,ct as transform2Filter,N as transformFilter,ut as uniformBlur,wt as vintageFilter,H as vshear};
