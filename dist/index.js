var T=t=>t.data.length/t.width/t.height,nt=async(t,r)=>{let d=new Image,o=document.createElement("canvas"),h=o.getContext("2d");return new Promise((l,a)=>{d.crossOrigin="",d.onerror=()=>{a(new Error("unable to load image"))},d.onload=()=>{d.width=r.width||d.naturalWidth,d.height=r.height||d.naturalHeight,o.width=d.width,o.height=d.height,h.drawImage(d,0,0,d.width,d.height);let s=h.getImageData(0,0,o.width,o.height);l(s)},d.src=t})},rt=(t,r)=>{let d=t.width,o=4,h=[];for(let e=r.y;e<r.y+r.height;e++)for(let l=r.x;l<r.x+r.width;l++){let a=e*d*o+l*o;for(let s=0;s<o;s++)h.push(t.data[a+s])}return new ImageData(new Uint8ClampedArray(h),r.width,r.height)},R=(t,r)=>{let d=[],o=t.data.length;for(let h=0;h<o;h+=4){let e=r({r:t.data[h+0],g:t.data[h+1],b:t.data[h+2],a:t.data[h+3]});d.push(e.r),d.push(e.g),d.push(e.b),d.push(e.a)}return new ImageData(new Uint8ClampedArray(d),t.width,t.height)},ot=(t,r,d)=>{let o=[];if(t.data.length!==r.data.length)throw new Error("images need to be same length");let h=t.data.length;for(let e=0;e<h;e+=4){let l=d({r:t.data[e+0],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]},{r:r.data[e+0],g:r.data[e+1],b:r.data[e+2],a:r.data[e+3]});o.push(l.r),o.push(l.g),o.push(l.b),o.push(l.a)}return new ImageData(new Uint8ClampedArray(o),t.width,t.height)},v=(t,r)=>{let d=Math.round(Math.sqrt(r.length)),o=Math.floor(d/2),h=t.width,e=t.height,l=T(t),a=h,s=e,u=[];for(let c=0;c<s;c++)for(let n=0;n<a;n++){let i=[];for(let f=0;f<l;f++)i.push(0);for(let f=0;f<d;f++)for(let m=0;m<d;m++){let p=c+f-o,b=n+m-o;if(p>=0&&p<e&&b>=0&&b<h){let g=(p*h+b)*l,w=r[f*d+m];for(let x=0;x<l;x++)i[x]+=t.data[g+x]*w}else for(let g=0;g<l;g++)i[g]+=t.data[(c*a+n)*l]*(1/r.length)*.28}for(let f=0;f<l;f++)u.push(i[f])}return new ImageData(new Uint8ClampedArray(u),h,e)},O=(t,r,d,o,h)=>{let e=Math.round(Math.sqrt(h.length)),l=Math.floor(e/2),a=r,s=d,u=a,c=s,n=[];for(let i=0;i<c;i++)for(let f=0;f<u;f++){let m=[];for(let p=0;p<o;p++)m.push(0);for(let p=0;p<e;p++)for(let b=0;b<e;b++){let g=i+p-l,w=f+b-l;if(g>=0&&g<s&&w>=0&&w<a){let x=(g*a+w)*o,M=h[p*e+b];for(let y=0;y<o;y++)m[y]+=t[x+y]*M}else for(let x=0;x<o;x++)m[x]+=t[(i*u+f)*o]*(1/h.length)*.28}for(let p=0;p<o;p++)n.push(m[p])}return n};var ct=(t,r)=>{let d=[],o=r*r;for(let h=0;h<o;h++)d.push(1/o);return v(t,d)};var A=(t,r)=>{let d=t.width,o=t.height,h=4,e=[];for(let l=0;l<o;l++)for(let a=0;a<d;a++){let s=h*(l*d+a),u=t.data[s+0],c=t.data[s+1],n=t.data[s+2],i=t.data[s+3],f=u*r[0]+c*r[1]+n*r[2],m=u*r[3]+c*r[4]+n*r[5],p=u*r[6]+c*r[7]+n*r[8];e.push(f),e.push(m),e.push(p),e.push(i)}return new ImageData(new Uint8ClampedArray(e),d,o)},dt=t=>A(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),ut=t=>A(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),it=t=>A(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),ft=t=>A(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),mt=t=>A(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),bt=t=>A(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]);var gt=(t,r)=>{let d=[];for(let o=0;o<t.data.length;o++){let h=t.data[o]/(255-r.data[o]);h>1&&(h=1),d.push(h*255)}return new ImageData(new Uint8ClampedArray(d),t.width,t.height)};var F=(t,r)=>{let d=t.width,o=t.height,h=4,e=new Uint8ClampedArray(d*o*h);for(let l=0;l<d*o;++l){let a=l*h;if(r){if(r.rFilter){let u=r.rFilter;if(t.data[a]>=u[0]&&t.data[a]<=u[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}if(r.gFilter){let u=r.gFilter;if(t.data[a+1]>=u[0]&&t.data[a+1]<=u[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}if(r.bFilter){let u=r.bFilter;if(t.data[a+2]>=u[0]&&t.data[a+2]<=u[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}}let s=0;for(let u=0;u<h-1;u++)s+=t.data[a+u];s/=3;for(let u=0;u<h-1;u++)e[a+u]=s;e[a+h-1]=255}return new ImageData(new Uint8ClampedArray(e),d,o)};var It=t=>v(t,[0,-1,0,-1,5,-1,0,-1,0]),Dt=t=>{let r=F(t);return v(r,[-2,-1,0,-1,1,1,0,1,2])},vt=t=>{let r=[-1,-1,-1,-1,8,-1,-1,-1,-1],d=[],o=F(t);for(let l=0;l<o.data.length;l++)l%4==0&&d.push(t.data[l]);let h=O(d,t.width,t.height,1,r),e=[];for(let l=0;l<h.length;l++)e.push(h[l]),e.push(h[l]),e.push(h[l]),e.push(255);return new ImageData(new Uint8ClampedArray(e),t.width,t.height)},Ct=t=>{let r=[-1,0,1,-2,0,2,-1,0,1],d=[-1,-2,-1,0,0,0,1,2,1],o=F(t),h=[];for(let s=0;s<o.data.length;s++)s%4==0&&h.push(o.data[s]);let e=O(h,t.width,t.height,1,r),l=O(h,t.width,t.height,1,d),a=[];for(let s=0;s<e.length;s++){let u=Math.sqrt(e[s]*e[s]+l[s]*l[s]);a.push(Math.min(255,u)),a.push(Math.min(255,u)),a.push(Math.min(255,u)),a.push(255)}return new ImageData(new Uint8ClampedArray(a),t.width,t.height)};var Ft=(t,r,d,o,h)=>{let e=t.width,l=t.height,a=4,s=[];for(let u=0;u<l;u++)for(let c=0;c<e;c++){let n=c-r,i=u-d,f=Math.sqrt(n*n+i*i);if(f<o){let m=Math.floor(r+n*h*f),p=Math.floor(d+i*h*f),b=a*(p*e+m);s.push(t.data[b]),s.push(t.data[b+1]),s.push(t.data[b+2]),s.push(255)}else{let m=a*(u*e+c);s.push(t.data[m]),s.push(t.data[m+1]),s.push(t.data[m+2]),s.push(t.data[m+3])}}return new ImageData(new Uint8ClampedArray(s),t.width,t.height)};var E=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],W=t=>v(t,E);var G=(t,r,d)=>`rgb(${t},${r},${d})`,L=(t,r,d,o)=>{let{width:h,data:e}=t,l=o.kernel,a=l*l,s=0,u=0,c=0;for(let p=d;p<d+l;p++)for(let b=r;b<r+l;b++){let g=(p*h+b)*4;s+=e[g]||0,u+=e[g+1]||0,c+=e[g+2]||0}let n=(o.rWeight*s+o.gWeight*u+o.bWeight*c)/(255*a),i=s/a,f=u/a,m=c/a;return{v:n,avgR:i,avgG:f,avgB:m}},jt=(t,r)=>{let d=r.kernel,o=t.width,h=t.height;r.rWeight||(r.rWeight=.2),r.gWeight||(r.gWeight=.2),r.bWeight||(r.bWeight=.2);let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let l=e.getContext("2d"),a=(d-1)*.5;for(let s=0;s<=h-d;s+=d)for(let u=0;u<=o-d;u+=d){let{v:c,avgR:n,avgG:i,avgB:f}=L(t,u,s,r),m=d/2*(1-c);l.beginPath(),l.fillStyle=G(n,i,f),l.ellipse(Math.random()*0+u+a,Math.random()*0+s+a,m,m,0,0,2*Math.PI),l.fill(),l.closePath()}return l.getImageData(0,0,o,h)};var Rt=t=>{let r=W(t);r=F(r);let d=[];for(let o=0;o<t.data.length;o++)if(o%4!=3){let h=Math.min(255,.5*r.data[o]+.9*t.data[o]);d.push(h)}else d.push(255);return new ImageData(new Uint8ClampedArray(d),t.width,t.height)};var qt=(t,r,d)=>{let o=t.width,h=t.height,e=4,l=[];for(let a=0;a<h;a++)for(let s=0;s<o;s++){let u=e*(a*o+s);a%r<d||s%r<d?(l.push(255),l.push(255),l.push(255),l.push(255)):(l.push(t.data[u+0]),l.push(t.data[u+1]),l.push(t.data[u+2]),l.push(255))}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var $=(t,r,d)=>(t*.299+r*.587+d*.114)/255,Tt=(t,r,d,o,h)=>{let e=t.width,l=t.height,a=4,s=[],u=10;for(let c=0;c<l;c++)for(let n=0;n<e;n++){let i=a*(c*e+n),f=t.data[i+0],m=t.data[i+1],p=t.data[i+2],b=$(f,m,p),g=245,w=245,x=245,M=6;b<r&&(n+c)%M==0&&(g=4*u,w=4*u,x=4*u),b<d&&(n-c)%M==0&&(g=4*u,w=4*u,x=4*u),b<o&&(n+c-5)%M==0&&(g=4*u,w=4*u,x=4*u),b<h&&(n-c-5)%M==0&&(g=8*u,w=8*u,x=8*u),s.push(g),s.push(w),s.push(x),s.push(255)}return new ImageData(new Uint8ClampedArray(s),t.width,t.height)};var Lt=t=>R(t,r=>({r:255-r.r,g:255-r.g,b:255-r.b,a:r.a}));var _t=(t,r,d)=>{let o=t.width,h=t.height,e=4,l=new Uint8ClampedArray(t.data);for(let a=r;a<h-r;a++)for(let s=r;s<o-r;s++){let u=[],c=[],n=[],i=[];for(let b=0;b<d;b++)u.push(0),c.push(0),n.push(0),i.push(0);for(let b=-r;b<=r;b++)for(let g=-r;g<=r;g++){let w=e*((a+b)*o+(s+g)),x=t.data[w+0],M=t.data[w+1],y=t.data[w+2],I=Math.floor((x+M+y)/3*d/255);u[I]++,c[I]+=x,n[I]+=M,i[I]+=y}let f=0,m=0;for(let b=0;b<d;b++)u[b]>f&&(f=u[b],m=b);let p=e*(a*o+s);l[p+0]=c[m]/f,l[p+1]=n[m]/f,l[p+2]=i[m]/f}return new ImageData(l,o,h)};var _=(t,r,d)=>{let o=t.width,h=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,h),l=Math.floor(Math.random()*d),a=0,s=!1;for(let u=0;u<o;u++){if(a++,s){for(let c=0;c<h-l;c++){let n=4*(c*o+u),i=4*((c+l)*o+u);e.data[n]=t.data[i],e.data[n+1]=t.data[i+1],e.data[n+2]=t.data[i+2],e.data[n+3]=t.data[i+3]}for(let c=h-l;c<h;c++){let n=4*(c*o+u);e.data[n]=255,e.data[n+1]=255,e.data[n+2]=255,e.data[n+3]=255}}else{for(let c=0;c<l;c++){let n=4*(c*o+u);e.data[n]=255,e.data[n+1]=255,e.data[n+2]=255,e.data[n+3]=255}for(let c=l;c<h;c++){let n=4*(c*o+u),i=4*((c-l)*o+u);e.data[n]=t.data[i],e.data[n+1]=t.data[i+1],e.data[n+2]=t.data[i+2],e.data[n+3]=t.data[i+3]}}a==r&&(l=Math.floor(Math.random()*d),s=!s,a=0)}return e},X=(t,r,d)=>{let o=t.width,h=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,h),l=Math.floor(Math.random()*d),a=0,s=!1;for(let u=0;u<h;u++){if(a++,s){for(let c=0;c<o-l;c++){let n=4*(u*o+c),i=4*(u*o+c+l);e.data[n]=t.data[i],e.data[n+1]=t.data[i+1],e.data[n+2]=t.data[i+2],e.data[n+3]=t.data[i+3]}for(let c=o-l;c<o;c++){let n=4*(u*o+c);e.data[n]=255,e.data[n+1]=255,e.data[n+2]=255,e.data[n+3]=255}}else{for(let c=l;c<o;c++){let n=4*(u*o+c),i=4*(u*o+c-l);e.data[n]=t.data[i],e.data[n+1]=t.data[i+1],e.data[n+2]=t.data[i+2],e.data[n+3]=t.data[i+3]}for(let c=0;c<l;c++){let n=4*(u*o+c);e.data[n]=255,e.data[n+1]=255,e.data[n+2]=255,e.data[n+3]=255}}a==r&&(l=Math.floor(Math.random()*d),s=!s,a=0)}return e},Ht=(t,r,d,o,h)=>{let e=X(t,r,d);return _(e,o,h)};var Vt=(t,r)=>{let d=t.width,o=t.height,h=t.data,e=new Set,l=[];for(let c=0;c<d;c++)for(let n=0;n<o;n++){let i=(c+n*d)*4,f=h[i]+":"+h[i+1]+":"+h[i+2];e.has(f)||(e.add(f),l.push([h[i+0],h[i+1],h[i+2]]))}let a={};for(;;){let c=r.levelSteps;a={};for(let i of l){let f=i[0],m=i[1],p=i[2],b=Math.round(f/255*(c-1)),g=Math.round(m/255*(c-1)),w=Math.round(p/255*(c-1));for(let x=-1;x<=1;x++)for(let M=-1;M<=1;M++)for(let y=-1;y<=1;y++){let I=b+x+":"+(g+M)+":"+(w+y);a[I]=!0}}let n=NaN;if(Object.keys(a).length>n&&r.levelSteps>2){r.levelSteps--,console.log("Reducing to "+r.levelSteps+" RGB steps");continue}break}let{canvases:s,imageDatas:u}=J(d,o,a,r);return H(t,u,r)},H=(t,r,d)=>{let o=t.width,h=t.height,e=t.data,l=[];for(let a=0;a<o;a++)for(let s=0;s<h;s++){let u=a+s*o;l[u*3]=e[u*4],l[u*3+1]=e[u*4+1],l[u*3+2]=e[u*4+2]}l=Z(l,{width:o,height:h,blurAmount:d.edgeBlurAmount});for(let a=0;a<o;a++)for(let s=0;s<h;s++){let u=a+s*o,c=e[u*4],n=e[u*4+1],i=e[u*4+2],f=V(r,u,c,n,i,d.levelSteps);if(d.greyScale){let p=Math.round((f.red+f.green+f.blue)/3);f.red=f.green=f.blue=p}let m=Math.max(0,(255-l[a+s*o]*d.edgeAmount)/255);m=Math.min(1,Math.max(.5,m*m)),e[u*4]=Math.round(f.red*m),e[u*4+1]=Math.round(f.green*m),e[u*4+2]=Math.round(f.blue*m)}return t},J=(t,r,d,o)=>{let h=performance.now(),e=o.levelSteps,l=[],a=[],s=o.lineThickness,u=o.lineLength,c=1-o.darkeningFactor,n=o.lineAlpha,i=o.lineDensity*2,f=o.lightness;for(let p=-1;p<=e;p++){l[p]={},a[p]={};for(let b=-1;b<=e;b++)l[p][b]={},a[p][b]={}}for(let p in d){let b=p.split(":"),g=parseInt(b[0]),w=parseInt(b[1]),x=parseInt(b[2]),M=255*g/(e-1),y=255*w/(e-1),I=255*x/(e-1);M=Math.min(255,Math.max(0,M)),y=Math.min(255,Math.max(0,y)),I=Math.min(255,Math.max(0,I));let k=1-Math.min(M,y,I)/255,S="";if(k>0){let D=Math.pow(1/k,1/f),U=Math.round((255-(255-M)*D)*c),B=Math.round((255-(255-y)*D)*c),P=Math.round((255-(255-I)*D)*c);S=`rgb(${U}, ${B}, ${P})`}else{let D=Math.round(M*c),U=Math.round(y*c),B=Math.round(I*c);S=`rgb(${D}, ${U}, ${B})`}let C=0,j=0;if(Math.abs(y-I)>.1||Math.abs(2*M-y-I)>.1){j=Math.atan2(Math.sqrt(3)*(y-I),2*M-y-I);let D=Math.max(255-M,255-y,255-I),U=Math.min(255-M,255-y,255-I);C=(D-U)/D,C==0&&(j=Math.random()*Math.PI*2)}else j=0,C=0;let q=Math.PI*(.1+.9*Math.pow(1-C,3)),N=Y(t,r,j/2+Math.PI*.3,q,s,u,k*i,S,n);l[g][w][x]=N,a[g][w][x]=N.getContext("2d").getImageData(0,0,t,r)}let m=performance.now();return console.log("create textures....",m-h),{canvases:l,imageDatas:a}},V=(t,r,d,o,h,e)=>{r*=4;let l=d/255*(e-1),a=o/255*(e-1),s=h/255*(e-1),u=l,c=a,n=s;l=Math.round(l),a=Math.round(a),s=Math.round(s);let i=0;for(let g=-1;g<=1;g++)for(let w=-1;w<=1;w++)for(let x=-1;x<=1;x++){let M=(.75-Math.abs(l+g-u)/2)*(.75-Math.abs(a+w-c)/2)*(.75-Math.abs(s+x-n)/2);if(M<0)throw new Error("debug");i+=M}let f=0,m=0,p=0;for(let g=-1;g<=1;g++)for(let w=-1;w<=1;w++)for(let x=-1;x<=1;x++){let M=(.75-Math.abs(l+g-u)/2)*(.75-Math.abs(a+w-c)/2)*(.75-Math.abs(s+x-n)/2);M/=i;let y=t[l+g][a+w][s+x];if(y==null)throw new Error("debug me!");f+=y.data[r]*M,m+=y.data[r+1]*M,p+=y.data[r+2]*M}let b=1-(1-(e+1)/e)*.25;return{red:Math.min(255,Math.round(f*b)),green:Math.min(255,Math.round(m*b)),blue:Math.min(255,Math.round(p*b))}},Y=(t,r,d,o,h,e,l,a,s)=>{let u=l*t*r/e/h/s,c=document.createElement("canvas");c.width=t,c.height=r;let n=c.getContext("2d");n.strokeStyle=a,n.globalAlpha=1,n.fillStyle="#FFFFFF",n.fillRect(0,0,t,r),n.globalAlpha=s,n.lineWidth=h;for(let i=0;i<u;i++){let f=d+Math.round(Math.random()*2-1)/2*o,m=Math.random()*t,p=Math.random()*r,b=e/2*Math.cos(f),g=e/2*Math.sin(f),w=m+b,x=m-b,M=p+g,y=p-g;n.beginPath(),n.moveTo(w,M),n.lineTo(x,y),n.stroke()}return c},Z=(t,r)=>{let d=r.width,o=r.height,h=r.blurAmount,e=[],l=[];for(let c=0;c<d;c++){let n=[0,0,0],i=[0,0,0];for(let f=0;f<o;f++){let m=c+f*d;n[0]+=t[m*3+0],n[1]+=t[m*3+1],n[2]+=t[m*3+2],i[0]+=t[m*3+0]*t[m*3+0],i[1]+=t[m*3+1]*t[m*3+1],i[2]+=t[m*3+2]*t[m*3+2],e[m]=n.slice(0),l[m]=i.slice(0)}}let a=[],s=[];for(let c=0;c<o;c++){let n=[0,0,0],i=[0,0,0];for(let f=0;f<d;f++){let m=f+c*d,p=f+Math.max(0,Math.round(c-h/2))*d,b=f+Math.min(o-1,Math.round(c+h/2))*d;n[0]+=(e[b][0]-e[p][0])/(b-p)*d,n[1]+=(e[b][1]-e[p][1])/(b-p)*d,n[2]+=(e[b][2]-e[p][2])/(b-p)*d,i[0]+=(l[b][0]-l[p][0])/(b-p)*d,i[1]+=(l[b][1]-l[p][1])/(b-p)*d,i[2]+=(l[b][2]-l[p][2])/(b-p)*d,a[m]=n.slice(0),s[m]=i.slice(0)}}let u=[];for(let c=0;c<d;c++)for(let n=0;n<o;n++){let i=c+n*d,f=Math.max(0,Math.round(c-h/2))+n*d,m=Math.min(d-1,Math.round(c+h/2))+n*d,p=(a[m][0]-a[f][0])/(m-f),b=(a[m][1]-a[f][1])/(m-f),g=(a[m][2]-a[f][2])/(m-f),w=(s[m][0]-s[f][0])/(m-f),x=(s[m][1]-s[f][1])/(m-f),M=(s[m][2]-s[f][2])/(m-f);u[i]=Math.sqrt(w+x+M-(p*p+b*b+g*g)),isNaN(u[i])&&(u[i]=0)}return u};var K=(t,r,d)=>{let o=t/255,h=r/255,e=d/255,l,a,s;o<=.04045?l=o/12.92:l=Math.pow((o+.055)/1.055,2.4),h<=.04045?a=h/12.92:a=Math.pow((h+.055)/1.055,2.4),e<=.04045?s=e/12.92:s=Math.pow((e+.055)/1.055,2.4);let u,c,n;u=l*.4124564+a*.3575761+s*.1804375,c=l*.2126729+a*.7151522+s*.072175,n=l*.0193339+a*.119192+s*.9503041;let i=.008856,f=903.3,m=.950456,p=1,b=1.088754,g=u/m,w=c/p,x=n/b,M,y,I;g>i?M=Math.pow(g,1/3):M=(f*g+16)/116,w>i?y=Math.pow(w,1/3):y=(f*w+16)/116,x>i?I=Math.pow(x,1/3):I=(f*x+16)/116;let k=116*y-16,S=500*(M-y),C=200*(y-I);return{l:k,a:S,b:C}},z=(t,r,d)=>{let o=Number.MAX_VALUE,h={x:0,y:0,l:0,a:0,b:0},e=t.width,l=t.height;for(let a=r-1;a<=r+1&&a>=0&&a<l-1;a++)for(let s=d-1;s<=d+1&&s>=0&&s<e-1;s++){let u=t.data[4*(a*e+s+1)],c=t.data[4*((a+1)*e+s+1)],n=t.data[4*(a*e+s)];Math.sqrt(Math.pow(u-n,2))+Math.sqrt(Math.pow(c-n,2))<o&&(o=Math.abs(u-n)+Math.abs(c-n),h.x=a,h.y=s)}return h},Q=(t,r,d,o,h,e)=>{let l=t.width,a=Math.sqrt(Math.pow(r.l-t.data[4*(d*l+o)],2)+Math.pow(r.a-t.data[4*(d*l+o)+1],2)+Math.pow(r.b-t.data[4*(d*l+o)+2],2)),s=Math.sqrt(Math.pow(r.x-d,2)+Math.pow(r.y-o,2));return Math.pow(a/e,2)+Math.pow(s/h,2)},tt=(t,r,d,o)=>{console.log("computing.............................");let h=t.width,e=t.height,l=Array.from({length:h*e}).map(s=>s=-1),a=new Array;for(let s=r;s<e;s+=r)for(let u=r;u<h;u+=r){let c=z(t,s,u);c.l=t.data[4*(c.x*h+c.y)],c.a=t.data[4*(c.x*h+c.y)+1],c.b=t.data[4*(c.x*h+c.y)+2],a.push(c)}for(let s=0;s<d;s++){let u=Array.from({length:h*e}).map(n=>n=Number.MAX_VALUE);for(let n=0;n<a.length;n++)for(let i=a[n].x-r;i<a[n].x+r;i++)for(let f=a[n].y-r;f<a[n].y+r;f++)if(i>=0&&i<e&&f>=0&&f<h){let m=Q(t,a[n],i,f,r,o);m<u[i*h+f]&&(u[i*h+f]=m,l[i*h+f]=n)}let c=JSON.parse(JSON.stringify(a));for(let n of a)n.c=n.l=n.a=n.b=n.x=n.y=0;for(let n=0;n<e;n++)for(let i=0;i<h;i++){let f=l[n*h+i];f!=-1&&(a[f].l+=t.data[4*(n*h+i)],a[f].a+=t.data[4*(n*h+i)+1],a[f].b+=t.data[4*(n*h+i)+2],a[f].x+=n,a[f].y+=i,a[f].c+=1)}for(let n in a)a[n].c==0||a[n].x==null||a[n].y==null?a[n]=JSON.parse(JSON.stringify(c[n])):(a[n].l/=a[n].c,a[n].a/=a[n].c,a[n].b/=a[n].c,a[n].x=Math.floor(a[n].x/a[n].c),a[n].y=Math.floor(a[n].y/a[n].c))}return console.log("compute done............................."),{clusterID:l,centers:a}},et=(t,r,d,o)=>{console.log("painting...................");let h=t.width,e=t.height,l=Math.ceil(e/o),a=Math.ceil(h/o),s=new Uint8ClampedArray(h*e*4);for(let u=0;u<l;u++)for(let c=0;c<a;c++){let n=u*o,i=c*o,f={};for(let b=n;b<n+o&&b<e;b++)for(let g=i;g<i+o&&g<h;g++){let w=d[b*h+g];w!=-1&&(f[w]?f[w]++:f[w]=1)}let m=-1,p=Number.MIN_VALUE;for(let b in f)f[b]>p&&(p=f[b],m=+b);for(let b=n;b<n+o&&b<e;b++)for(let g=i;g<i+o&&g<h;g++)s[4*(b*h+g)]=t.data[4*(r[m].x*h+r[m].y)],s[4*(b*h+g)+1]=t.data[4*(r[m].x*h+r[m].y)+1],s[4*(b*h+g)+2]=t.data[4*(r[m].x*h+r[m].y)+2],s[4*(b*h+g)+3]=t.data[4*(r[m].x*h+r[m].y)+3]}return console.log("painting done..................."),s},at=(t,r,d)=>{let o=[-1,-1,0,1,1,1,0,-1],h=[0,-1,-1,-1,0,1,1,1],e=[],l=Array.from({length:d}).map(a=>a=Array.from({length:r}).map(s=>s=!1));for(let a=0;a<d;a++)for(let s=0;s<r;s++){let u=0;for(let c=0;c<8;c++){let n=a+o[c],i=s+h[c];n>=0&&n<d&&i>=0&&i<r&&l[n][i]==!1&&t[a*r+s]!=t[n*r+i]&&(u+=1)}u>=2&&(e.push({x:a,y:s}),l[a][s]=!0)}return e},Zt=(t,r,d,o,h)=>{let e=t.width,l=t.height,a=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<e*l;i+=4){let f=K(t.data[i],t.data[i+1],t.data[i+2]);a.data[i]=f.l,a.data[i+2]=f.a,a.data[i+3]=f.b}let{clusterID:s,centers:u}=tt(a,r,d,h),c=et(t,u,s,o),n=at(s,e,l);for(let i=0;i<n.length;i++){let f=4*(n[i].x*e+n[i].y);c[f]=255,c[f+1]=255,c[f+2]=255,c[f+3]=255}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};export{Zt as SLIC,mt as browniFilter,tt as computePixel,v as convolve,O as convolve2,rt as crop,gt as dodgeFilter,Dt as embossFilter,z as findLocalMinimum,Ft as fishEyeFilter,W as gaussianBlur,Rt as glowFilter,F as greyScaleFilter,qt as gridFilter,jt as halftoneFilter,Tt as hatchFilter,X as hshear,Lt as invertFilter,ft as kodakChromeFilter,vt as laplacianFilter,nt as loadImage,T as numChannels,_t as painterlyFilter,ut as polaroidfilter,K as rgb2lab,dt as sepiaFilter,It as sharpenFilter,Ht as shearFilter,Vt as sketchTransform,Ct as sobelFilter,it as technicolourfilter,ot as transform2Filter,R as transformFilter,ct as uniformBlur,bt as vintageFilter,_ as vshear};
