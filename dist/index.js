var X=t=>t.data.length/t.width/t.height,ot=async(t,n)=>{let u=new Image,o=document.createElement("canvas"),s=o.getContext("2d");return new Promise((l,a)=>{u.crossOrigin="",u.onerror=()=>{a(new Error("unable to load image"))},u.onload=()=>{u.width=n.width||u.naturalWidth,u.height=n.height||u.naturalHeight,o.width=u.width,o.height=u.height,s.drawImage(u,0,0,u.width,u.height);let c=s.getImageData(0,0,o.width,o.height);l(c)},u.src=t})},st=t=>{let n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").putImageData(t,0,0),n},lt=(t,n)=>{let u=t.width,o=4,s=n.width,e=n.height,l=new Uint8ClampedArray(s*e*o),a=0;for(let c=n.y;c<n.y+n.height;c++)for(let d=n.x;d<n.x+n.width;d++){let h=c*u*o+d*o;for(let r=0;r<o;r++)l[a++]=t.data[h+r]}return new ImageData(l,s,e)},N=(t,n)=>{let u=t.data.length,o=new Uint8ClampedArray(u);for(let s=0;s<u;s+=4){let e=s/4,l=n({r:t.data[s+0],g:t.data[s+1],b:t.data[s+2],a:t.data[s+3],x:e%t.width,y:Math.floor(e/t.height)});o[s+0]=l.r,o[s+1]=l.g,o[s+2]=l.b,o[s+3]=l.a}return new ImageData(o,t.width,t.height)},ct=(t,n,u)=>{if(t.data.length!==n.data.length)throw new Error("images need to be same length");let o=t.data.length,s=new Uint8ClampedArray(o);for(let e=0;e<o;e+=4){let l=u({r:t.data[e+0],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]},{r:n.data[e+0],g:n.data[e+1],b:n.data[e+2],a:n.data[e+3]});s[e+0]=l.r,s[e+1]=l.g,s[e+2]=l.b,s[e+3]=l.a}return new ImageData(s,t.width,t.height)},k=(t,n)=>{let{width:u,height:o,data:s}=t,e=X(t),l=O(Array.from(s),u,o,e,n);return new ImageData(new Uint8ClampedArray(l),u,o)},O=(t,n,u,o,s)=>{let e=Math.round(Math.sqrt(s.length)),l=Math.floor(e/2),a=n,c=u,d=a,h=c,r=[],i=1/s.length*.28;for(let m=0;m<h;m++)for(let b=0;b<d;b++){let x=[];for(let f=0;f<o;f++)x.push(0);for(let f=0;f<e;f++)for(let p=0;p<e;p++){let M=m+f-l,w=b+p-l;if(M>=0&&M<c&&w>=0&&w<a){let g=(M*a+w)*o,I=s[f*e+p];for(let y=0;y<o;y++)x[y]+=t[g+y]*I}else for(let g=0;g<o;g++)x[g]+=t[(m*d+b)*o]*i}for(let f=0;f<o;f++)r.push(x[f])}return r},A=(t,n)=>{let u=t.width,o=t.height,s=4,e=[];for(let l=0;l<o;l++)for(let a=0;a<u;a++){let c=s*(l*u+a),d=t.data[c+0],h=t.data[c+1],r=t.data[c+2],i=t.data[c+3],m=d*n[0]+h*n[1]+r*n[2],b=d*n[3]+h*n[4]+r*n[5],x=d*n[6]+h*n[7]+r*n[8];e.push(m),e.push(b),e.push(x),e.push(i)}return new ImageData(new Uint8ClampedArray(e),u,o)},T=(t,n,u)=>{let o=Math.max(t,n,u),s=Math.min(t,n,u),e=o-s,l=0;e!==0&&(o===t?l=((n-u)/e+(n<u?6:0))/6:o===n?l=((u-t)/e+2)/6:l=((t-n)/e+4)/6);let a=o===0?0:e/o;return{h:l,s:a,v:o}},C=(t,n,u)=>{let{width:o,height:s,data:e}=t;if(e.length/o/s!==4)throw new Error("Only support rgba channels currently...");let a=Math.max(0,Math.min(o-1,n)),c=Math.max(0,Math.min(s-1,u)),d=Math.floor(a),h=Math.floor(c),r=Math.min(d+1,o-1),i=Math.min(h+1,s-1),m=a-d,b=c-h;function x(y,D){let v=(D*o+y)*4;return[e[v],e[v+1],e[v+2],e[v+3]]}let f=x(d,h),p=x(r,h),M=x(d,i),w=x(r,i),g=f.map((y,D)=>y*(1-m)+p[D]*m),I=M.map((y,D)=>y*(1-m)+w[D]*m);return g.map((y,D)=>y*(1-b)+I[D]*b)};var ut=(t,n)=>{let u=[],o=n*n;for(let s=0;s<o;s++)u.push(1/o);return k(t,u)};var ft=t=>A(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),bt=t=>A(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),xt=t=>A(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),pt=t=>A(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),gt=t=>A(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),wt=t=>A(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]),Mt=t=>A(t,[.1,.4,.1,.2,.8,.2,.1,.4,.1]);var yt=(t,n)=>{let u=[];for(let o=0;o<t.data.length;o++){let s=t.data[o]/(255-n.data[o]);s>1&&(s=1),u.push(s*255)}return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var B=(t,n)=>{let u=t.width,o=t.height,s=4,e=new Uint8ClampedArray(u*o*s);for(let l=0;l<u*o;++l){let a=l*s;if(n){if(n.rFilter){let d=n.rFilter;if(t.data[a]>=d[0]&&t.data[a]<=d[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}if(n.gFilter){let d=n.gFilter;if(t.data[a+1]>=d[0]&&t.data[a+1]<=d[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}if(n.bFilter){let d=n.bFilter;if(t.data[a+2]>=d[0]&&t.data[a+2]<=d[1]){e[a]=t.data[a],e[a+1]=t.data[a+1],e[a+2]=t.data[a+2],e[a+3]=255;continue}}}let c=0;for(let d=0;d<s-1;d++)c+=t.data[a+d];c/=3;for(let d=0;d<s-1;d++)e[a+d]=c;e[a+s-1]=255}return new ImageData(new Uint8ClampedArray(e),u,o)};var Ct=t=>k(t,[0,-1,0,-1,5,-1,0,-1,0]),kt=t=>{let n=B(t);return k(n,[-2,-1,0,-1,1,1,0,1,2])},St=t=>{let n=[-1,-1,-1,-1,8,-1,-1,-1,-1],u=[],o=B(t);for(let l=0;l<o.data.length;l++)l%4===0&&u.push(t.data[l]);let s=O(u,t.width,t.height,1,n),e=[];for(let l=0;l<s.length;l++)e.push(s[l]),e.push(s[l]),e.push(s[l]),e.push(255);return new ImageData(new Uint8ClampedArray(e),t.width,t.height)},Bt=t=>{let n=[-1,0,1,-2,0,2,-1,0,1],u=[-1,-2,-1,0,0,0,1,2,1],o=B(t),s=[];for(let c=0;c<o.data.length;c++)c%4===0&&s.push(o.data[c]);let e=O(s,t.width,t.height,1,n),l=O(s,t.width,t.height,1,u),a=[];for(let c=0;c<e.length;c++){let d=Math.sqrt(e[c]*e[c]+l[c]*l[c]);a.push(Math.min(255,d)),a.push(Math.min(255,d)),a.push(Math.min(255,d)),a.push(255)}return new ImageData(new Uint8ClampedArray(a),t.width,t.height)};var Ot=(t,n,u,o,s)=>{let e=t.width,l=t.height,a=4,c=[];for(let d=0;d<l;d++)for(let h=0;h<e;h++){let r=h-n,i=d-u,m=Math.sqrt(r*r+i*i);if(m<o){let b=Math.floor(n+r*s*m),x=Math.floor(u+i*s*m),f=a*(x*e+b);c.push(t.data[f]),c.push(t.data[f+1]),c.push(t.data[f+2]),c.push(255)}else{let b=a*(d*e+h);c.push(t.data[b]),c.push(t.data[b+1]),c.push(t.data[b+2]),c.push(t.data[b+3])}}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var G=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],R=t=>k(t,G);var L=(t,n,u)=>`rgb(${t},${n},${u})`,Y=(t,n,u,o)=>{let{width:s,data:e}=t,l=o.kernel,a=l*l,c=0,d=0,h=0;for(let x=u;x<u+l;x++)for(let f=n;f<n+l;f++){let p=(x*s+f)*4;c+=e[p]||0,d+=e[p+1]||0,h+=e[p+2]||0}let r=(o.rWeight*c+o.gWeight*d+o.bWeight*h)/(255*a),i=c/a,m=d/a,b=h/a;return{v:r,avgR:i,avgG:m,avgB:b}},Pt=(t,n)=>{let u=n.kernel,o=t.width,s=t.height;n.rWeight||(n.rWeight=.2),n.gWeight||(n.gWeight=.2),n.bWeight||(n.bWeight=.2);let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let l=e.getContext("2d"),a=(u-1)*.5;for(let c=0;c<=s-u;c+=u)for(let d=0;d<=o-u;d+=u){let{v:h,avgR:r,avgG:i,avgB:m}=Y(t,d,c,n),b=u/2*(1-h),x=0;n.shiftYAmt&&n.shiftYStride&&(x=d%(n.shiftYStride*u)===0?0:n.shiftYAmt);let f=0;n.shiftXAmt&&n.shiftXStride&&(x=d%(n.shiftXStride*u)===0?0:n.shiftXAmt),l.beginPath(),l.fillStyle=L(r,i,m),l.ellipse(f+d+a,x+c+a,b,b,0,0,2*Math.PI),l.fill(),l.closePath()}return l.getImageData(0,0,o,s)};var Et=t=>{let n=R(t);n=B(n);let u=[];for(let o=0;o<t.data.length;o++)if(o%4!==3){let s=Math.min(255,.5*n.data[o]+.9*t.data[o]);u.push(s)}else u.push(255);return new ImageData(new Uint8ClampedArray(u),t.width,t.height)};var Gt=(t,n,u)=>{let o=t.width,s=t.height,e=4,l=[];for(let a=0;a<s;a++)for(let c=0;c<o;c++){let d=e*(a*o+c);a%n<u||c%n<u?(l.push(255),l.push(255),l.push(255),l.push(255)):(l.push(t.data[d+0]),l.push(t.data[d+1]),l.push(t.data[d+2]),l.push(255))}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var $=(t,n,u)=>(t*.299+n*.587+u*.114)/255,Yt=(t,n,u,o,s)=>{let e=t.width,l=t.height,a=4,c=[],d=10;for(let h=0;h<l;h++)for(let r=0;r<e;r++){let i=a*(h*e+r),m=t.data[i+0],b=t.data[i+1],x=t.data[i+2],f=$(m,b,x),p=245,M=245,w=245,g=6;f<n&&(r+h)%g===0&&(p=4*d,M=4*d,w=4*d),f<u&&(r-h)%g===0&&(p=4*d,M=4*d,w=4*d),f<o&&(r+h-5)%g===0&&(p=4*d,M=4*d,w=4*d),f<s&&(r-h-5)%g===0&&(p=8*d,M=8*d,w=8*d),c.push(p),c.push(M),c.push(w),c.push(255)}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var _t=t=>N(t,n=>({r:255-n.r,g:255-n.g,b:255-n.b,a:n.a}));var Jt=(t,n,u)=>{let o=t.width,s=t.height,e=4,l=new Uint8ClampedArray(t.data);for(let a=n;a<s-n;a++)for(let c=n;c<o-n;c++){let d=[],h=[],r=[],i=[];for(let f=0;f<u;f++)d.push(0),h.push(0),r.push(0),i.push(0);for(let f=-n;f<=n;f++)for(let p=-n;p<=n;p++){let M=e*((a+f)*o+(c+p)),w=t.data[M+0],g=t.data[M+1],I=t.data[M+2],y=Math.floor((w+g+I)/3*u/255);d[y]++,h[y]+=w,r[y]+=g,i[y]+=I}let m=0,b=0;for(let f=0;f<u;f++)d[f]>m&&(m=d[f],b=f);let x=e*(a*o+c);l[x+0]=h[b]/m,l[x+1]=r[b]/m,l[x+2]=i[b]/m}return new ImageData(l,o,s)};var H=(t,n,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),l=Math.floor(Math.random()*u),a=0,c=!1;for(let d=0;d<o;d++){if(a++,c){for(let h=0;h<s-l;h++){let r=4*(h*o+d),i=4*((h+l)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let h=s-l;h<s;h++){let r=4*(h*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let h=0;h<l;h++){let r=4*(h*o+d);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}for(let h=l;h<s;h++){let r=4*(h*o+d),i=4*((h-l)*o+d);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}}a==n&&(l=Math.floor(Math.random()*u),c=!c,a=0)}return e},_=(t,n,u)=>{let o=t.width,s=t.height,e=new ImageData(new Uint8ClampedArray(t.data),o,s),l=Math.floor(Math.random()*u),a=0,c=!1;for(let d=0;d<s;d++){if(a++,c){for(let h=0;h<o-l;h++){let r=4*(d*o+h),i=4*(d*o+h+l);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let h=o-l;h<o;h++){let r=4*(d*o+h);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}else{for(let h=l;h<o;h++){let r=4*(d*o+h),i=4*(d*o+h-l);e.data[r]=t.data[i],e.data[r+1]=t.data[i+1],e.data[r+2]=t.data[i+2],e.data[r+3]=t.data[i+3]}for(let h=0;h<l;h++){let r=4*(d*o+h);e.data[r]=255,e.data[r+1]=255,e.data[r+2]=255,e.data[r+3]=255}}a==n&&(l=Math.floor(Math.random()*u),c=!c,a=0)}return e},Kt=(t,n,u,o,s)=>{let e=_(t,n,u);return H(e,o,s)};var Qt=(t,n)=>{let u=t.width,o=t.height,s=t.data,e=new Set,l=[];for(let h=0;h<u;h++)for(let r=0;r<o;r++){let i=(h+r*u)*4,m=s[i]+":"+s[i+1]+":"+s[i+2];e.has(m)||(e.add(m),l.push([s[i+0],s[i+1],s[i+2]]))}let a={};for(;;){let h=n.levelSteps;a={};for(let i of l){let m=i[0],b=i[1],x=i[2],f=Math.round(m/255*(h-1)),p=Math.round(b/255*(h-1)),M=Math.round(x/255*(h-1));for(let w=-1;w<=1;w++)for(let g=-1;g<=1;g++)for(let I=-1;I<=1;I++){let y=f+w+":"+(p+g)+":"+(M+I);a[y]=!0}}if(Object.keys(a).length>NaN&&n.levelSteps>2){n.levelSteps--,console.log("Reducing to "+n.levelSteps+" RGB steps");continue}break}let{canvases:c,imageDatas:d}=J(u,o,a,n);return V(t,d,n)},V=(t,n,u)=>{let o=t.width,s=t.height,e=t.data,l=[];for(let a=0;a<o;a++)for(let c=0;c<s;c++){let d=a+c*o;l[d*3]=e[d*4],l[d*3+1]=e[d*4+1],l[d*3+2]=e[d*4+2]}l=z(l,{width:o,height:s,blurAmount:u.edgeBlurAmount});for(let a=0;a<o;a++)for(let c=0;c<s;c++){let d=a+c*o,h=e[d*4],r=e[d*4+1],i=e[d*4+2],m=Z(n,d,h,r,i,u.levelSteps);if(u.greyScale){let x=Math.round((m.red+m.green+m.blue)/3);m.red=m.green=m.blue=x}let b=Math.max(0,(255-l[a+c*o]*u.edgeAmount)/255);b=Math.min(1,Math.max(.5,b*b)),e[d*4]=Math.round(m.red*b),e[d*4+1]=Math.round(m.green*b),e[d*4+2]=Math.round(m.blue*b)}return t},J=(t,n,u,o)=>{let s=performance.now(),e=o.levelSteps,l=[],a=[],c=o.lineThickness,d=o.lineLength,h=1-o.darkeningFactor,r=o.lineAlpha,i=o.lineDensity*2,m=o.lightness;for(let x=-1;x<=e;x++){l[x]={},a[x]={};for(let f=-1;f<=e;f++)l[x][f]={},a[x][f]={}}for(let x in u){let f=x.split(":"),p=parseInt(f[0]),M=parseInt(f[1]),w=parseInt(f[2]),g=255*p/(e-1),I=255*M/(e-1),y=255*w/(e-1);g=Math.min(255,Math.max(0,g)),I=Math.min(255,Math.max(0,I)),y=Math.min(255,Math.max(0,y));let D=1-Math.min(g,I,y)/255,v="";if(D>0){let F=Math.pow(1/D,1/m),U=Math.round((255-(255-g)*F)*h),W=Math.round((255-(255-I)*F)*h),E=Math.round((255-(255-y)*F)*h);v=`rgb(${U}, ${W}, ${E})`}else{let F=Math.round(g*h),U=Math.round(I*h),W=Math.round(y*h);v=`rgb(${F}, ${U}, ${W})`}let S=0,j=0;if(Math.abs(I-y)>.1||Math.abs(2*g-I-y)>.1){j=Math.atan2(Math.sqrt(3)*(I-y),2*g-I-y);let F=Math.max(255-g,255-I,255-y),U=Math.min(255-g,255-I,255-y);S=(F-U)/F,S==0&&(j=Math.random()*Math.PI*2)}else j=0,S=0;let q=Math.PI*(.1+.9*Math.pow(1-S,3)),P=K(t,n,j/2+Math.PI*.3,q,c,d,D*i,v,r);l[p][M][w]=P,a[p][M][w]=P.getContext("2d").getImageData(0,0,t,n)}let b=performance.now();return console.log("create textures....",b-s),{canvases:l,imageDatas:a}},Z=(t,n,u,o,s,e)=>{n*=4;let l=u/255*(e-1),a=o/255*(e-1),c=s/255*(e-1),d=l,h=a,r=c;l=Math.round(l),a=Math.round(a),c=Math.round(c);let i=0;for(let p=-1;p<=1;p++)for(let M=-1;M<=1;M++)for(let w=-1;w<=1;w++){let g=(.75-Math.abs(l+p-d)/2)*(.75-Math.abs(a+M-h)/2)*(.75-Math.abs(c+w-r)/2);if(g<0)throw new Error("debug");i+=g}let m=0,b=0,x=0;for(let p=-1;p<=1;p++)for(let M=-1;M<=1;M++)for(let w=-1;w<=1;w++){let g=(.75-Math.abs(l+p-d)/2)*(.75-Math.abs(a+M-h)/2)*(.75-Math.abs(c+w-r)/2);g/=i;let I=t[l+p][a+M][c+w];if(I==null)throw new Error("debug me!");m+=I.data[n]*g,b+=I.data[n+1]*g,x+=I.data[n+2]*g}let f=1-(1-(e+1)/e)*.25;return{red:Math.min(255,Math.round(m*f)),green:Math.min(255,Math.round(b*f)),blue:Math.min(255,Math.round(x*f))}},K=(t,n,u,o,s,e,l,a,c)=>{let d=l*t*n/e/s/c,h=document.createElement("canvas");h.width=t,h.height=n;let r=h.getContext("2d");r.strokeStyle=a,r.globalAlpha=1,r.fillStyle="#FFFFFF",r.fillRect(0,0,t,n),r.globalAlpha=c,r.lineWidth=s;for(let i=0;i<d;i++){let m=u+Math.round(Math.random()*2-1)/2*o,b=Math.random()*t,x=Math.random()*n,f=e/2*Math.cos(m),p=e/2*Math.sin(m),M=b+f,w=b-f,g=x+p,I=x-p;r.beginPath(),r.moveTo(M,g),r.lineTo(w,I),r.stroke()}return h},z=(t,n)=>{let u=n.width,o=n.height,s=n.blurAmount,e=[],l=[];for(let h=0;h<u;h++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<o;m++){let b=h+m*u;r[0]+=t[b*3+0],r[1]+=t[b*3+1],r[2]+=t[b*3+2],i[0]+=t[b*3+0]*t[b*3+0],i[1]+=t[b*3+1]*t[b*3+1],i[2]+=t[b*3+2]*t[b*3+2],e[b]=r.slice(0),l[b]=i.slice(0)}}let a=[],c=[];for(let h=0;h<o;h++){let r=[0,0,0],i=[0,0,0];for(let m=0;m<u;m++){let b=m+h*u,x=m+Math.max(0,Math.round(h-s/2))*u,f=m+Math.min(o-1,Math.round(h+s/2))*u;r[0]+=(e[f][0]-e[x][0])/(f-x)*u,r[1]+=(e[f][1]-e[x][1])/(f-x)*u,r[2]+=(e[f][2]-e[x][2])/(f-x)*u,i[0]+=(l[f][0]-l[x][0])/(f-x)*u,i[1]+=(l[f][1]-l[x][1])/(f-x)*u,i[2]+=(l[f][2]-l[x][2])/(f-x)*u,a[b]=r.slice(0),c[b]=i.slice(0)}}let d=[];for(let h=0;h<u;h++)for(let r=0;r<o;r++){let i=h+r*u,m=Math.max(0,Math.round(h-s/2))+r*u,b=Math.min(u-1,Math.round(h+s/2))+r*u,x=(a[b][0]-a[m][0])/(b-m),f=(a[b][1]-a[m][1])/(b-m),p=(a[b][2]-a[m][2])/(b-m),M=(c[b][0]-c[m][0])/(b-m),w=(c[b][1]-c[m][1])/(b-m),g=(c[b][2]-c[m][2])/(b-m);d[i]=Math.sqrt(M+w+g-(x*x+f*f+p*p)),isNaN(d[i])&&(d[i]=0)}return d};var Q=(t,n,u)=>{let o=t/255,s=n/255,e=u/255,l,a,c;o<=.04045?l=o/12.92:l=Math.pow((o+.055)/1.055,2.4),s<=.04045?a=s/12.92:a=Math.pow((s+.055)/1.055,2.4),e<=.04045?c=e/12.92:c=Math.pow((e+.055)/1.055,2.4);let d,h,r;d=l*.4124564+a*.3575761+c*.1804375,h=l*.2126729+a*.7151522+c*.072175,r=l*.0193339+a*.119192+c*.9503041;let i=.008856,m=903.3,b=.950456,x=1,f=1.088754,p=d/b,M=h/x,w=r/f,g,I,y;p>i?g=Math.pow(p,.3333333333333333):g=(m*p+16)/116,M>i?I=Math.pow(M,.3333333333333333):I=(m*M+16)/116,w>i?y=Math.pow(w,.3333333333333333):y=(m*w+16)/116;let D=116*I-16,v=500*(g-I),S=200*(I-y);return{l:D,a:v,b:S}},tt=(t,n,u)=>{let o=Number.MAX_VALUE,s={x:0,y:0,l:0,a:0,b:0},e=t.width,l=t.height;for(let a=n-1;a<=n+1&&a>=0&&a<l-1;a++)for(let c=u-1;c<=u+1&&c>=0&&c<e-1;c++){let d=t.data[4*(a*e+c+1)],h=t.data[4*((a+1)*e+c+1)],r=t.data[4*(a*e+c)];Math.sqrt(Math.pow(d-r,2))+Math.sqrt(Math.pow(h-r,2))<o&&(o=Math.abs(d-r)+Math.abs(h-r),s.x=a,s.y=c)}return s},et=(t,n,u,o,s,e)=>{let l=t.width,a=Math.sqrt(Math.pow(n.l-t.data[4*(u*l+o)],2)+Math.pow(n.a-t.data[4*(u*l+o)+1],2)+Math.pow(n.b-t.data[4*(u*l+o)+2],2)),c=Math.sqrt(Math.pow(n.x-u,2)+Math.pow(n.y-o,2));return Math.pow(a/e,2)+Math.pow(c/s,2)},at=(t,n,u,o)=>{let s=t.width,e=t.height,l=Array.from({length:s*e}).map(c=>c=-1),a=new Array;for(let c=n;c<e;c+=n)for(let d=n;d<s;d+=n){let h=tt(t,c,d);h.l=t.data[4*(h.x*s+h.y)],h.a=t.data[4*(h.x*s+h.y)+1],h.b=t.data[4*(h.x*s+h.y)+2],a.push(h)}for(let c=0;c<u;c++){let d=Array.from({length:s*e}).map(r=>r=Number.MAX_VALUE);for(let r=0;r<a.length;r++)for(let i=a[r].x-n;i<a[r].x+n;i++)for(let m=a[r].y-n;m<a[r].y+n;m++)if(i>=0&&i<e&&m>=0&&m<s){let b=et(t,a[r],i,m,n,o);b<d[i*s+m]&&(d[i*s+m]=b,l[i*s+m]=r)}let h=JSON.parse(JSON.stringify(a));for(let r of a)r.c=r.l=r.a=r.b=r.x=r.y=0;for(let r=0;r<e;r++)for(let i=0;i<s;i++){let m=l[r*s+i];m!=-1&&(a[m].l+=t.data[4*(r*s+i)],a[m].a+=t.data[4*(r*s+i)+1],a[m].b+=t.data[4*(r*s+i)+2],a[m].x+=r,a[m].y+=i,a[m].c+=1)}for(let r in a)a[r].c==0||a[r].x==null||a[r].y==null?a[r]=JSON.parse(JSON.stringify(h[r])):(a[r].l/=a[r].c,a[r].a/=a[r].c,a[r].b/=a[r].c,a[r].x=Math.floor(a[r].x/a[r].c),a[r].y=Math.floor(a[r].y/a[r].c))}return{clusterID:l,centers:a}},nt=(t,n,u,o)=>{let s=t.width,e=t.height,l=Math.ceil(e/o),a=Math.ceil(s/o),c=new Uint8ClampedArray(s*e*4);for(let d=0;d<l;d++)for(let h=0;h<a;h++){let r=d*o,i=h*o,m={};for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++){let M=u[f*s+p];M!=-1&&(m[M]?m[M]++:m[M]=1)}let b=-1,x=Number.MIN_VALUE;for(let f in m)m[f]>x&&(x=m[f],b=+f);for(let f=r;f<r+o&&f<e;f++)for(let p=i;p<i+o&&p<s;p++)c[4*(f*s+p)]=t.data[4*(n[b].x*s+n[b].y)],c[4*(f*s+p)+1]=t.data[4*(n[b].x*s+n[b].y)+1],c[4*(f*s+p)+2]=t.data[4*(n[b].x*s+n[b].y)+2],c[4*(f*s+p)+3]=t.data[4*(n[b].x*s+n[b].y)+3]}return console.log("painting done..................."),c},rt=(t,n,u)=>{let o=[-1,-1,0,1,1,1,0,-1],s=[0,-1,-1,-1,0,1,1,1],e=[],l=Array.from({length:u}).map(a=>a=Array.from({length:n}).map(c=>c=!1));for(let a=0;a<u;a++)for(let c=0;c<n;c++){let d=0;for(let h=0;h<8;h++){let r=a+o[h],i=c+s[h];r>=0&&r<u&&i>=0&&i<n&&l[r][i]==!1&&t[a*n+c]!=t[r*n+i]&&(d+=1)}d>=2&&(e.push({x:a,y:c}),l[a][c]=!0)}return e},ee=(t,n,u,o,s)=>{let e=t.width,l=t.height,a=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let i=0;i<e*l;i+=4){let m=Q(t.data[i],t.data[i+1],t.data[i+2]);a.data[i]=m.l,a.data[i+2]=m.a,a.data[i+3]=m.b}let{clusterID:c,centers:d}=at(a,n,u,s),h=nt(t,d,c,o),r=rt(c,e,l);for(let i=0;i<r.length;i++){let m=4*(r[i].x*e+r[i].y);h[m]=255,h[m+1]=255,h[m+2]=255,h[m+3]=255}return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var re=(t,n)=>{let u=0;return N(t,o=>{let s=o.r,e=o.g,l=o.b,{h:a,s:c,v:d}=T(s/255,e/255,l/255),h=!1;for(let r of n.bands){let i=a>=r.hueMin/360&&a<=r.hueMax/360,m=d<=r.valueMax;if(h=i&&m,h)break}if(h)return o;{let r=.299*s+.587*e+.114*l;return{r,g:r,b:r,a:o.a}}})};var le=(t,n,u=20,o=24)=>{let{width:s,height:e}=t,l=new ImageData(s,e),a=Math.cos(n),c=Math.sin(n);for(let d=0;d<e;d++)for(let h=0;h<s;h++){let r=0,i=0,m=0,b=0;for(let f=0;f<o;f++){let p=f/(o-1)-.5,M=h+a*p*u,w=d+c*p*u,g=C(t,M,w);r+=g[0],i+=g[1],m+=g[2],b+=g[3]}let x=(d*s+h)*4;l.data[x]=r/o,l.data[x+1]=i/o,l.data[x+2]=m/o,l.data[x+3]=b/o}return l};var de=(t,n,u,o=.5,s=32)=>{let{width:e,height:l}=t,a=new ImageData(e,l);for(let c=0;c<l;c++)for(let d=0;d<e;d++){let h=0,r=0,i=0,m=0,b=d-n,x=c-u;for(let p=0;p<s;p++){let w=(p/(s-1)-.5)*o,g=Math.sin(w),I=Math.cos(w),y=n+(b*I-x*g),D=u+(b*g+x*I),v=C(t,y,D);h+=v[0],r+=v[1],i+=v[2],m+=v[3]}let f=(c*e+d)*4;a.data[f]=h/s,a.data[f+1]=r/s,a.data[f+2]=i/s,a.data[f+3]=m/s}return a};var me=(t,n,u,o,s)=>{let{width:e,height:l}=t,a=new ImageData(e,l);for(let c=0;c<l;c++)for(let d=0;d<e;d++){let h=d-n,r=c-u,i=Math.sqrt(h*h+r*r);if(i<o){let m=(o-i)/o,b=s*m,x=Math.sin(b),f=Math.cos(b),p=n+h*f-r*x,M=u+h*x+r*f,w=C(t,p,M),g=(c*e+d)*4;a.data[g]=w[0],a.data[g+1]=w[1],a.data[g+2]=w[2],a.data[g+3]=w[3]}else{let m=(c*e+d)*4,b=m;a.data[m]=t.data[b],a.data[m+1]=t.data[b+1],a.data[m+2]=t.data[b+2],a.data[m+3]=t.data[b+3]}}return a};var xe=(t,n,u,o=6)=>{let{width:s,height:e}=t,l=new ImageData(s,e),a=2*Math.PI/o;for(let c=0;c<e;c++)for(let d=0;d<s;d++){let h=d-n,r=c-u,i=Math.atan2(r,h),m=Math.sqrt(h*h+r*r);i=i%a,i=Math.abs(i-a/2);let b=n+m*Math.cos(i),x=u+m*Math.sin(i),f=C(t,b,x),p=(c*s+d)*4;l.data[p]=f[0],l.data[p+1]=f[1],l.data[p+2]=f[2],l.data[p+3]=f[3]}return l};var ge=()=>{let t=new Worker(new URL("worker.js",import.meta.url)),n=new Map,u=0;t.onmessage=s=>{let{id:e,result:l}=s.data,a=n.get(e);a&&(a(l),n.delete(e))},t.onerror=s=>{console.error("Worker error",s)};let o=(s,e,l=[])=>new Promise(a=>{let c=u++;n.set(c,a),t.postMessage({id:c,filter:s,imageData:e,params:l})});return new Proxy({},{get:(s,e)=>(l,...a)=>o(e,l,a)})};export{ee as SLIC,gt as browniFilter,re as colourSplash,at as computePixel,k as convolve,O as convolve2,st as createCanvas,lt as crop,yt as dodgeFilter,kt as embossFilter,tt as findLocalMinimum,Ot as fishEyeFilter,R as gaussianBlur,Et as glowFilter,B as greyScaleFilter,Gt as gridFilter,Pt as halftoneFilter,Yt as hatchFilter,_ as hshear,_t as invertFilter,xe as kaleidoscopeFilter,pt as kodakChromeFilter,St as laplacianFilter,ot as loadImage,le as motionBlur,A as mult,ge as newWorker,Mt as nightVisionFilter,X as numChannels,Jt as painterlyFilter,bt as polaroidFilter,de as radialSpinBlur,Q as rgb2lab,T as rgbToHsv,C as sampleBilinear,ft as sepiaFilter,Ct as sharpenFilter,Kt as shearFilter,Qt as sketchTransform,Bt as sobelFilter,me as swirlFilter,xt as technicolourFilter,ct as transform2Filter,N as transformFilter,ut as uniformBlur,wt as vintageFilter,H as vshear};
