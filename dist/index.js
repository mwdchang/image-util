var P=t=>t.data.length/t.width/t.height,rt=async(t,e)=>{let l=new Image,o=document.createElement("canvas"),u=o.getContext("2d");return new Promise((s,n)=>{l.crossOrigin="",l.onerror=()=>{n(new Error("unable to load image"))},l.onload=()=>{l.width=e.width||l.naturalWidth,l.height=e.height||l.naturalHeight,o.width=l.width,o.height=l.height,u.drawImage(l,0,0,l.width,l.height);let c=u.getImageData(0,0,o.width,o.height);s(c)},l.src=t})},ot=t=>{let e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e},st=(t,e)=>{let l=t.width,o=4,u=[];for(let a=e.y;a<e.y+e.height;a++)for(let s=e.x;s<e.x+e.width;s++){let n=a*l*o+s*o;for(let c=0;c<o;c++)u.push(t.data[n+c])}return new ImageData(new Uint8ClampedArray(u),e.width,e.height)},j=(t,e)=>{let l=[],o=t.data.length;for(let u=0;u<o;u+=4){let a=e({r:t.data[u+0],g:t.data[u+1],b:t.data[u+2],a:t.data[u+3]});l.push(a.r),l.push(a.g),l.push(a.b),l.push(a.a)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)},lt=(t,e,l)=>{let o=[];if(t.data.length!==e.data.length)throw new Error("images need to be same length");let u=t.data.length;for(let a=0;a<u;a+=4){let s=l({r:t.data[a+0],g:t.data[a+1],b:t.data[a+2],a:t.data[a+3]},{r:e.data[a+0],g:e.data[a+1],b:e.data[a+2],a:e.data[a+3]});o.push(s.r),o.push(s.g),o.push(s.b),o.push(s.a)}return new ImageData(new Uint8ClampedArray(o),t.width,t.height)},v=(t,e)=>{let l=Math.round(Math.sqrt(e.length)),o=Math.floor(l/2),u=t.width,a=t.height,s=P(t),n=u,c=a,d=[];for(let h=0;h<c;h++)for(let r=0;r<n;r++){let f=[];for(let i=0;i<s;i++)f.push(0);for(let i=0;i<l;i++)for(let m=0;m<l;m++){let x=h+i-o,b=r+m-o;if(x>=0&&x<a&&b>=0&&b<u){let p=(x*u+b)*s,w=e[i*l+m];for(let g=0;g<s;g++)f[g]+=t.data[p+g]*w}else for(let p=0;p<s;p++)f[p]+=t.data[(h*n+r)*s]*(1/e.length)*.28}for(let i=0;i<s;i++)d.push(f[i])}return new ImageData(new Uint8ClampedArray(d),u,a)},B=(t,e,l,o,u)=>{let a=Math.round(Math.sqrt(u.length)),s=Math.floor(a/2),n=e,c=l,d=n,h=c,r=[];for(let f=0;f<h;f++)for(let i=0;i<d;i++){let m=[];for(let x=0;x<o;x++)m.push(0);for(let x=0;x<a;x++)for(let b=0;b<a;b++){let p=f+x-s,w=i+b-s;if(p>=0&&p<c&&w>=0&&w<n){let g=(p*n+w)*o,M=u[x*a+b];for(let I=0;I<o;I++)m[I]+=t[g+I]*M}else for(let g=0;g<o;g++)m[g]+=t[(f*d+i)*o]*(1/u.length)*.28}for(let x=0;x<o;x++)r.push(m[x])}return r},R=(t,e,l)=>{let o=Math.max(t,e,l),u=Math.min(t,e,l),a=o-u,s=0;a!==0&&(o===t?s=((e-l)/a+(e<l?6:0))/6:o===e?s=((l-t)/a+2)/6:s=((t-e)/a+4)/6);let n=o===0?0:a/o;return{h:s,s:n,v:o}};var ut=(t,e)=>{let l=[],o=e*e;for(let u=0;u<o;u++)l.push(1/o);return v(t,l)};var C=(t,e)=>{let l=t.width,o=t.height,u=4,a=[];for(let s=0;s<o;s++)for(let n=0;n<l;n++){let c=u*(s*l+n),d=t.data[c+0],h=t.data[c+1],r=t.data[c+2],f=t.data[c+3],i=d*e[0]+h*e[1]+r*e[2],m=d*e[3]+h*e[4]+r*e[5],x=d*e[6]+h*e[7]+r*e[8];a.push(i),a.push(m),a.push(x),a.push(f)}return new ImageData(new Uint8ClampedArray(a),l,o)},ft=t=>C(t,[.393,.7689999,.18899999,.349,.6859999,.16799999,.272,.5339999,.13099999]),it=t=>C(t,[1.438,-.062,-.062,-.122,1.378,-.122,-.016,-.016,1.483]),mt=t=>C(t,[1.9125277891456083,-.8545344976951645,-.09155508482755585,-.3087833385928097,1.7658908555458428,-.10601743074722245,-.231103377548616,-.7501899197440212,1.847597816108189]),bt=t=>C(t,[1.1285582396593525,-.3967382283601348,-.03992559172921793,-.16404339962244616,1.0835251566291304,-.05498805115633132,-.16786010706155763,-.5603416277695248,1.6014850761964943]),xt=t=>C(t,[.5997023498159715,.34553243048391263,-.2708298674538042,-.037703249837783157,.8609577587992641,.15059552388459913,.24113635128153335,-.07441037908422492,.44972182064877153]),pt=t=>C(t,[.6279345635605994,.3202183420819367,-.03965408211312453,.02578397704808868,.6441188644374771,.03259127616149294,.0466055556782719,-.0851232987247891,.5241648018700465]);var wt=(t,e)=>{let l=[];for(let o=0;o<t.data.length;o++){let u=t.data[o]/(255-e.data[o]);u>1&&(u=1),l.push(u*255)}return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var F=(t,e)=>{let l=t.width,o=t.height,u=4,a=new Uint8ClampedArray(l*o*u);for(let s=0;s<l*o;++s){let n=s*u;if(e){if(e.rFilter){let d=e.rFilter;if(t.data[n]>=d[0]&&t.data[n]<=d[1]){a[n]=t.data[n],a[n+1]=t.data[n+1],a[n+2]=t.data[n+2],a[n+3]=255;continue}}if(e.gFilter){let d=e.gFilter;if(t.data[n+1]>=d[0]&&t.data[n+1]<=d[1]){a[n]=t.data[n],a[n+1]=t.data[n+1],a[n+2]=t.data[n+2],a[n+3]=255;continue}}if(e.bFilter){let d=e.bFilter;if(t.data[n+2]>=d[0]&&t.data[n+2]<=d[1]){a[n]=t.data[n],a[n+1]=t.data[n+1],a[n+2]=t.data[n+2],a[n+3]=255;continue}}}let c=0;for(let d=0;d<u-1;d++)c+=t.data[n+d];c/=3;for(let d=0;d<u-1;d++)a[n+d]=c;a[n+u-1]=255}return new ImageData(new Uint8ClampedArray(a),l,o)};var vt=t=>v(t,[0,-1,0,-1,5,-1,0,-1,0]),At=t=>{let e=F(t);return v(e,[-2,-1,0,-1,1,1,0,1,2])},Ct=t=>{let e=[-1,-1,-1,-1,8,-1,-1,-1,-1],l=[],o=F(t);for(let s=0;s<o.data.length;s++)s%4===0&&l.push(t.data[s]);let u=B(l,t.width,t.height,1,e),a=[];for(let s=0;s<u.length;s++)a.push(u[s]),a.push(u[s]),a.push(u[s]),a.push(255);return new ImageData(new Uint8ClampedArray(a),t.width,t.height)},Ft=t=>{let e=[-1,0,1,-2,0,2,-1,0,1],l=[-1,-2,-1,0,0,0,1,2,1],o=F(t),u=[];for(let c=0;c<o.data.length;c++)c%4===0&&u.push(o.data[c]);let a=B(u,t.width,t.height,1,e),s=B(u,t.width,t.height,1,l),n=[];for(let c=0;c<a.length;c++){let d=Math.sqrt(a[c]*a[c]+s[c]*s[c]);n.push(Math.min(255,d)),n.push(Math.min(255,d)),n.push(Math.min(255,d)),n.push(255)}return new ImageData(new Uint8ClampedArray(n),t.width,t.height)};var St=(t,e,l,o,u)=>{let a=t.width,s=t.height,n=4,c=[];for(let d=0;d<s;d++)for(let h=0;h<a;h++){let r=h-e,f=d-l,i=Math.sqrt(r*r+f*f);if(i<o){let m=Math.floor(e+r*u*i),x=Math.floor(l+f*u*i),b=n*(x*a+m);c.push(t.data[b]),c.push(t.data[b+1]),c.push(t.data[b+2]),c.push(255)}else{let m=n*(d*a+h);c.push(t.data[m]),c.push(t.data[m+1]),c.push(t.data[m+2]),c.push(t.data[m+3])}}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var X=[67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,67e-8,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,67e-8],W=t=>v(t,X);var G=(t,e,l)=>`rgb(${t},${e},${l})`,Y=(t,e,l,o)=>{let{width:u,data:a}=t,s=o.kernel,n=s*s,c=0,d=0,h=0;for(let x=l;x<l+s;x++)for(let b=e;b<e+s;b++){let p=(x*u+b)*4;c+=a[p]||0,d+=a[p+1]||0,h+=a[p+2]||0}let r=(o.rWeight*c+o.gWeight*d+o.bWeight*h)/(255*n),f=c/n,i=d/n,m=h/n;return{v:r,avgR:f,avgG:i,avgB:m}},Bt=(t,e)=>{let l=e.kernel,o=t.width,u=t.height;e.rWeight||(e.rWeight=.2),e.gWeight||(e.gWeight=.2),e.bWeight||(e.bWeight=.2);let a=document.createElement("canvas");a.width=t.width,a.height=t.height;let s=a.getContext("2d"),n=(l-1)*.5;for(let c=0;c<=u-l;c+=l)for(let d=0;d<=o-l;d+=l){let{v:h,avgR:r,avgG:f,avgB:i}=Y(t,d,c,e),m=l/2*(1-h),x=0;e.shiftYAmt&&e.shiftYStride&&(x=d%(e.shiftYStride*l)===0?0:e.shiftYAmt);let b=0;e.shiftXAmt&&e.shiftXStride&&(x=d%(e.shiftXStride*l)===0?0:e.shiftXAmt),s.beginPath(),s.fillStyle=G(r,f,i),s.ellipse(b+d+n,x+c+n,m,m,0,0,2*Math.PI),s.fill(),s.closePath()}return s.getImageData(0,0,o,u)};var Wt=t=>{let e=W(t);e=F(e);let l=[];for(let o=0;o<t.data.length;o++)if(o%4!==3){let u=Math.min(255,.5*e.data[o]+.9*t.data[o]);l.push(u)}else l.push(255);return new ImageData(new Uint8ClampedArray(l),t.width,t.height)};var Et=(t,e,l)=>{let o=t.width,u=t.height,a=4,s=[];for(let n=0;n<u;n++)for(let c=0;c<o;c++){let d=a*(n*o+c);n%e<l||c%e<l?(s.push(255),s.push(255),s.push(255),s.push(255)):(s.push(t.data[d+0]),s.push(t.data[d+1]),s.push(t.data[d+2]),s.push(255))}return new ImageData(new Uint8ClampedArray(s),t.width,t.height)};var L=(t,e,l)=>(t*.299+e*.587+l*.114)/255,Xt=(t,e,l,o,u)=>{let a=t.width,s=t.height,n=4,c=[],d=10;for(let h=0;h<s;h++)for(let r=0;r<a;r++){let f=n*(h*a+r),i=t.data[f+0],m=t.data[f+1],x=t.data[f+2],b=L(i,m,x),p=245,w=245,g=245,M=6;b<e&&(r+h)%M===0&&(p=4*d,w=4*d,g=4*d),b<l&&(r-h)%M===0&&(p=4*d,w=4*d,g=4*d),b<o&&(r+h-5)%M===0&&(p=4*d,w=4*d,g=4*d),b<u&&(r-h-5)%M===0&&(p=8*d,w=8*d,g=8*d),c.push(p),c.push(w),c.push(g),c.push(255)}return new ImageData(new Uint8ClampedArray(c),t.width,t.height)};var Lt=t=>j(t,e=>({r:255-e.r,g:255-e.g,b:255-e.b,a:e.a}));var Ht=(t,e,l)=>{let o=t.width,u=t.height,a=4,s=new Uint8ClampedArray(t.data);for(let n=e;n<u-e;n++)for(let c=e;c<o-e;c++){let d=[],h=[],r=[],f=[];for(let b=0;b<l;b++)d.push(0),h.push(0),r.push(0),f.push(0);for(let b=-e;b<=e;b++)for(let p=-e;p<=e;p++){let w=a*((n+b)*o+(c+p)),g=t.data[w+0],M=t.data[w+1],I=t.data[w+2],y=Math.floor((g+M+I)/3*l/255);d[y]++,h[y]+=g,r[y]+=M,f[y]+=I}let i=0,m=0;for(let b=0;b<l;b++)d[b]>i&&(i=d[b],m=b);let x=a*(n*o+c);s[x+0]=h[m]/i,s[x+1]=r[m]/i,s[x+2]=f[m]/i}return new ImageData(s,o,u)};var $=(t,e,l)=>{let o=t.width,u=t.height,a=new ImageData(new Uint8ClampedArray(t.data),o,u),s=Math.floor(Math.random()*l),n=0,c=!1;for(let d=0;d<o;d++){if(n++,c){for(let h=0;h<u-s;h++){let r=4*(h*o+d),f=4*((h+s)*o+d);a.data[r]=t.data[f],a.data[r+1]=t.data[f+1],a.data[r+2]=t.data[f+2],a.data[r+3]=t.data[f+3]}for(let h=u-s;h<u;h++){let r=4*(h*o+d);a.data[r]=255,a.data[r+1]=255,a.data[r+2]=255,a.data[r+3]=255}}else{for(let h=0;h<s;h++){let r=4*(h*o+d);a.data[r]=255,a.data[r+1]=255,a.data[r+2]=255,a.data[r+3]=255}for(let h=s;h<u;h++){let r=4*(h*o+d),f=4*((h-s)*o+d);a.data[r]=t.data[f],a.data[r+1]=t.data[f+1],a.data[r+2]=t.data[f+2],a.data[r+3]=t.data[f+3]}}n==e&&(s=Math.floor(Math.random()*l),c=!c,n=0)}return a},H=(t,e,l)=>{let o=t.width,u=t.height,a=new ImageData(new Uint8ClampedArray(t.data),o,u),s=Math.floor(Math.random()*l),n=0,c=!1;for(let d=0;d<u;d++){if(n++,c){for(let h=0;h<o-s;h++){let r=4*(d*o+h),f=4*(d*o+h+s);a.data[r]=t.data[f],a.data[r+1]=t.data[f+1],a.data[r+2]=t.data[f+2],a.data[r+3]=t.data[f+3]}for(let h=o-s;h<o;h++){let r=4*(d*o+h);a.data[r]=255,a.data[r+1]=255,a.data[r+2]=255,a.data[r+3]=255}}else{for(let h=s;h<o;h++){let r=4*(d*o+h),f=4*(d*o+h-s);a.data[r]=t.data[f],a.data[r+1]=t.data[f+1],a.data[r+2]=t.data[f+2],a.data[r+3]=t.data[f+3]}for(let h=0;h<s;h++){let r=4*(d*o+h);a.data[r]=255,a.data[r+1]=255,a.data[r+2]=255,a.data[r+3]=255}}n==e&&(s=Math.floor(Math.random()*l),c=!c,n=0)}return a},Vt=(t,e,l,o,u)=>{let a=H(t,e,l);return $(a,o,u)};var Zt=(t,e)=>{let l=t.width,o=t.height,u=t.data,a=new Set,s=[];for(let h=0;h<l;h++)for(let r=0;r<o;r++){let f=(h+r*l)*4,i=u[f]+":"+u[f+1]+":"+u[f+2];a.has(i)||(a.add(i),s.push([u[f+0],u[f+1],u[f+2]]))}let n={};for(;;){let h=e.levelSteps;n={};for(let f of s){let i=f[0],m=f[1],x=f[2],b=Math.round(i/255*(h-1)),p=Math.round(m/255*(h-1)),w=Math.round(x/255*(h-1));for(let g=-1;g<=1;g++)for(let M=-1;M<=1;M++)for(let I=-1;I<=1;I++){let y=b+g+":"+(p+M)+":"+(w+I);n[y]=!0}}if(Object.keys(n).length>NaN&&e.levelSteps>2){e.levelSteps--,console.log("Reducing to "+e.levelSteps+" RGB steps");continue}break}let{canvases:c,imageDatas:d}=V(l,o,n,e);return _(t,d,e)},_=(t,e,l)=>{let o=t.width,u=t.height,a=t.data,s=[];for(let n=0;n<o;n++)for(let c=0;c<u;c++){let d=n+c*o;s[d*3]=a[d*4],s[d*3+1]=a[d*4+1],s[d*3+2]=a[d*4+2]}s=K(s,{width:o,height:u,blurAmount:l.edgeBlurAmount});for(let n=0;n<o;n++)for(let c=0;c<u;c++){let d=n+c*o,h=a[d*4],r=a[d*4+1],f=a[d*4+2],i=J(e,d,h,r,f,l.levelSteps);if(l.greyScale){let x=Math.round((i.red+i.green+i.blue)/3);i.red=i.green=i.blue=x}let m=Math.max(0,(255-s[n+c*o]*l.edgeAmount)/255);m=Math.min(1,Math.max(.5,m*m)),a[d*4]=Math.round(i.red*m),a[d*4+1]=Math.round(i.green*m),a[d*4+2]=Math.round(i.blue*m)}return t},V=(t,e,l,o)=>{let u=performance.now(),a=o.levelSteps,s=[],n=[],c=o.lineThickness,d=o.lineLength,h=1-o.darkeningFactor,r=o.lineAlpha,f=o.lineDensity*2,i=o.lightness;for(let x=-1;x<=a;x++){s[x]={},n[x]={};for(let b=-1;b<=a;b++)s[x][b]={},n[x][b]={}}for(let x in l){let b=x.split(":"),p=parseInt(b[0]),w=parseInt(b[1]),g=parseInt(b[2]),M=255*p/(a-1),I=255*w/(a-1),y=255*g/(a-1);M=Math.min(255,Math.max(0,M)),I=Math.min(255,Math.max(0,I)),y=Math.min(255,Math.max(0,y));let k=1-Math.min(M,I,y)/255,S="";if(k>0){let D=Math.pow(1/k,1/i),U=Math.round((255-(255-M)*D)*h),N=Math.round((255-(255-I)*D)*h),E=Math.round((255-(255-y)*D)*h);S=`rgb(${U}, ${N}, ${E})`}else{let D=Math.round(M*h),U=Math.round(I*h),N=Math.round(y*h);S=`rgb(${D}, ${U}, ${N})`}let A=0,O=0;if(Math.abs(I-y)>.1||Math.abs(2*M-I-y)>.1){O=Math.atan2(Math.sqrt(3)*(I-y),2*M-I-y);let D=Math.max(255-M,255-I,255-y),U=Math.min(255-M,255-I,255-y);A=(D-U)/D,A==0&&(O=Math.random()*Math.PI*2)}else O=0,A=0;let q=Math.PI*(.1+.9*Math.pow(1-A,3)),T=Z(t,e,O/2+Math.PI*.3,q,c,d,k*f,S,r);s[p][w][g]=T,n[p][w][g]=T.getContext("2d").getImageData(0,0,t,e)}let m=performance.now();return console.log("create textures....",m-u),{canvases:s,imageDatas:n}},J=(t,e,l,o,u,a)=>{e*=4;let s=l/255*(a-1),n=o/255*(a-1),c=u/255*(a-1),d=s,h=n,r=c;s=Math.round(s),n=Math.round(n),c=Math.round(c);let f=0;for(let p=-1;p<=1;p++)for(let w=-1;w<=1;w++)for(let g=-1;g<=1;g++){let M=(.75-Math.abs(s+p-d)/2)*(.75-Math.abs(n+w-h)/2)*(.75-Math.abs(c+g-r)/2);if(M<0)throw new Error("debug");f+=M}let i=0,m=0,x=0;for(let p=-1;p<=1;p++)for(let w=-1;w<=1;w++)for(let g=-1;g<=1;g++){let M=(.75-Math.abs(s+p-d)/2)*(.75-Math.abs(n+w-h)/2)*(.75-Math.abs(c+g-r)/2);M/=f;let I=t[s+p][n+w][c+g];if(I==null)throw new Error("debug me!");i+=I.data[e]*M,m+=I.data[e+1]*M,x+=I.data[e+2]*M}let b=1-(1-(a+1)/a)*.25;return{red:Math.min(255,Math.round(i*b)),green:Math.min(255,Math.round(m*b)),blue:Math.min(255,Math.round(x*b))}},Z=(t,e,l,o,u,a,s,n,c)=>{let d=s*t*e/a/u/c,h=document.createElement("canvas");h.width=t,h.height=e;let r=h.getContext("2d");r.strokeStyle=n,r.globalAlpha=1,r.fillStyle="#FFFFFF",r.fillRect(0,0,t,e),r.globalAlpha=c,r.lineWidth=u;for(let f=0;f<d;f++){let i=l+Math.round(Math.random()*2-1)/2*o,m=Math.random()*t,x=Math.random()*e,b=a/2*Math.cos(i),p=a/2*Math.sin(i),w=m+b,g=m-b,M=x+p,I=x-p;r.beginPath(),r.moveTo(w,M),r.lineTo(g,I),r.stroke()}return h},K=(t,e)=>{let l=e.width,o=e.height,u=e.blurAmount,a=[],s=[];for(let h=0;h<l;h++){let r=[0,0,0],f=[0,0,0];for(let i=0;i<o;i++){let m=h+i*l;r[0]+=t[m*3+0],r[1]+=t[m*3+1],r[2]+=t[m*3+2],f[0]+=t[m*3+0]*t[m*3+0],f[1]+=t[m*3+1]*t[m*3+1],f[2]+=t[m*3+2]*t[m*3+2],a[m]=r.slice(0),s[m]=f.slice(0)}}let n=[],c=[];for(let h=0;h<o;h++){let r=[0,0,0],f=[0,0,0];for(let i=0;i<l;i++){let m=i+h*l,x=i+Math.max(0,Math.round(h-u/2))*l,b=i+Math.min(o-1,Math.round(h+u/2))*l;r[0]+=(a[b][0]-a[x][0])/(b-x)*l,r[1]+=(a[b][1]-a[x][1])/(b-x)*l,r[2]+=(a[b][2]-a[x][2])/(b-x)*l,f[0]+=(s[b][0]-s[x][0])/(b-x)*l,f[1]+=(s[b][1]-s[x][1])/(b-x)*l,f[2]+=(s[b][2]-s[x][2])/(b-x)*l,n[m]=r.slice(0),c[m]=f.slice(0)}}let d=[];for(let h=0;h<l;h++)for(let r=0;r<o;r++){let f=h+r*l,i=Math.max(0,Math.round(h-u/2))+r*l,m=Math.min(l-1,Math.round(h+u/2))+r*l,x=(n[m][0]-n[i][0])/(m-i),b=(n[m][1]-n[i][1])/(m-i),p=(n[m][2]-n[i][2])/(m-i),w=(c[m][0]-c[i][0])/(m-i),g=(c[m][1]-c[i][1])/(m-i),M=(c[m][2]-c[i][2])/(m-i);d[f]=Math.sqrt(w+g+M-(x*x+b*b+p*p)),isNaN(d[f])&&(d[f]=0)}return d};var z=(t,e,l)=>{let o=t/255,u=e/255,a=l/255,s,n,c;o<=.04045?s=o/12.92:s=Math.pow((o+.055)/1.055,2.4),u<=.04045?n=u/12.92:n=Math.pow((u+.055)/1.055,2.4),a<=.04045?c=a/12.92:c=Math.pow((a+.055)/1.055,2.4);let d,h,r;d=s*.4124564+n*.3575761+c*.1804375,h=s*.2126729+n*.7151522+c*.072175,r=s*.0193339+n*.119192+c*.9503041;let f=.008856,i=903.3,m=.950456,x=1,b=1.088754,p=d/m,w=h/x,g=r/b,M,I,y;p>f?M=Math.pow(p,.3333333333333333):M=(i*p+16)/116,w>f?I=Math.pow(w,.3333333333333333):I=(i*w+16)/116,g>f?y=Math.pow(g,.3333333333333333):y=(i*g+16)/116;let k=116*I-16,S=500*(M-I),A=200*(I-y);return{l:k,a:S,b:A}},Q=(t,e,l)=>{let o=Number.MAX_VALUE,u={x:0,y:0,l:0,a:0,b:0},a=t.width,s=t.height;for(let n=e-1;n<=e+1&&n>=0&&n<s-1;n++)for(let c=l-1;c<=l+1&&c>=0&&c<a-1;c++){let d=t.data[4*(n*a+c+1)],h=t.data[4*((n+1)*a+c+1)],r=t.data[4*(n*a+c)];Math.sqrt(Math.pow(d-r,2))+Math.sqrt(Math.pow(h-r,2))<o&&(o=Math.abs(d-r)+Math.abs(h-r),u.x=n,u.y=c)}return u},tt=(t,e,l,o,u,a)=>{let s=t.width,n=Math.sqrt(Math.pow(e.l-t.data[4*(l*s+o)],2)+Math.pow(e.a-t.data[4*(l*s+o)+1],2)+Math.pow(e.b-t.data[4*(l*s+o)+2],2)),c=Math.sqrt(Math.pow(e.x-l,2)+Math.pow(e.y-o,2));return Math.pow(n/a,2)+Math.pow(c/u,2)},et=(t,e,l,o)=>{console.log("computing.............................");let u=t.width,a=t.height,s=Array.from({length:u*a}).map(c=>c=-1),n=new Array;for(let c=e;c<a;c+=e)for(let d=e;d<u;d+=e){let h=Q(t,c,d);h.l=t.data[4*(h.x*u+h.y)],h.a=t.data[4*(h.x*u+h.y)+1],h.b=t.data[4*(h.x*u+h.y)+2],n.push(h)}for(let c=0;c<l;c++){let d=Array.from({length:u*a}).map(r=>r=Number.MAX_VALUE);for(let r=0;r<n.length;r++)for(let f=n[r].x-e;f<n[r].x+e;f++)for(let i=n[r].y-e;i<n[r].y+e;i++)if(f>=0&&f<a&&i>=0&&i<u){let m=tt(t,n[r],f,i,e,o);m<d[f*u+i]&&(d[f*u+i]=m,s[f*u+i]=r)}let h=JSON.parse(JSON.stringify(n));for(let r of n)r.c=r.l=r.a=r.b=r.x=r.y=0;for(let r=0;r<a;r++)for(let f=0;f<u;f++){let i=s[r*u+f];i!=-1&&(n[i].l+=t.data[4*(r*u+f)],n[i].a+=t.data[4*(r*u+f)+1],n[i].b+=t.data[4*(r*u+f)+2],n[i].x+=r,n[i].y+=f,n[i].c+=1)}for(let r in n)n[r].c==0||n[r].x==null||n[r].y==null?n[r]=JSON.parse(JSON.stringify(h[r])):(n[r].l/=n[r].c,n[r].a/=n[r].c,n[r].b/=n[r].c,n[r].x=Math.floor(n[r].x/n[r].c),n[r].y=Math.floor(n[r].y/n[r].c))}return console.log("compute done............................."),{clusterID:s,centers:n}},at=(t,e,l,o)=>{console.log("painting...................");let u=t.width,a=t.height,s=Math.ceil(a/o),n=Math.ceil(u/o),c=new Uint8ClampedArray(u*a*4);for(let d=0;d<s;d++)for(let h=0;h<n;h++){let r=d*o,f=h*o,i={};for(let b=r;b<r+o&&b<a;b++)for(let p=f;p<f+o&&p<u;p++){let w=l[b*u+p];w!=-1&&(i[w]?i[w]++:i[w]=1)}let m=-1,x=Number.MIN_VALUE;for(let b in i)i[b]>x&&(x=i[b],m=+b);for(let b=r;b<r+o&&b<a;b++)for(let p=f;p<f+o&&p<u;p++)c[4*(b*u+p)]=t.data[4*(e[m].x*u+e[m].y)],c[4*(b*u+p)+1]=t.data[4*(e[m].x*u+e[m].y)+1],c[4*(b*u+p)+2]=t.data[4*(e[m].x*u+e[m].y)+2],c[4*(b*u+p)+3]=t.data[4*(e[m].x*u+e[m].y)+3]}return console.log("painting done..................."),c},nt=(t,e,l)=>{let o=[-1,-1,0,1,1,1,0,-1],u=[0,-1,-1,-1,0,1,1,1],a=[],s=Array.from({length:l}).map(n=>n=Array.from({length:e}).map(c=>c=!1));for(let n=0;n<l;n++)for(let c=0;c<e;c++){let d=0;for(let h=0;h<8;h++){let r=n+o[h],f=c+u[h];r>=0&&r<l&&f>=0&&f<e&&s[r][f]==!1&&t[n*e+c]!=t[r*e+f]&&(d+=1)}d>=2&&(a.push({x:n,y:c}),s[n][c]=!0)}return a},zt=(t,e,l,o,u)=>{let a=t.width,s=t.height,n=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);for(let f=0;f<a*s;f+=4){let i=z(t.data[f],t.data[f+1],t.data[f+2]);n.data[f]=i.l,n.data[f+2]=i.a,n.data[f+3]=i.b}let{clusterID:c,centers:d}=et(n,e,l,u),h=at(t,d,c,o),r=nt(c,a,s);for(let f=0;f<r.length;f++){let i=4*(r[f].x*a+r[f].y);h[i]=255,h[i+1]=255,h[i+2]=255,h[i+3]=255}return new ImageData(new Uint8ClampedArray(h),t.width,t.height)};var ee=(t,e)=>{let l=0;return j(t,o=>{let u=o.r,a=o.g,s=o.b,{h:n,s:c,v:d}=R(u/255,a/255,s/255),h=!1;for(let r of e.bands){let f=n>=r.hueMin/360&&n<=r.hueMax/360,i=d<=r.valueMax;if(h=f&&i,h)break}if(h)return o;{let r=.299*u+.587*a+.114*s;return{r,g:r,b:r,a:o.a}}})};export{zt as SLIC,xt as browniFilter,ee as colourSplash,et as computePixel,v as convolve,B as convolve2,ot as createCanvas,st as crop,wt as dodgeFilter,At as embossFilter,Q as findLocalMinimum,St as fishEyeFilter,W as gaussianBlur,Wt as glowFilter,F as greyScaleFilter,Et as gridFilter,Bt as halftoneFilter,Xt as hatchFilter,H as hshear,Lt as invertFilter,bt as kodakChromeFilter,Ct as laplacianFilter,rt as loadImage,P as numChannels,Ht as painterlyFilter,it as polaroidfilter,z as rgb2lab,R as rgbToHsv,ft as sepiaFilter,vt as sharpenFilter,Vt as shearFilter,Zt as sketchTransform,Ft as sobelFilter,mt as technicolourfilter,lt as transform2Filter,j as transformFilter,ut as uniformBlur,pt as vintageFilter,$ as vshear};
